{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/analytics/supabaseClient.ts"],"sourcesContent":["/**\n * Supabase Client\n *\n * Central client for connecting to Supabase database.\n * Handles both client-side (browser) and server-side (API routes) connections.\n */\n\nimport { createClient } from '@supabase/supabase-js';\nimport type { Database } from '@/types/database';\n\n// ============================================================================\n// Environment Variables\n// ============================================================================\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n// ============================================================================\n// Client-side Supabase Client\n// Used in browser/React components\n// ============================================================================\n\nlet supabaseClient: ReturnType<typeof createClient<Database>> | null = null;\n\nexport function getSupabaseClient() {\n  if (!supabaseUrl || !supabaseAnonKey) {\n    console.error('‚ùå Missing Supabase environment variables');\n    console.error('   Please add NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY to .env.local');\n    throw new Error('Supabase configuration missing');\n  }\n\n  if (!supabaseClient) {\n    supabaseClient = createClient<Database>(supabaseUrl, supabaseAnonKey);\n  }\n\n  return supabaseClient;\n}\n\n// ============================================================================\n// Server-side Supabase Client\n// Used in API routes with service role key (full permissions)\n// ============================================================================\n\nlet supabaseServiceClient: ReturnType<typeof createClient<Database>> | null = null;\n\nexport function getSupabaseServiceClient() {\n  if (!supabaseUrl || !supabaseServiceKey) {\n    console.error('‚ùå Missing Supabase service role key');\n    console.error('   Please add SUPABASE_SERVICE_ROLE_KEY to .env.local');\n    throw new Error('Supabase service role key missing');\n  }\n\n  if (!supabaseServiceClient) {\n    supabaseServiceClient = createClient<Database>(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false\n      }\n    });\n  }\n\n  return supabaseServiceClient;\n}\n\n// ============================================================================\n// Helper: Check if Supabase is configured\n// ============================================================================\n\nexport function isSupabaseConfigured(): boolean {\n  return !!(supabaseUrl && supabaseAnonKey);\n}\n"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;AAED;;AAGA,+EAA+E;AAC/E,wBAAwB;AACxB,+EAA+E;AAE/E,MAAM;AACN,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,+EAA+E;AAC/E,8BAA8B;AAC9B,mCAAmC;AACnC,+EAA+E;AAE/E,IAAI,iBAAmE;AAEhE,SAAS;IACd;;IAMA,IAAI,CAAC,gBAAgB;QACnB,iBAAiB,IAAA,yMAAY,EAAW,aAAa;IACvD;IAEA,OAAO;AACT;AAEA,+EAA+E;AAC/E,8BAA8B;AAC9B,8DAA8D;AAC9D,+EAA+E;AAE/E,IAAI,wBAA0E;AAEvE,SAAS;IACd,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACvC,QAAQ,KAAK,CAAC;QACd,QAAQ,KAAK,CAAC;QACd,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,uBAAuB;QAC1B,wBAAwB,IAAA,yMAAY,EAAW,aAAa,oBAAoB;YAC9E,MAAM;gBACJ,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;IACF;IAEA,OAAO;AACT;AAMO,SAAS;IACd,OAAO,CAAC,CAAC,CAAC,eAAe,eAAe;AAC1C","debugId":null}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/app/api/analytics/track-upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getSupabaseClient } from \"@/core/analytics/supabaseClient\";\nimport type { TrackFileUploadRequest, TrackFileUploadResponse } from \"@/core/analytics/types\";\n\n/**\n * POST /api/analytics/track-upload\n * Track a file upload with metadata\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const body: TrackFileUploadRequest = await request.json();\n\n    if (!body.user_id || !body.tool_name || !body.filename) {\n      return NextResponse.json(\n        { error: \"Missing required fields: user_id, tool_name, filename\" },\n        { status: 400 }\n      );\n    }\n\n    const supabase = getSupabaseClient();\n\n    // Insert file upload record\n    const { data, error } = await (supabase as any)\n      .from(\"file_uploads\")\n      .insert({\n        user_id: body.user_id,\n        tool_name: body.tool_name,\n        filename: body.filename,\n        file_size: body.file_size,\n        file_type: body.file_type,\n        campaign_name: body.campaign_name,\n        brand_name: body.brand_name,\n        cn_code: body.cn_code,\n        row_count: body.row_count,\n        timestamp: new Date().toISOString(),\n      })\n      .select()\n      .single();\n\n    if (error) {\n      throw new Error(`Failed to track file upload: ${error.message}`);\n    }\n\n    console.log(`üìÅ File upload tracked: ${body.filename} (${body.tool_name})`);\n    if (body.campaign_name) {\n      console.log(`   Campaign: ${body.campaign_name} - ${body.brand_name}`);\n    }\n\n    const response: TrackFileUploadResponse = {\n      success: true,\n      upload_id: data.id,\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    console.error(\"Error in track-upload route:\", error);\n\n    return NextResponse.json(\n      {\n        error: \"Failed to track file upload\",\n        details: error instanceof Error ? error.message : \"Unknown error\",\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAOO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAA+B,MAAM,QAAQ,IAAI;QAEvD,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,KAAK,SAAS,IAAI,CAAC,KAAK,QAAQ,EAAE;YACtD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwD,GACjE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,IAAA,6KAAiB;QAElC,4BAA4B;QAC5B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,AAAC,SAC5B,IAAI,CAAC,gBACL,MAAM,CAAC;YACN,SAAS,KAAK,OAAO;YACrB,WAAW,KAAK,SAAS;YACzB,UAAU,KAAK,QAAQ;YACvB,WAAW,KAAK,SAAS;YACzB,WAAW,KAAK,SAAS;YACzB,eAAe,KAAK,aAAa;YACjC,YAAY,KAAK,UAAU;YAC3B,SAAS,KAAK,OAAO;YACrB,WAAW,KAAK,SAAS;YACzB,WAAW,IAAI,OAAO,WAAW;QACnC,GACC,MAAM,GACN,MAAM;QAET,IAAI,OAAO;YACT,MAAM,IAAI,MAAM,CAAC,6BAA6B,EAAE,MAAM,OAAO,EAAE;QACjE;QAEA,QAAQ,GAAG,CAAC,CAAC,wBAAwB,EAAE,KAAK,QAAQ,CAAC,EAAE,EAAE,KAAK,SAAS,CAAC,CAAC,CAAC;QAC1E,IAAI,KAAK,aAAa,EAAE;YACtB,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,KAAK,aAAa,CAAC,GAAG,EAAE,KAAK,UAAU,EAAE;QACvE;QAEA,MAAM,WAAoC;YACxC,SAAS;YACT,WAAW,KAAK,EAAE;QACpB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAE9C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}