{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/ui/FileUpload.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef } from \"react\";\n\ninterface FileUploadProps {\n  label: string;\n  accept?: string;\n  onFileSelect: (file: File) => void;\n  selectedFile?: File | null;\n  description?: string;\n}\n\nexport default function FileUpload({\n  label,\n  accept = \".xlsx,.xls\",\n  onFileSelect,\n  selectedFile,\n  description,\n}: FileUploadProps) {\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      onFileSelect(file);\n    }\n  };\n\n  const handleClick = () => {\n    inputRef.current?.click();\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300\">\n        {label}\n      </label>\n      {description && (\n        <p className=\"text-sm text-slate-500 dark:text-slate-400\">\n          {description}\n        </p>\n      )}\n      <div\n        onClick={handleClick}\n        className=\"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50/50 dark:hover:bg-blue-900/10 transition-colors\"\n      >\n        <input\n          ref={inputRef}\n          type=\"file\"\n          accept={accept}\n          onChange={handleFileChange}\n          className=\"hidden\"\n        />\n        {selectedFile ? (\n          <div className=\"flex items-center justify-center gap-2\">\n            <svg\n              className=\"w-8 h-8 text-green-500\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <div>\n              <p className=\"font-medium text-slate-900 dark:text-white\">\n                {selectedFile.name}\n              </p>\n              <p className=\"text-sm text-slate-500 dark:text-slate-400\">\n                {(selectedFile.size / 1024).toFixed(2)} KB\n              </p>\n            </div>\n          </div>\n        ) : (\n          <div>\n            <svg\n              className=\"mx-auto h-12 w-12 text-slate-400\"\n              stroke=\"currentColor\"\n              fill=\"none\"\n              viewBox=\"0 0 48 48\"\n            >\n              <path\n                d=\"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02\"\n                strokeWidth={2}\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n              />\n            </svg>\n            <p className=\"mt-2 text-sm text-slate-600 dark:text-slate-400\">\n              Click to upload or drag and drop\n            </p>\n            <p className=\"text-xs text-slate-500 dark:text-slate-500\">\n              Excel files (.xlsx, .xls)\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAYe,SAAS,WAAW,EACjC,KAAK,EACL,SAAS,YAAY,EACrB,YAAY,EACZ,YAAY,EACZ,WAAW,EACK;IAChB,MAAM,WAAW,IAAA,+MAAM,EAAmB;IAE1C,MAAM,mBAAmB,CAAC;QACxB,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,MAAM;YACR,aAAa;QACf;IACF;IAEA,MAAM,cAAc;QAClB,SAAS,OAAO,EAAE;IACpB;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAM,WAAU;0BACd;;;;;;YAEF,6BACC,8OAAC;gBAAE,WAAU;0BACV;;;;;;0BAGL,8OAAC;gBACC,SAAS;gBACT,WAAU;;kCAEV,8OAAC;wBACC,KAAK;wBACL,MAAK;wBACL,QAAQ;wBACR,UAAU;wBACV,WAAU;;;;;;oBAEX,6BACC,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCACC,WAAU;gCACV,MAAK;gCACL,SAAQ;gCACR,QAAO;0CAEP,cAAA,8OAAC;oCACC,eAAc;oCACd,gBAAe;oCACf,aAAa;oCACb,GAAE;;;;;;;;;;;0CAGN,8OAAC;;kDACC,8OAAC;wCAAE,WAAU;kDACV,aAAa,IAAI;;;;;;kDAEpB,8OAAC;wCAAE,WAAU;;4CACV,CAAC,aAAa,IAAI,GAAG,IAAI,EAAE,OAAO,CAAC;4CAAG;;;;;;;;;;;;;;;;;;6CAK7C,8OAAC;;0CACC,8OAAC;gCACC,WAAU;gCACV,QAAO;gCACP,MAAK;gCACL,SAAQ;0CAER,cAAA,8OAAC;oCACC,GAAE;oCACF,aAAa;oCACb,eAAc;oCACd,gBAAe;;;;;;;;;;;0CAGnB,8OAAC;gCAAE,WAAU;0CAAkD;;;;;;0CAG/D,8OAAC;gCAAE,WAAU;0CAA6C;;;;;;;;;;;;;;;;;;;;;;;;AAQtE","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/ui/Button.tsx"],"sourcesContent":["interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: \"primary\" | \"secondary\" | \"outline\";\n  size?: \"sm\" | \"md\" | \"lg\";\n  children: React.ReactNode;\n}\n\nexport default function Button({\n  variant = \"primary\",\n  size = \"md\",\n  children,\n  className = \"\",\n  ...props\n}: ButtonProps) {\n  const baseStyles = \"font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2\";\n  \n  const variants = {\n    primary: \"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500\",\n    secondary: \"bg-slate-600 hover:bg-slate-700 text-white focus:ring-slate-500\",\n    outline: \"border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 focus:ring-slate-500\",\n  };\n\n  const sizes = {\n    sm: \"px-3 py-1.5 text-sm\",\n    md: \"px-4 py-2 text-base\",\n    lg: \"px-6 py-3 text-lg\",\n  };\n\n  return (\n    <button\n      className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`}\n      {...props}\n    >\n      {children}\n    </button>\n  );\n}\n\n"],"names":[],"mappings":";;;;;;AAMe,SAAS,OAAO,EAC7B,UAAU,SAAS,EACnB,OAAO,IAAI,EACX,QAAQ,EACR,YAAY,EAAE,EACd,GAAG,OACS;IACZ,MAAM,aAAa;IAEnB,MAAM,WAAW;QACf,SAAS;QACT,WAAW;QACX,SAAS;IACX;IAEA,MAAM,QAAQ;QACZ,IAAI;QACJ,IAAI;QACJ,IAAI;IACN;IAEA,qBACE,8OAAC;QACC,WAAW,GAAG,WAAW,CAAC,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,WAAW;QAC1E,GAAG,KAAK;kBAER;;;;;;AAGP","debugId":null}},
    {"offset": {"line": 224, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/ui/UserBadge.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\n\ninterface UserBadgeProps {\n  userName: string;\n  userRole: string;\n  userClient: string;\n  onChangeUser: () => void;\n}\n\nexport default function UserBadge({\n  userName,\n  userRole,\n  userClient,\n  onChangeUser,\n}: UserBadgeProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  return (\n    <div className=\"relative\">\n      {/* Compact Badge */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors\"\n        aria-label=\"User information\"\n      >\n        <svg\n          className=\"w-5 h-5 text-slate-600 dark:text-slate-300\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          stroke=\"currentColor\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            strokeWidth={2}\n            d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"\n          />\n        </svg>\n        <span className=\"text-sm font-medium text-slate-700 dark:text-slate-200 hidden sm:inline\">\n          {userName.split(\" \")[0]}\n        </span>\n        <svg\n          className={`w-4 h-4 text-slate-500 dark:text-slate-400 transition-transform ${\n            isExpanded ? \"rotate-180\" : \"\"\n          }`}\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          stroke=\"currentColor\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            strokeWidth={2}\n            d=\"M19 9l-7 7-7-7\"\n          />\n        </svg>\n      </button>\n\n      {/* Expanded Details */}\n      {isExpanded && (\n        <>\n          {/* Backdrop */}\n          <div\n            className=\"fixed inset-0 z-40\"\n            onClick={() => setIsExpanded(false)}\n          />\n\n          {/* Dropdown */}\n          <div className=\"absolute right-0 mt-2 w-72 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 z-50 overflow-hidden\">\n            {/* User Info */}\n            <div className=\"p-4 border-b border-slate-200 dark:border-slate-700\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center flex-shrink-0\">\n                  <span className=\"text-blue-600 dark:text-blue-300 font-bold text-lg\">\n                    {userName\n                      .split(\" \")\n                      .map((n) => n[0])\n                      .join(\"\")\n                      .toUpperCase()}\n                  </span>\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <h3 className=\"font-semibold text-slate-900 dark:text-white truncate\">\n                    {userName}\n                  </h3>\n                  <p className=\"text-sm text-slate-600 dark:text-slate-400 truncate\">\n                    {userRole}\n                  </p>\n                  <p className=\"text-xs text-slate-500 dark:text-slate-500 mt-1\">\n                    {userClient}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Actions */}\n            <div className=\"p-2\">\n              <button\n                onClick={() => {\n                  setIsExpanded(false);\n                  onChangeUser();\n                }}\n                className=\"w-full text-left px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors flex items-center gap-2\"\n              >\n                <svg\n                  className=\"w-4 h-4\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  stroke=\"currentColor\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"\n                  />\n                </svg>\n                Switch User\n              </button>\n            </div>\n\n            {/* Info Footer */}\n            <div className=\"px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-700\">\n              <p className=\"text-xs text-slate-500 dark:text-slate-500\">\n                Your usage is being tracked for analytics purposes.\n              </p>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAWe,SAAS,UAAU,EAChC,QAAQ,EACR,QAAQ,EACR,UAAU,EACV,YAAY,EACG;IACf,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAE7C,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBACC,SAAS,IAAM,cAAc,CAAC;gBAC9B,WAAU;gBACV,cAAW;;kCAEX,8OAAC;wBACC,WAAU;wBACV,MAAK;wBACL,SAAQ;wBACR,QAAO;kCAEP,cAAA,8OAAC;4BACC,eAAc;4BACd,gBAAe;4BACf,aAAa;4BACb,GAAE;;;;;;;;;;;kCAGN,8OAAC;wBAAK,WAAU;kCACb,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;;;;;;kCAEzB,8OAAC;wBACC,WAAW,CAAC,gEAAgE,EAC1E,aAAa,eAAe,IAC5B;wBACF,MAAK;wBACL,SAAQ;wBACR,QAAO;kCAEP,cAAA,8OAAC;4BACC,eAAc;4BACd,gBAAe;4BACf,aAAa;4BACb,GAAE;;;;;;;;;;;;;;;;;YAMP,4BACC;;kCAEE,8OAAC;wBACC,WAAU;wBACV,SAAS,IAAM,cAAc;;;;;;kCAI/B,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;sDACb,cAAA,8OAAC;gDAAK,WAAU;0DACb,SACE,KAAK,CAAC,KACN,GAAG,CAAC,CAAC,IAAM,CAAC,CAAC,EAAE,EACf,IAAI,CAAC,IACL,WAAW;;;;;;;;;;;sDAGlB,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAG,WAAU;8DACX;;;;;;8DAEH,8OAAC;oDAAE,WAAU;8DACV;;;;;;8DAEH,8OAAC;oDAAE,WAAU;8DACV;;;;;;;;;;;;;;;;;;;;;;;0CAOT,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCACC,SAAS;wCACP,cAAc;wCACd;oCACF;oCACA,WAAU;;sDAEV,8OAAC;4CACC,WAAU;4CACV,MAAK;4CACL,SAAQ;4CACR,QAAO;sDAEP,cAAA,8OAAC;gDACC,eAAc;gDACd,gBAAe;gDACf,aAAa;gDACb,GAAE;;;;;;;;;;;wCAEA;;;;;;;;;;;;0CAMV,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCAAE,WAAU;8CAA6C;;;;;;;;;;;;;;;;;;;;;;;;;AASxE","debugId":null}},
    {"offset": {"line": 449, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/ui/UserManagementModal.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { getAllClients, getAllRoles, getAllUserNames, findUserByName, USERS } from \"@/core/analytics/userDirectory\";\n\ninterface UserManagementModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onUserAdded: () => void;\n  currentUserName: string;\n}\n\ntype ViewMode = \"list\" | \"add\";\n\nexport default function UserManagementModal({\n  isOpen,\n  onClose,\n  onUserAdded,\n  currentUserName,\n}: UserManagementModalProps) {\n  const [viewMode, setViewMode] = useState<ViewMode>(\"list\");\n  const [name, setName] = useState(\"\");\n  const [role, setRole] = useState(\"\");\n  const [client, setClient] = useState(\"\");\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n  const [deletingUser, setDeletingUser] = useState<string | null>(null);\n\n  const existingClients = getAllClients();\n  const existingRoles = getAllRoles();\n  const existingNames = getAllUserNames();\n\n  const roleOptions = [\n    \"Associate Planner\",\n    \"Media Planner\",\n    \"Senior Media Planner\",\n    \"Supervisor\",\n    \"Manager\",\n    \"Senior Manager\",\n    \"Director\",\n    \"Senior Director\",\n    \"VP\",\n  ];\n\n  if (!isOpen) return null;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setSuccess(false);\n\n    if (!name.trim() || !role.trim() || !client.trim()) {\n      setError(\"Please fill in all fields\");\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const response = await fetch(\"/api/analytics/directory\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          name: name.trim(),\n          role: role.trim(),\n          client: client.trim(),\n          isAdmin,\n          requestingUser: currentUserName,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to add user\");\n      }\n\n      setSuccess(true);\n      setName(\"\");\n      setRole(\"\");\n      setClient(\"\");\n      setIsAdmin(false);\n\n      // Notify parent and close after a brief delay\n      setTimeout(() => {\n        onUserAdded();\n        onClose();\n        setSuccess(false);\n      }, 1500);\n    } catch (err) {\n      console.error(\"Failed to add user:\", err);\n      setError(err instanceof Error ? err.message : \"Something went wrong. Please try again.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (!isSubmitting) {\n      setViewMode(\"list\");\n      setName(\"\");\n      setRole(\"\");\n      setClient(\"\");\n      setIsAdmin(false);\n      setError(null);\n      setSuccess(false);\n      onClose();\n    }\n  };\n\n  const handleDeleteUser = async (userName: string, userClient: string) => {\n    if (!confirm(`Are you sure you want to delete ${userName}?`)) {\n      return;\n    }\n\n    setDeletingUser(userName);\n    setError(null);\n\n    try {\n      const currentUser = findUserByName(currentUserName);\n      const response = await fetch(\"/api/analytics/directory\", {\n        method: \"DELETE\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          name: userName,\n          client: userClient,\n          requestingUser: currentUserName,\n          isMasterAdmin: currentUser?.isMasterAdmin || false,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || \"Failed to delete user\");\n      }\n\n      // Reload the page to refresh the user directory\n      window.location.reload();\n    } catch (err) {\n      console.error(\"Failed to delete user:\", err);\n      setError(err instanceof Error ? err.message : \"Failed to delete user\");\n    } finally {\n      setDeletingUser(null);\n    }\n  };\n\n  const currentUser = findUserByName(currentUserName);\n  const isMasterAdmin = currentUser?.isMasterAdmin || false;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"p-6 border-b border-slate-200 dark:border-slate-700\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white\">\n              {viewMode === \"list\" ? \"Manage Users\" : \"Add New User\"}\n            </h2>\n            <button\n              onClick={handleClose}\n              disabled={isSubmitting}\n              className=\"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors disabled:opacity-50\"\n            >\n              <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n          <p className=\"text-slate-600 dark:text-slate-400 mt-2\">\n            {viewMode === \"list\"\n              ? \"View and manage all users in the directory\"\n              : \"Add a new user to the QuickClick Media Suite directory\"}\n          </p>\n        </div>\n\n        {/* User List View */}\n        {viewMode === \"list\" && (\n          <div className=\"p-6\">\n            <div className=\"mb-4 flex justify-between items-center\">\n              <p className=\"text-sm text-slate-600 dark:text-slate-400\">\n                {USERS.length} user{USERS.length !== 1 ? \"s\" : \"\"} in directory\n              </p>\n              <button\n                onClick={() => setViewMode(\"add\")}\n                className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                </svg>\n                Add User\n              </button>\n            </div>\n\n            {error && (\n              <div className=\"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n                <p className=\"text-sm text-red-600 dark:text-red-400\">{error}</p>\n              </div>\n            )}\n\n            <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n              {USERS.map((user) => {\n                const isCurrentUser = user.name === currentUserName;\n                const canDelete = isMasterAdmin || (!user.isAdmin && !isCurrentUser);\n                const isDeleting = deletingUser === user.name;\n\n                return (\n                  <div\n                    key={`${user.name}-${user.client}`}\n                    className=\"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors\"\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <p className=\"font-medium text-slate-900 dark:text-white\">\n                          {user.name}\n                          {isCurrentUser && (\n                            <span className=\"ml-2 text-xs text-blue-600 dark:text-blue-400\">(You)</span>\n                          )}\n                        </p>\n                        {user.isMasterAdmin && (\n                          <span className=\"px-2 py-1 text-xs font-semibold text-purple-700 dark:text-purple-300 bg-purple-100 dark:bg-purple-900/30 rounded\">\n                            Master Admin\n                          </span>\n                        )}\n                        {user.isAdmin && !user.isMasterAdmin && (\n                          <span className=\"px-2 py-1 text-xs font-semibold text-blue-700 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/30 rounded\">\n                            Admin\n                          </span>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-slate-600 dark:text-slate-400\">\n                        {user.role} • {user.client}\n                      </p>\n                    </div>\n\n                    {canDelete && (\n                      <button\n                        onClick={() => handleDeleteUser(user.name, user.client)}\n                        disabled={isDeleting}\n                        className=\"px-3 py-2 text-sm font-medium text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {isDeleting ? \"Deleting...\" : \"Delete\"}\n                      </button>\n                    )}\n                    {!canDelete && !isCurrentUser && (\n                      <span className=\"text-xs text-slate-400 dark:text-slate-500\">\n                        Protected\n                      </span>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            <div className=\"mt-6 flex justify-end\">\n              <button\n                onClick={handleClose}\n                className=\"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors\"\n              >\n                Close\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Add User Form */}\n        {viewMode === \"add\" && (\n          <div className=\"p-6\">\n            <button\n              onClick={() => setViewMode(\"list\")}\n              className=\"mb-4 flex items-center gap-2 text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white transition-colors\"\n            >\n              <svg className=\"w-4 h-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\n              </svg>\n              Back to user list\n            </button>\n\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n          {/* Name */}\n          <div>\n            <label htmlFor=\"name\" className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\n              Full Name\n            </label>\n            <input\n              type=\"text\"\n              id=\"name\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"e.g., John Doe\"\n              disabled={isSubmitting}\n              list=\"existing-names\"\n              className=\"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 disabled:opacity-50\"\n            />\n            <datalist id=\"existing-names\">\n              {existingNames.map((nameOption) => (\n                <option key={nameOption} value={nameOption} />\n              ))}\n            </datalist>\n          </div>\n\n          {/* Role */}\n          <div>\n            <label htmlFor=\"role\" className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\n              Role\n            </label>\n            <input\n              type=\"text\"\n              id=\"role\"\n              value={role}\n              onChange={(e) => setRole(e.target.value)}\n              placeholder=\"Type or select a role...\"\n              disabled={isSubmitting}\n              list=\"existing-roles\"\n              className=\"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 disabled:opacity-50\"\n            />\n            <datalist id=\"existing-roles\">\n              {[...new Set([...roleOptions, ...existingRoles])].sort().map((roleOption) => (\n                <option key={roleOption} value={roleOption} />\n              ))}\n            </datalist>\n            <p className=\"mt-1 text-xs text-slate-500 dark:text-slate-400\">\n              Select from list or type a custom role\n            </p>\n          </div>\n\n          {/* Client */}\n          <div>\n            <label htmlFor=\"client\" className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\n              Client\n            </label>\n            <input\n              type=\"text\"\n              id=\"client\"\n              value={client}\n              onChange={(e) => setClient(e.target.value)}\n              placeholder=\"Type or select a client...\"\n              disabled={isSubmitting}\n              list=\"existing-clients\"\n              className=\"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-slate-700 text-slate-900 dark:text-white placeholder-slate-400 disabled:opacity-50\"\n            />\n            <datalist id=\"existing-clients\">\n              {existingClients.map((clientOption) => (\n                <option key={clientOption} value={clientOption} />\n              ))}\n            </datalist>\n            <p className=\"mt-1 text-xs text-slate-500 dark:text-slate-400\">\n              Select from list or type a custom client\n            </p>\n          </div>\n\n          {/* Admin Checkbox */}\n          {findUserByName(currentUserName)?.isMasterAdmin && (\n            <div className=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                id=\"isAdmin\"\n                checked={isAdmin}\n                onChange={(e) => setIsAdmin(e.target.checked)}\n                disabled={isSubmitting}\n                className=\"w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-2 focus:ring-blue-500 disabled:opacity-50\"\n              />\n              <label htmlFor=\"isAdmin\" className=\"ml-2 text-sm text-slate-700 dark:text-slate-300\">\n                Grant admin privileges (can manage users and view analytics)\n              </label>\n            </div>\n          )}\n          {!findUserByName(currentUserName)?.isMasterAdmin && (\n            <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\n              <p className=\"text-xs text-blue-700 dark:text-blue-300\">\n                Only the Master Admin can grant admin privileges to new users.\n              </p>\n            </div>\n          )}\n\n          {/* Error Message */}\n          {error && (\n            <div className=\"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n              <p className=\"text-sm text-red-600 dark:text-red-400\">{error}</p>\n            </div>\n          )}\n\n          {/* Success Message */}\n          {success && (\n            <div className=\"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\">\n              <p className=\"text-sm text-green-600 dark:text-green-400\">User added successfully!</p>\n            </div>\n          )}\n\n          {/* Buttons */}\n          <div className=\"flex gap-3 pt-4\">\n            <button\n              type=\"button\"\n              onClick={handleClose}\n              disabled={isSubmitting}\n              className=\"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={isSubmitting}\n              className=\"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isSubmitting ? \"Adding...\" : \"Add User\"}\n            </button>\n          </div>\n        </form>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1168, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/ui/Header.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useUser } from \"./AnalyticsProvider\";\nimport UserBadge from \"./UserBadge\";\nimport UserManagementModal from \"./UserManagementModal\";\nimport { clearUserIdentity } from \"@/core/analytics/localStorage\";\n\ninterface HeaderProps {\n  title: string;\n  subtitle: string;\n  showBackButton?: boolean;\n}\n\nexport default function Header({ title, subtitle, showBackButton = false }: HeaderProps) {\n  const userInfo = useUser();\n  const router = useRouter();\n  const [showUserManagement, setShowUserManagement] = useState(false);\n\n  const handleSwitchUser = () => {\n    clearUserIdentity();\n    window.location.reload();\n  };\n\n  return (\n    <>\n    <header className=\"sticky top-0 z-50 border-b border-slate-200 dark:border-slate-700 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md shadow-sm\">\n      <div className=\"max-w-7xl mx-auto px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            {showBackButton && (\n              <Link\n                href=\"/\"\n                className=\"text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white transition-colors\"\n              >\n                <svg\n                  className=\"w-6 h-6\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  stroke=\"currentColor\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M10 19l-7-7m0 0l7-7m-7 7h18\"\n                  />\n                </svg>\n              </Link>\n            )}\n            <div>\n              <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white\">\n                {title}\n              </h1>\n              <p className=\"text-slate-600 dark:text-slate-400 text-sm\">\n                {subtitle}\n              </p>\n            </div>\n          </div>\n\n          {/* Admin Controls and User Badge */}\n          <div className=\"flex items-center gap-3\">\n            {userInfo?.isAdmin && (\n              <>\n                <button\n                  onClick={() => setShowUserManagement(true)}\n                  className=\"px-4 py-2 text-sm font-medium text-slate-700 hover:text-slate-900 dark:text-slate-300 dark:hover:text-white bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 rounded-lg transition-colors flex items-center gap-2\"\n                  title=\"Manage Users\"\n                >\n                  <svg\n                    className=\"w-4 h-4\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"\n                    />\n                  </svg>\n                  Manage Users\n                </button>\n                <Link\n                  href=\"/apps/analytics-dashboard\"\n                  className=\"px-4 py-2 text-sm font-medium text-slate-700 hover:text-slate-900 dark:text-slate-300 dark:hover:text-white bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 rounded-lg transition-colors flex items-center gap-2\"\n                >\n                  <svg\n                    className=\"w-4 h-4\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"\n                    />\n                  </svg>\n                  Analytics\n                </Link>\n              </>\n            )}\n            {userInfo && (\n              <UserBadge\n                userName={userInfo.userName}\n                userRole={userInfo.userRole}\n                userClient={userInfo.userClient}\n                onChangeUser={handleSwitchUser}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n\n    </header>\n\n      {/* User Management Modal */}\n      {userInfo?.isAdmin && (\n        <UserManagementModal\n          isOpen={showUserManagement}\n          onClose={() => setShowUserManagement(false)}\n          onUserAdded={() => {\n            // Reload the page to refresh the user directory\n            window.location.reload();\n          }}\n          currentUserName={userInfo.userName}\n        />\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;;;;;;;;AAgBe,SAAS,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,iBAAiB,KAAK,EAAe;IACrF,MAAM,WAAW,IAAA,8JAAO;IACxB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,iNAAQ,EAAC;IAE7D,MAAM,mBAAmB;QACvB,IAAA,yKAAiB;QACjB,OAAO,QAAQ,CAAC,MAAM;IACxB;IAEA,qBACE;;0BACA,8OAAC;gBAAO,WAAU;0BAChB,cAAA,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;oCACZ,gCACC,8OAAC,uKAAI;wCACH,MAAK;wCACL,WAAU;kDAEV,cAAA,8OAAC;4CACC,WAAU;4CACV,MAAK;4CACL,SAAQ;4CACR,QAAO;sDAEP,cAAA,8OAAC;gDACC,eAAc;gDACd,gBAAe;gDACf,aAAa;gDACb,GAAE;;;;;;;;;;;;;;;;kDAKV,8OAAC;;0DACC,8OAAC;gDAAG,WAAU;0DACX;;;;;;0DAEH,8OAAC;gDAAE,WAAU;0DACV;;;;;;;;;;;;;;;;;;0CAMP,8OAAC;gCAAI,WAAU;;oCACZ,UAAU,yBACT;;0DACE,8OAAC;gDACC,SAAS,IAAM,sBAAsB;gDACrC,WAAU;gDACV,OAAM;;kEAEN,8OAAC;wDACC,WAAU;wDACV,MAAK;wDACL,SAAQ;wDACR,QAAO;kEAEP,cAAA,8OAAC;4DACC,eAAc;4DACd,gBAAe;4DACf,aAAa;4DACb,GAAE;;;;;;;;;;;oDAEA;;;;;;;0DAGR,8OAAC,uKAAI;gDACH,MAAK;gDACL,WAAU;;kEAEV,8OAAC;wDACC,WAAU;wDACV,MAAK;wDACL,SAAQ;wDACR,QAAO;kEAEP,cAAA,8OAAC;4DACC,eAAc;4DACd,gBAAe;4DACf,aAAa;4DACb,GAAE;;;;;;;;;;;oDAEA;;;;;;;;;oCAKX,0BACC,8OAAC,sJAAS;wCACR,UAAU,SAAS,QAAQ;wCAC3B,UAAU,SAAS,QAAQ;wCAC3B,YAAY,SAAS,UAAU;wCAC/B,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAUvB,UAAU,yBACT,8OAAC,gKAAmB;gBAClB,QAAQ;gBACR,SAAS,IAAM,sBAAsB;gBACrC,aAAa;oBACX,gDAAgD;oBAChD,OAAO,QAAQ,CAAC,MAAM;gBACxB;gBACA,iBAAiB,SAAS,QAAQ;;;;;;;;AAK5C","debugId":null}},
    {"offset": {"line": 1389, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/ui/TabPicker.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport Button from \"./Button\";\nimport { TabInfo } from \"@quickclick/shared/excel\";\n\ninterface TabPickerProps {\n  tabs: TabInfo[];\n  onTabSelect: (tabIndex: number) => void;\n  detectedTabIndex?: number;\n  isProcessing?: boolean;\n}\n\n/**\n * TabPicker - UI component for selecting a worksheet tab from Excel file\n * Appears when automatic template detection fails\n */\nexport default function TabPicker({\n  tabs,\n  onTabSelect,\n  detectedTabIndex,\n  isProcessing = false,\n}: TabPickerProps) {\n  const [selectedIndex, setSelectedIndex] = useState<number>(\n    detectedTabIndex ?? (tabs.length > 0 ? tabs[0].index : 0)\n  );\n\n  const handleConfirm = () => {\n    onTabSelect(selectedIndex);\n  };\n\n  if (tabs.length === 0) {\n    return (\n      <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n        <p className=\"text-red-700 dark:text-red-200 text-sm\">\n          No worksheets found in the uploaded file.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-6 space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-start gap-3\">\n        <svg\n          className=\"w-6 h-6 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          stroke=\"currentColor\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            strokeWidth={2}\n            d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n          />\n        </svg>\n        <div>\n          <h3 className=\"text-lg font-semibold text-amber-900 dark:text-amber-100\">\n            Select Worksheet Tab\n          </h3>\n          <p className=\"text-sm text-amber-700 dark:text-amber-300 mt-1\">\n            We couldn't automatically detect the blocking chart template. Please select the correct worksheet tab from your Excel file.\n          </p>\n        </div>\n      </div>\n\n      {/* Tab List */}\n      <div className=\"space-y-2\">\n        {tabs.map((tab) => {\n          const isSelected = selectedIndex === tab.index;\n          const hasTemplate = tab.hasValidTemplate;\n\n          return (\n            <label\n              key={tab.index}\n              className={`\n                flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all\n                ${\n                  isSelected\n                    ? \"border-blue-500 bg-blue-50 dark:bg-blue-900/20\"\n                    : \"border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 bg-white dark:bg-slate-800\"\n                }\n              `}\n            >\n              {/* Radio Button */}\n              <input\n                type=\"radio\"\n                name=\"worksheet-tab\"\n                value={tab.index}\n                checked={isSelected}\n                onChange={() => setSelectedIndex(tab.index)}\n                className=\"w-4 h-4 text-blue-600 focus:ring-blue-500\"\n              />\n\n              {/* Tab Info */}\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-medium text-slate-900 dark:text-white\">\n                    {tab.name}\n                  </span>\n                  {hasTemplate && (\n                    <span\n                      className=\"inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs font-medium rounded\"\n                      title=\"Valid template detected\"\n                    >\n                      <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path\n                          fillRule=\"evenodd\"\n                          d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n                          clipRule=\"evenodd\"\n                        />\n                      </svg>\n                      Template Detected\n                    </span>\n                  )}\n                  {tab.isHidden && (\n                    <span\n                      className=\"inline-flex items-center gap-1 px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-medium rounded\"\n                      title=\"This worksheet is hidden in Excel\"\n                    >\n                      Hidden\n                    </span>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-4 mt-1 text-xs text-slate-600 dark:text-slate-400\">\n                  <span>Tab {tab.index + 1}</span>\n                  <span>•</span>\n                  <span>{tab.rowCount.toLocaleString()} rows</span>\n                </div>\n              </div>\n            </label>\n          );\n        })}\n      </div>\n\n      {/* Action Button */}\n      <div className=\"flex justify-end pt-2\">\n        <Button\n          variant=\"primary\"\n          onClick={handleConfirm}\n          disabled={isProcessing}\n          className=\"min-w-[180px]\"\n        >\n          {isProcessing ? (\n            <span className=\"flex items-center justify-center gap-2\">\n              <svg className=\"animate-spin h-4 w-4\" viewBox=\"0 0 24 24\">\n                <circle\n                  className=\"opacity-25\"\n                  cx=\"12\"\n                  cy=\"12\"\n                  r=\"10\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"4\"\n                  fill=\"none\"\n                />\n                <path\n                  className=\"opacity-75\"\n                  fill=\"currentColor\"\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                />\n              </svg>\n              Processing...\n            </span>\n          ) : (\n            \"Continue with Selected Tab →\"\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAiBe,SAAS,UAAU,EAChC,IAAI,EACJ,WAAW,EACX,gBAAgB,EAChB,eAAe,KAAK,EACL;IACf,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAChD,oBAAoB,CAAC,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,EAAE,CAAC,KAAK,GAAG,CAAC;IAG1D,MAAM,gBAAgB;QACpB,YAAY;IACd;IAEA,IAAI,KAAK,MAAM,KAAK,GAAG;QACrB,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAE,WAAU;0BAAyC;;;;;;;;;;;IAK5D;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,WAAU;wBACV,MAAK;wBACL,SAAQ;wBACR,QAAO;kCAEP,cAAA,8OAAC;4BACC,eAAc;4BACd,gBAAe;4BACf,aAAa;4BACb,GAAE;;;;;;;;;;;kCAGN,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAA2D;;;;;;0CAGzE,8OAAC;gCAAE,WAAU;0CAAkD;;;;;;;;;;;;;;;;;;0BAOnE,8OAAC;gBAAI,WAAU;0BACZ,KAAK,GAAG,CAAC,CAAC;oBACT,MAAM,aAAa,kBAAkB,IAAI,KAAK;oBAC9C,MAAM,cAAc,IAAI,gBAAgB;oBAExC,qBACE,8OAAC;wBAEC,WAAW,CAAC;;gBAEV,EACE,aACI,mDACA,uHACL;cACH,CAAC;;0CAGD,8OAAC;gCACC,MAAK;gCACL,MAAK;gCACL,OAAO,IAAI,KAAK;gCAChB,SAAS;gCACT,UAAU,IAAM,iBAAiB,IAAI,KAAK;gCAC1C,WAAU;;;;;;0CAIZ,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAK,WAAU;0DACb,IAAI,IAAI;;;;;;4CAEV,6BACC,8OAAC;gDACC,WAAU;gDACV,OAAM;;kEAEN,8OAAC;wDAAI,WAAU;wDAAU,MAAK;wDAAe,SAAQ;kEACnD,cAAA,8OAAC;4DACC,UAAS;4DACT,GAAE;4DACF,UAAS;;;;;;;;;;;oDAEP;;;;;;;4CAIT,IAAI,QAAQ,kBACX,8OAAC;gDACC,WAAU;gDACV,OAAM;0DACP;;;;;;;;;;;;kDAKL,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;;oDAAK;oDAAK,IAAI,KAAK,GAAG;;;;;;;0DACvB,8OAAC;0DAAK;;;;;;0DACN,8OAAC;;oDAAM,IAAI,QAAQ,CAAC,cAAc;oDAAG;;;;;;;;;;;;;;;;;;;;uBArDpC,IAAI,KAAK;;;;;gBA0DpB;;;;;;0BAIF,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC,mJAAM;oBACL,SAAQ;oBACR,SAAS;oBACT,UAAU;oBACV,WAAU;8BAET,6BACC,8OAAC;wBAAK,WAAU;;0CACd,8OAAC;gCAAI,WAAU;gCAAuB,SAAQ;;kDAC5C,8OAAC;wCACC,WAAU;wCACV,IAAG;wCACH,IAAG;wCACH,GAAE;wCACF,QAAO;wCACP,aAAY;wCACZ,MAAK;;;;;;kDAEP,8OAAC;wCACC,WAAU;wCACV,MAAK;wCACL,GAAE;;;;;;;;;;;;4BAEA;;;;;;+BAIR;;;;;;;;;;;;;;;;;AAMZ","debugId":null}},
    {"offset": {"line": 1683, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/analytics/brandDirectory.ts"],"sourcesContent":["/**\n * Brand Directory\n *\n * Centralized list of brand names for automatic detection from filenames.\n * This makes it easy to identify which brand a file belongs to without manual input.\n *\n * To add new brands:\n * 1. Add the brand name to the BRANDS array\n * 2. Save the file - changes take effect immediately\n *\n * Brand detection is case-insensitive and works by searching filenames\n * for any of these brand names.\n */\n\nexport const BRANDS = [\n  // ============================================================================\n  // UNILEVER BRANDS\n  // ============================================================================\n\n  // Food & Wellbeing\n  \"Knorr\",\n  \"Hellmann's\",\n  \"UFS\",\n  \"Ben & Jerry's\",\n  \"Breyers\",\n  \"Magnum\",\n  \"Liquid IV\",\n  \"OLLY\",\n\n  // Personal Care\n  \"Dove Deo\",\n  \"Axe Deo\",\n  \"DMC Deo\",\n  \"Degree\",\n  \"Vaseline\",\n  \"TRESemmé\",\n  \"OLLY Skin Cleansing\",\n\n  // Beauty\n  \"TRESemmé\",\n  \"Dove Hair\",\n  \"Shea Hair\",\n  \"Nexxus\",\n  \"DMC Hair\",\n\n  // Add more brands below as needed\n  // Example:\n  // \"Brand Name\",\n];\n\n/**\n * Extract brand name from a filename\n *\n * Searches the filename for any known brand names (case-insensitive).\n * Returns the first match found, or null if no brand is detected.\n *\n * @param filename - The filename to search (e.g., \"Knorr_Campaign_2024.xlsx\")\n * @returns The detected brand name (original casing from BRANDS array), or null\n *\n * @example\n * extractBrandFromFilename(\"Knorr_Campaign_2024.xlsx\") // \"Knorr\"\n * extractBrandFromFilename(\"dove-blocking-chart.xlsx\") // \"Dove\"\n * extractBrandFromFilename(\"random_file.xlsx\") // null\n */\nexport function extractBrandFromFilename(filename: string): string | null {\n  const filenameLower = filename.toLowerCase();\n\n  // Search for each brand name in the filename\n  for (const brand of BRANDS) {\n    const brandLower = brand.toLowerCase();\n\n    // Check if the brand name appears in the filename\n    if (filenameLower.includes(brandLower)) {\n      return brand; // Return the brand with original casing\n    }\n  }\n\n  return null; // No brand detected\n}\n\n/**\n * Check if a filename contains a specific brand\n *\n * @param filename - The filename to check\n * @param brandName - The brand name to look for\n * @returns true if the brand is found in the filename (case-insensitive)\n *\n * @example\n * containsBrand(\"Knorr_Campaign.xlsx\", \"Knorr\") // true\n * containsBrand(\"knorr_campaign.xlsx\", \"Knorr\") // true\n * containsBrand(\"dove_file.xlsx\", \"Knorr\") // false\n */\nexport function containsBrand(filename: string, brandName: string): boolean {\n  return filename.toLowerCase().includes(brandName.toLowerCase());\n}\n\n/**\n * Get all brands sorted alphabetically\n *\n * @returns Array of all brand names sorted A-Z\n */\nexport function getAllBrands(): string[] {\n  return [...BRANDS].sort();\n}\n\n/**\n * Search for brands matching a query\n *\n * @param query - Search term (case-insensitive)\n * @returns Array of brands matching the query\n *\n * @example\n * searchBrands(\"dove\") // [\"Dove\"]\n * searchBrands(\"sun\") // [\"Sunsilk\", \"Sunlight\"]\n */\nexport function searchBrands(query: string): string[] {\n  const queryLower = query.toLowerCase();\n  return BRANDS.filter(brand =>\n    brand.toLowerCase().includes(queryLower)\n  );\n}\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;CAYC;;;;;;;;;;;;AAEM,MAAM,SAAS;IACpB,+EAA+E;IAC/E,kBAAkB;IAClB,+EAA+E;IAE/E,mBAAmB;IACnB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IAEA,gBAAgB;IAChB;IACA;IACA;IACA;IACA;IACA;IACA;IAEA,SAAS;IACT;IACA;IACA;IACA;IACA;CAKD;AAgBM,SAAS,yBAAyB,QAAgB;IACvD,MAAM,gBAAgB,SAAS,WAAW;IAE1C,6CAA6C;IAC7C,KAAK,MAAM,SAAS,OAAQ;QAC1B,MAAM,aAAa,MAAM,WAAW;QAEpC,kDAAkD;QAClD,IAAI,cAAc,QAAQ,CAAC,aAAa;YACtC,OAAO,OAAO,wCAAwC;QACxD;IACF;IAEA,OAAO,MAAM,oBAAoB;AACnC;AAcO,SAAS,cAAc,QAAgB,EAAE,SAAiB;IAC/D,OAAO,SAAS,WAAW,GAAG,QAAQ,CAAC,UAAU,WAAW;AAC9D;AAOO,SAAS;IACd,OAAO;WAAI;KAAO,CAAC,IAAI;AACzB;AAYO,SAAS,aAAa,KAAa;IACxC,MAAM,aAAa,MAAM,WAAW;IACpC,OAAO,OAAO,MAAM,CAAC,CAAA,QACnB,MAAM,WAAW,GAAG,QAAQ,CAAC;AAEjC","debugId":null}},
    {"offset": {"line": 1763, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/core/analytics/tracker.ts"],"sourcesContent":["/**\n * Analytics Tracker\n *\n * Client-side utilities for tracking user actions and file uploads.\n * All tracking is done asynchronously and won't block the UI.\n */\n\nimport { getUserIdentity, getSessionId } from './localStorage';\nimport { extractBrandFromFilename } from './brandDirectory';\nimport {\n  ToolName,\n  ActionType,\n  TrackEventRequest,\n  TrackFileUploadRequest,\n} from './types';\n\n// ============================================================================\n// Track Event\n// ============================================================================\n\nexport async function trackEvent(\n  toolName: ToolName,\n  action: ActionType,\n  metadata?: Record<string, any>\n): Promise<boolean> {\n  try {\n    const identity = getUserIdentity();\n    if (!identity) {\n      console.warn('Cannot track event: User not identified');\n      return false;\n    }\n\n    const sessionId = getSessionId();\n\n    const payload: TrackEventRequest = {\n      user_id: identity.userId,\n      session_id: sessionId,\n      tool_name: toolName,\n      action,\n      metadata,\n    };\n\n    const response = await fetch('/api/analytics/track', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Tracking failed: ${response.statusText}`);\n    }\n\n    return true;\n  } catch (error) {\n    console.error('Failed to track event:', error);\n    return false;\n  }\n}\n\n// ============================================================================\n// Track File Upload\n// ============================================================================\n\nexport async function trackFileUpload(\n  toolName: ToolName,\n  file: File,\n  metadata?: {\n    campaign_name?: string;\n    brand_name?: string;\n    cn_code?: string;\n    row_count?: number;\n  }\n): Promise<boolean> {\n  try {\n    const identity = getUserIdentity();\n    if (!identity) {\n      console.warn('Cannot track file upload: User not identified');\n      return false;\n    }\n\n    // Auto-detect brand name from filename if not provided\n    const detectedBrand = metadata?.brand_name || extractBrandFromFilename(file.name);\n\n    if (detectedBrand) {\n      console.log(`🏷️  Brand detected from filename: ${detectedBrand}`);\n    }\n\n    const payload: TrackFileUploadRequest = {\n      user_id: identity.userId,\n      tool_name: toolName,\n      filename: file.name,\n      file_size: file.size,\n      file_type: file.name.split('.').pop() || 'unknown',\n      ...metadata,\n      brand_name: detectedBrand || metadata?.brand_name, // Use detected brand if available\n    };\n\n    const response = await fetch('/api/analytics/track-upload', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    });\n\n    if (!response.ok) {\n      throw new Error(`File upload tracking failed: ${response.statusText}`);\n    }\n\n    return true;\n  } catch (error) {\n    console.error('Failed to track file upload:', error);\n    return false;\n  }\n}\n\n// ============================================================================\n// Track Page View\n// ============================================================================\n\nexport async function trackPageView(toolName: ToolName): Promise<boolean> {\n  return trackEvent(toolName, 'page_view');\n}\n\n// ============================================================================\n// Track Error\n// ============================================================================\n\nexport async function trackError(\n  toolName: ToolName,\n  errorMessage: string,\n  errorContext?: {\n    filename?: string;\n    errorType?: string;\n    step?: string;\n    stackTrace?: string;\n  }\n): Promise<boolean> {\n  try {\n    const identity = getUserIdentity();\n    if (!identity) {\n      console.warn('Cannot track error: User not identified');\n      return false;\n    }\n\n    const metadata = {\n      error_message: errorMessage,\n      error_type: errorContext?.errorType || 'unknown_error',\n      filename: errorContext?.filename,\n      step: errorContext?.step,\n      stack_trace: errorContext?.stackTrace,\n      timestamp: new Date().toISOString(),\n    };\n\n    console.error(`❌ Error tracked: ${errorMessage}`, metadata);\n\n    return trackEvent(toolName, 'error', metadata);\n  } catch (error) {\n    console.error('Failed to track error:', error);\n    return false;\n  }\n}\n\n// ============================================================================\n// Convenience Tracking Functions\n// ============================================================================\n\nexport const Analytics = {\n  // Traffic Sheet Automation\n  trafficSheetFileUpload: (file: File) =>\n    trackFileUpload('Traffic Sheet Automation', file),\n  trafficSheetPreview: () =>\n    trackEvent('Traffic Sheet Automation', 'preview_data'),\n  trafficSheetGenerate: () =>\n    trackEvent('Traffic Sheet Automation', 'generate'),\n  trafficSheetDownload: () =>\n    trackEvent('Traffic Sheet Automation', 'download'),\n  trafficSheetError: (errorMessage: string, filename?: string, errorType?: string) =>\n    trackError('Traffic Sheet Automation', errorMessage, { filename, errorType }),\n\n  // Taxonomy Generator\n  taxonomyMetadataSubmit: (metadata: {\n    campaign_name?: string;\n    brand_name?: string;\n    cn_code?: string;\n  }) =>\n    trackEvent('Taxonomy Generator', 'metadata_submit', metadata),\n  taxonomyFileUpload: (\n    file: File,\n    metadata?: {\n      campaign_name?: string;\n      brand_name?: string;\n      cn_code?: string;\n    }\n  ) => trackFileUpload('Taxonomy Generator', file, metadata),\n  taxonomyGenerate: (rowCount?: number) =>\n    trackEvent('Taxonomy Generator', 'generate', { row_count: rowCount }),\n  taxonomyExport: (format: string) =>\n    trackEvent('Taxonomy Generator', 'export', { format }),\n  taxonomyCopyTSV: () =>\n    trackEvent('Taxonomy Generator', 'copy_tsv'),\n  taxonomyError: (errorMessage: string, filename?: string, errorType?: string) =>\n    trackError('Taxonomy Generator', errorMessage, { filename, errorType }),\n\n  // Home Page\n  homePageView: () => trackPageView('Home Page'),\n\n  // Generic\n  trackEvent,\n  trackFileUpload,\n  trackPageView,\n  trackError,\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1985, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/config.ts"],"sourcesContent":["/**\n * Shared configuration constants for Excel processing\n * Centralizes all magic numbers, field mappings, and hardcoded values\n * Used by both desktop and web implementations\n */\n\n/**\n * Row Expansion Configuration\n * Defines the hierarchical structure: Campaign Line → Ad Groups → Creative Lines\n *\n * IMPORTANT: Ad group count is now DYNAMIC based on unique audience values\n * in the blocking chart, not hardcoded by platform\n */\nexport const ROW_EXPANSION_CONFIG = {\n  // Always 5 creative lines per ad group\n  CREATIVES_PER_AD_GROUP: 5,\n\n  // Merge level definitions (which fields merge at which level in TRAFFIC SHEET)\n  MERGE_LEVELS: {\n    // Campaign-level fields: span all rows in traffic sheet (varies by ad group count)\n    CAMPAIGN: [\n      'channel',\n      'platform',\n      'mediaType',\n      'objective',\n      'startDate',\n      'endDate',\n      'grossBudget',\n      'netBudget',\n      'language',\n      'placements',\n      'buyType',\n    ] as const,\n\n    // Ad Group-level fields: span 5 rows each (merged across creative lines)\n    AD_GROUP: [\n      'audience',\n      'accuticsCampaignName',\n      'targeting',\n      'target',\n      'kpi',\n    ] as const,\n\n    // Creative-level fields: no merging (unique per row)\n    CREATIVE: ['creativeName', 'creativeFormat', 'adFormat'] as const,\n  },\n\n  // Traffic sheet merge spans (for generation)\n  AD_GROUP_MERGE_SPAN: 5, // Ad group-level fields span 5 rows\n  CREATIVE_MERGE_SPAN: 1, // Creative-level fields don't merge\n} as const;\n\n/**\n * Demographic Extraction Configuration\n * Used to extract demographic codes from Target field for Brand Say Digital\n */\nexport const DEMOGRAPHIC_CONFIG = {\n  // Regex pattern to extract demographic codes from Target field\n  // Matches patterns like: W25-49, M18-44, A18-65, F21-35\n  // Format: [Gender/Age Code][Lower Age]-[Upper Age]\n  DEMO_PATTERN: /\\b([MWFA])(\\d{2})-(\\d{2})\\b/g,\n\n  // Gender/Age code mappings\n  GENDER_CODES: {\n    M: 'Men', // Men/Males\n    W: 'Women', // Women\n    F: 'Women', // Females (alternative)\n    A: 'Adults', // Adults (all genders)\n  } as const,\n\n  // Fallback if no demographic pattern found\n  DEFAULT_DEMO: 'A18+',\n} as const;\n\n/**\n * Traffic Sheet Generation Configuration\n */\nexport const TRAFFIC_SHEET_CONFIG = {\n  // Row expansion\n  CREATIVES_PER_AD_GROUP: ROW_EXPANSION_CONFIG.CREATIVES_PER_AD_GROUP,\n\n  // Row positions\n  HEADER_LABEL_ROW: 8,\n  FIRST_DATA_ROW: 9,\n  TEMPLATE_START_ROW: 9,\n\n  // Header area (rows without borders)\n  HEADER_AREA_START_ROW: 1,\n  HEADER_AREA_END_ROW: 7,\n\n  // Border configuration by tab\n  BORDER_CONFIG: {\n    'Brand Say Digital': {\n      start: 2, // Column B\n      end: 21, // Column U (HEADLINE - last column in template)\n      exclude: [] as number[],\n    },\n    'Brand Say Social': {\n      start: 2, // Column B\n      end: 26, // Column Z\n      exclude: [] as number[],\n    },\n    'Other Say Social': {\n      start: 2, // Column B\n      end: 24, // Column X\n      exclude: [] as number[],\n    },\n  },\n} as const;\n\n/**\n * Blocking Chart Parsing Configuration\n */\nexport const PARSING_CONFIG = {\n  // Header detection\n  MIN_HEADER_CELLS: 3, // Minimum non-empty cells to consider a row as header\n  MAX_METADATA_ROWS: 10, // Maximum rows to scan for metadata before header\n\n  // Required header keywords for validation\n  REQUIRED_HEADER_KEYWORDS: ['channel', 'platform', 'objective'] as const,\n\n  // Budget column exact matches (strict matching to avoid false positives)\n  BUDGET_COLUMN_NAMES: [\n    'Gross Budget',\n    'Net Budget',\n    'Gross Media Cost',\n    'Media Cost',\n    'Working Media Budget',\n    'Budget',\n  ] as const,\n\n  // Impressions column names for campaign line detection\n  IMPRESSIONS_COLUMN_NAMES: [\n    'Est. Impressions',\n    'Estimated Impressions',\n    'Impressions',\n    'Impressions/GRPs',\n  ] as const,\n\n  // Placements column name variations (try in order)\n  PLACEMENTS_COLUMN_NAMES: [\n    'Campaign Details - Placements', // Primary (unified template)\n    'Placements', // Fallback\n    'Placement', // Alternative spelling\n  ] as const,\n\n  // Audience column name variations (for ad group detection)\n  AUDIENCE_COLUMN_NAMES: [\n    'Targeting',          // Primary field\n    'Target',             // Alternative\n    'Audience',           // Alternative\n    'Target Audience',    // Alternative\n  ] as const,\n\n  // Minimum fields for valid campaign line\n  MIN_CAMPAIGN_LINE_FIELDS: 4,\n} as const;\n\n/**\n * Campaign Line Detection Configuration\n * Defines which columns must be merged together to identify a campaign line\n */\nexport const CAMPAIGN_LINE_DETECTION_CONFIG = {\n  // These columns MUST have matching merge spans to identify a campaign line\n  REQUIRED_MERGE_COLUMNS: [\n    'Est. Impressions',             // Primary indicator\n    'Gross Budget',                 // Primary indicator\n    'Campaign Details - Placements', // Primary indicator (triple-merge detection)\n  ] as const,\n\n  // Alternative budget columns to check if primary not found\n  BUDGET_ALTERNATIVES: [\n    'Net Budget',\n    'Gross Media Cost',\n    'Working Media Budget',\n  ] as const,\n\n  // Patterns to exclude from campaign line detection (summary/total rows)\n  EXCLUSION_PATTERNS: [\n    'total',\n    'subtotal',\n    'summary',\n    'variance',\n    'grand total',\n    'mpa budget',\n  ] as const,\n} as const;\n\n/**\n * Ad Group Detection Configuration (NEW - Audience-Based)\n * Defines how ad groups are identified within campaign lines\n */\nexport const AD_GROUP_DETECTION_CONFIG = {\n  // Primary field to group by for ad group detection\n  PRIMARY_GROUPING_FIELD: 'audience',\n\n  // Fallback fields if primary is empty\n  FALLBACK_GROUPING_FIELDS: ['targeting', 'target'] as const,\n\n  // Default ad group name if all grouping fields are empty\n  DEFAULT_AD_GROUP_NAME: 'Unspecified',\n\n  // Minimum rows per ad group (if blocking chart has fewer, pad with empty creatives)\n  MIN_ROWS_PER_AD_GROUP: 5,\n\n  // Maximum rows per ad group (if blocking chart has more, create additional ad groups)\n  MAX_ROWS_PER_AD_GROUP: 5,\n} as const;\n\n/**\n * Categorization Rules Configuration\n * Determines which traffic sheet tab a campaign line goes to\n */\nexport const CATEGORIZATION_CONFIG = {\n  // Channel keywords for Brand Say Digital\n  BRAND_SAY_DIGITAL_KEYWORDS: [\n    'digital video',\n    'digital display',\n    'digital audio',\n    'programmatic',\n    'ctv',\n    'audio',\n    'ooh',\n  ] as const,\n\n  // Social platform identifiers for Brand Say Social\n  SOCIAL_PLATFORMS: [\n    'meta',\n    'facebook',\n    'instagram',\n    'fb',\n    'ig',\n    'tiktok',\n    'tik tok',\n    'pinterest',\n    'pin',\n    'reddit',\n    'snapchat',\n    'snap',\n    'twitter',\n    'x.com',\n    'linkedin',\n  ] as const,\n\n  // Influencer detection keywords for Other Say Social\n  INFLUENCER_KEYWORDS: ['influencer', 'creator'] as const,\n\n  // Section header patterns (excluded from output)\n  SECTION_HEADER_PATTERNS: [\n    'digital video',\n    'digital display',\n    'digital audio',\n    'paid social',\n    'social',\n    'video',\n    'display',\n    'audio',\n  ] as const,\n\n  // Summary row patterns (excluded from tactics)\n  SUMMARY_ROW_PATTERNS: [\n    'mpa budget',\n    'variance',\n    'grand total',\n  ] as const,\n\n  // Non-digital channels excluded from traffic sheet generation\n  // These appear in verification but don't generate traffic sheet rows\n  EXCLUDED_CHANNEL_KEYWORDS: {\n    OOH: ['pattison', 'astral', 'out of home', 'ooh', 'billboard', 'transit', 'outdoor'] as const,\n    TV: ['linear tv', 'television', 'broadcast tv', 'tv broadcast', 'linear television'] as const,\n    RADIO: ['radio', 'am/fm', 'am fm'] as const,\n    PRINT: ['print', 'magazine', 'newspaper', 'press'] as const,\n  } as const,\n} as const;\n\n/**\n * Styling Configuration\n * Excel cell styling rules\n */\nexport const STYLE_CONFIG = {\n  // Header labels that should preserve blue styling\n  HEADER_LABELS: [\n    'OBJECTIVE',\n    'TACTIC',\n    'PLATFORM',\n    'DEMO',\n    'TARGETING DETAILS',\n  ] as const,\n\n  // Template text that should be cleared before writing data\n  TEMPLATE_TEXT_TO_CLEAR: [\n    'Accutics Campaign Name',\n    'Audience',\n    'Accutics Ad Set Name',\n    'CREATIVE TYPE',\n    'DEVICE',\n    'GEO',\n    'LANGUAGE',\n    'START DATE',\n    'END DATE',\n    'KPI Metric',\n  ] as const,\n\n  // Columns that should be merged vertically in traffic sheet blocks\n  MERGEABLE_COLUMN_HEADERS: [\n    'CREATIVE TYPE',\n    'DEVICE',\n    'GEO',\n    'BUY TYPE',\n    'BID TYPE',\n    'AD SET BUDGET',\n    'TARGETING SUMMARY',\n    'CREATIVETYPE', // Brand Say Digital lowercase variant\n  ] as const,\n} as const;\n\n/**\n * Validation Configuration\n * Rules for data quality validation\n */\nexport const VALIDATION_CONFIG = {\n  // Required fields for a valid campaign line\n  REQUIRED_CAMPAIGN_FIELDS: ['channel', 'platform'] as const,\n\n  // Numeric fields that should be validated\n  NUMERIC_FIELDS: [\n    'budget',\n    'grossBudget',\n    'netBudget',\n    'estImpressions',\n    'estCpm',\n    'adServing',\n    'dvCost',\n    'buffer',\n  ] as const,\n\n  // Date fields that should be validated\n  DATE_FIELDS: ['startDate', 'endDate'] as const,\n} as const;\n\n/**\n * Date Formatting Configuration\n */\nexport const DATE_CONFIG = {\n  // Month abbreviations for traffic sheet format (D-MMM-YY)\n  // Example: \"5-Jan-25\" for January 5, 2025\n  MONTH_NAMES: [\n    'Jan',\n    'Feb',\n    'Mar',\n    'Apr',\n    'May',\n    'Jun',\n    'Jul',\n    'Aug',\n    'Sept',\n    'Oct',\n    'Nov',\n    'Dec',\n  ] as const,\n} as const;\n\n/**\n * Template Detection Configuration\n * For identifying blocking chart template versions\n */\nexport const TEMPLATE_CONFIG = {\n  // Minimum extended columns to qualify as \"Extended\" template\n  MIN_EXTENDED_COLUMNS: 2,\n\n  // Detection priority (higher number = higher priority)\n  TEMPLATE_PRIORITY: {\n    'unilever-extended': 2,\n    'unilever-standard': 1,\n  },\n\n  // Maximum rows to scan for headers when detecting template\n  MAX_ROWS_TO_SCAN: 20,\n\n  // Prefer first visible tab if valid template found\n  PREFER_FIRST_VISIBLE: true,\n\n  // Only show visible tabs in picker UI\n  SHOW_HIDDEN_TABS: false,\n} as const;\n"],"names":[],"mappings":"AAAA;;;;CAIC,GAED;;;;;;CAMC;;;;;;;;;;;;;;;;;;;;;;;;AACM,MAAM,uBAAuB;IAClC,uCAAuC;IACvC,wBAAwB;IAExB,+EAA+E;IAC/E,cAAc;QACZ,mFAAmF;QACnF,UAAU;YACR;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QAED,yEAAyE;QACzE,UAAU;YACR;YACA;YACA;YACA;YACA;SACD;QAED,qDAAqD;QACrD,UAAU;YAAC;YAAgB;YAAkB;SAAW;IAC1D;IAEA,6CAA6C;IAC7C,qBAAqB;IACrB,qBAAqB;AACvB;AAMO,MAAM,qBAAqB;IAChC,+DAA+D;IAC/D,wDAAwD;IACxD,mDAAmD;IACnD,cAAc;IAEd,2BAA2B;IAC3B,cAAc;QACZ,GAAG;QACH,GAAG;QACH,GAAG;QACH,GAAG;IACL;IAEA,2CAA2C;IAC3C,cAAc;AAChB;AAKO,MAAM,uBAAuB;IAClC,gBAAgB;IAChB,wBAAwB,qBAAqB,sBAAsB;IAEnE,gBAAgB;IAChB,kBAAkB;IAClB,gBAAgB;IAChB,oBAAoB;IAEpB,qCAAqC;IACrC,uBAAuB;IACvB,qBAAqB;IAErB,8BAA8B;IAC9B,eAAe;QACb,qBAAqB;YACnB,OAAO;YACP,KAAK;YACL,SAAS,EAAE;QACb;QACA,oBAAoB;YAClB,OAAO;YACP,KAAK;YACL,SAAS,EAAE;QACb;QACA,oBAAoB;YAClB,OAAO;YACP,KAAK;YACL,SAAS,EAAE;QACb;IACF;AACF;AAKO,MAAM,iBAAiB;IAC5B,mBAAmB;IACnB,kBAAkB;IAClB,mBAAmB;IAEnB,0CAA0C;IAC1C,0BAA0B;QAAC;QAAW;QAAY;KAAY;IAE9D,yEAAyE;IACzE,qBAAqB;QACnB;QACA;QACA;QACA;QACA;QACA;KACD;IAED,uDAAuD;IACvD,0BAA0B;QACxB;QACA;QACA;QACA;KACD;IAED,mDAAmD;IACnD,yBAAyB;QACvB;QACA;QACA;KACD;IAED,2DAA2D;IAC3D,uBAAuB;QACrB;QACA;QACA;QACA;KACD;IAED,yCAAyC;IACzC,0BAA0B;AAC5B;AAMO,MAAM,iCAAiC;IAC5C,2EAA2E;IAC3E,wBAAwB;QACtB;QACA;QACA;KACD;IAED,2DAA2D;IAC3D,qBAAqB;QACnB;QACA;QACA;KACD;IAED,wEAAwE;IACxE,oBAAoB;QAClB;QACA;QACA;QACA;QACA;QACA;KACD;AACH;AAMO,MAAM,4BAA4B;IACvC,mDAAmD;IACnD,wBAAwB;IAExB,sCAAsC;IACtC,0BAA0B;QAAC;QAAa;KAAS;IAEjD,yDAAyD;IACzD,uBAAuB;IAEvB,oFAAoF;IACpF,uBAAuB;IAEvB,sFAAsF;IACtF,uBAAuB;AACzB;AAMO,MAAM,wBAAwB;IACnC,yCAAyC;IACzC,4BAA4B;QAC1B;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,mDAAmD;IACnD,kBAAkB;QAChB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,qDAAqD;IACrD,qBAAqB;QAAC;QAAc;KAAU;IAE9C,iDAAiD;IACjD,yBAAyB;QACvB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,+CAA+C;IAC/C,sBAAsB;QACpB;QACA;QACA;KACD;IAED,8DAA8D;IAC9D,qEAAqE;IACrE,2BAA2B;QACzB,KAAK;YAAC;YAAY;YAAU;YAAe;YAAO;YAAa;YAAW;SAAU;QACpF,IAAI;YAAC;YAAa;YAAc;YAAgB;YAAgB;SAAoB;QACpF,OAAO;YAAC;YAAS;YAAS;SAAQ;QAClC,OAAO;YAAC;YAAS;YAAY;YAAa;SAAQ;IACpD;AACF;AAMO,MAAM,eAAe;IAC1B,kDAAkD;IAClD,eAAe;QACb;QACA;QACA;QACA;QACA;KACD;IAED,2DAA2D;IAC3D,wBAAwB;QACtB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,mEAAmE;IACnE,0BAA0B;QACxB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH;AAMO,MAAM,oBAAoB;IAC/B,4CAA4C;IAC5C,0BAA0B;QAAC;QAAW;KAAW;IAEjD,0CAA0C;IAC1C,gBAAgB;QACd;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,uCAAuC;IACvC,aAAa;QAAC;QAAa;KAAU;AACvC;AAKO,MAAM,cAAc;IACzB,0DAA0D;IAC1D,0CAA0C;IAC1C,aAAa;QACX;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH;AAMO,MAAM,kBAAkB;IAC7B,6DAA6D;IAC7D,sBAAsB;IAEtB,uDAAuD;IACvD,mBAAmB;QACjB,qBAAqB;QACrB,qBAAqB;IACvB;IAEA,2DAA2D;IAC3D,kBAAkB;IAElB,mDAAmD;IACnD,sBAAsB;IAEtB,sCAAsC;IACtC,kBAAkB;AACpB","debugId":null}},
    {"offset": {"line": 2358, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/utils/PlatformClassifier.ts"],"sourcesContent":["/**\n * Platform Classifier Utility\n * Centralizes all platform-specific logic that was previously scattered across\n * parseBlockingChart.ts, generateTrafficSheet.ts, and trafficSheetWriter.ts\n */\n\nimport type { TrafficSheetTab } from '../types';\n\n/**\n * Platform category for traffic sheet tab routing\n */\nexport type PlatformCategory = 'digital' | 'social' | 'influencer';\n\n/**\n * Determine which traffic sheet tab a campaign line should go to\n * Logic:\n * 1. Check channel first\n * 2. If channel is \"Other Say Social\" or contains \"influencer\"/\"creator\" → Other Say Social\n * 3. For social channels, check ad format for \"influencer\" → Other Say Social\n * 4. Social platforms without influencer → Brand Say Social\n * 5. Everything else → Brand Say Digital\n *\n * @param platform - Platform name from blocking chart\n * @param channel - Channel name from blocking chart (optional)\n * @param adFormat - Ad Format from blocking chart (optional)\n * @returns Traffic sheet tab name\n */\nexport function getTrafficSheetTab(platform: string, channel?: string, adFormat?: string): TrafficSheetTab {\n  const platformLower = (platform || '').toLowerCase();\n  const channelLower = (channel || '').toLowerCase();\n  const adFormatLower = (adFormat || '').toLowerCase();\n\n  // Step 1: Check channel for explicit \"Other Say Social\" or influencer/creator keywords\n  if (channelLower.includes('other say social') ||\n      channelLower.includes('influencer') ||\n      channelLower.includes('creator')) {\n    return 'Other Say Social';\n  }\n\n  // Step 2: Check if it's a social platform\n  const isSocialPlatform = (\n    platformLower.includes('meta') ||\n    platformLower.includes('facebook') ||\n    platformLower.includes('instagram') ||\n    platformLower.includes('tiktok') ||\n    platformLower.includes('pinterest') ||\n    platformLower.includes('snapchat') ||\n    platformLower.includes('twitter') ||\n    platformLower.includes('x.com') ||\n    platformLower.includes('linkedin') ||\n    platformLower.includes('reddit')\n  );\n\n  // Step 3: For social platforms, check ad format for influencer content\n  if (isSocialPlatform) {\n    if (adFormatLower.includes('influencer') || adFormatLower.includes('creator')) {\n      return 'Other Say Social';\n    }\n    return 'Brand Say Social';\n  }\n\n  // Step 4: Everything else → Brand Say Digital (programmatic, display, video, audio)\n  return 'Brand Say Digital';\n}\n\n/**\n * Get platform category for internal logic\n *\n * @param platform - Platform name from blocking chart\n * @returns Platform category\n */\nexport function getPlatformCategory(platform: string): PlatformCategory {\n  const platformLower = (platform || '').toLowerCase();\n\n  // Social platforms\n  if (\n    platformLower.includes('meta') ||\n    platformLower.includes('facebook') ||\n    platformLower.includes('instagram') ||\n    platformLower.includes('tiktok') ||\n    platformLower.includes('pinterest') ||\n    platformLower.includes('snapchat') ||\n    platformLower.includes('twitter') ||\n    platformLower.includes('linkedin') ||\n    platformLower.includes('reddit')\n  ) {\n    return 'social';\n  }\n\n  // Influencer\n  if (\n    platformLower.includes('influencer') ||\n    platformLower.includes('creator')\n  ) {\n    return 'influencer';\n  }\n\n  // Digital (programmatic, display, video, audio)\n  return 'digital';\n}\n\n/**\n * Determine default placements based on platform\n * Used when placements field is empty in blocking chart\n *\n * @param platform - Platform name from blocking chart\n * @param defaultValue - Fallback value if no platform-specific default exists\n * @returns Platform-appropriate placement string\n */\nexport function getDefaultPlacements(platform: string, defaultValue: string = ''): string {\n  const platformLower = (platform || '').toLowerCase();\n\n  if (platformLower.includes('tiktok')) {\n    return 'In-Feed';\n  }\n\n  if (platformLower.includes('meta') || platformLower.includes('facebook') || platformLower.includes('instagram')) {\n    return 'Feeds, Stories, Reels';\n  }\n\n  if (platformLower.includes('pinterest')) {\n    return defaultValue; // Pinterest uses ad format from creative line\n  }\n\n  if (platformLower.includes('snapchat')) {\n    return 'Snap Ads | Story Ads';\n  }\n\n  if (platformLower.includes('linkedin')) {\n    return 'Feed | Sponsored Content';\n  }\n\n  if (platformLower.includes('twitter') || platformLower.includes('x.com')) {\n    return 'Timeline | Trends';\n  }\n\n  // For programmatic/digital, use the provided value or default\n  return defaultValue;\n}\n\n/**\n * Check if a channel should be excluded from traffic sheet\n * (OOH, TV, Radio, Print are planning-only channels)\n *\n * @param channel - Channel name from blocking chart\n * @returns True if channel should be excluded\n */\nexport function isExcludedChannel(channel: string): boolean {\n  const channelLower = (channel || '').toLowerCase();\n\n  return (\n    channelLower.includes('ooh') ||\n    channelLower.includes('out of home') ||\n    channelLower.includes('outdoor') ||\n    channelLower.includes('tv') ||\n    channelLower.includes('television') ||\n    channelLower.includes('radio') ||\n    channelLower.includes('print') ||\n    channelLower.includes('newspaper') ||\n    channelLower.includes('magazine')\n  );\n}\n\n/**\n * Get exclusion reason for excluded channels\n *\n * @param channel - Channel name from blocking chart\n * @returns Exclusion reason string or undefined\n */\nexport function getExclusionReason(channel: string): string | undefined {\n  const channelLower = (channel || '').toLowerCase();\n\n  if (channelLower.includes('ooh') || channelLower.includes('out of home') || channelLower.includes('outdoor')) {\n    return 'OOH (Out of Home) - planning only';\n  }\n\n  if (channelLower.includes('tv') || channelLower.includes('television')) {\n    return 'TV - planning only';\n  }\n\n  if (channelLower.includes('radio')) {\n    return 'Radio - planning only';\n  }\n\n  if (channelLower.includes('print') || channelLower.includes('newspaper') || channelLower.includes('magazine')) {\n    return 'Print - planning only';\n  }\n\n  return undefined;\n}\n\n/**\n * Check if platform is a social platform\n *\n * @param platform - Platform name from blocking chart\n * @returns True if platform is social\n */\nexport function isSocialPlatform(platform: string): boolean {\n  return getPlatformCategory(platform) === 'social';\n}\n\n/**\n * Check if platform is programmatic/digital\n *\n * @param platform - Platform name from blocking chart\n * @returns True if platform is programmatic\n */\nexport function isProgrammaticPlatform(platform: string): boolean {\n  const platformLower = (platform || '').toLowerCase();\n\n  return (\n    platformLower.includes('trade desk') ||\n    platformLower.includes('tradedesk') ||\n    platformLower.includes('dv360') ||\n    platformLower.includes('display & video 360') ||\n    platformLower.includes('amazon') ||\n    platformLower.includes('programmatic')\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2465, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/utils/FieldNormalizer.ts"],"sourcesContent":["/**\n * Field Normalizer Utility\n * Consolidates all field name normalization logic into a single function\n * Replaces scattered normalization across parseBlockingChart, generateTrafficSheet, and trafficSheetWriter\n */\n\n/**\n * Normalize a field name to lowercase alphanumeric (camelCase style)\n * Removes special characters, spaces, and converts to camelCase\n *\n * Examples:\n *   \"Campaign Details - Placements\" → \"campaigndetailsplacements\"\n *   \"Start Date\" → \"startdate\"\n *   \"Gross Budget\" → \"grossbudget\"\n *   \"Est. Impressions\" → \"estimpressions\"\n *\n * @param name - Field name to normalize\n * @returns Normalized field name\n */\nexport function normalizeFieldName(name: string): string {\n  if (!name) return '';\n\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '') // Remove all non-alphanumeric characters\n    .trim();\n}\n\n/**\n * Normalize field name but preserve camelCase structure\n * Used when you want to maintain readability in variable names\n *\n * Examples:\n *   \"Campaign Details - Placements\" → \"campaignDetailsPlacements\"\n *   \"Start Date\" → \"startDate\"\n *   \"Gross Budget\" → \"grossBudget\"\n *\n * @param name - Field name to normalize\n * @returns CamelCase normalized field name\n */\nexport function normalizeFieldNameCamelCase(name: string): string {\n  if (!name) return '';\n\n  const words = name\n    .split(/[^a-zA-Z0-9]+/)\n    .filter(word => word.length > 0);\n\n  if (words.length === 0) return '';\n\n  return words[0].toLowerCase() +\n    words.slice(1)\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join('');\n}\n\n/**\n * Create a mapping of normalized field names to original names\n * Useful for reverse lookup and debugging\n *\n * @param fieldNames - Array of original field names\n * @returns Map of normalized → original names\n */\nexport function createFieldNameMap(fieldNames: string[]): Map<string, string> {\n  const map = new Map<string, string>();\n\n  for (const name of fieldNames) {\n    const normalized = normalizeFieldName(name);\n    if (normalized) {\n      map.set(normalized, name);\n    }\n  }\n\n  return map;\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC,GAED;;;;;;;;;;;;CAYC;;;;;;;;AACM,SAAS,mBAAmB,IAAY;IAC7C,IAAI,CAAC,MAAM,OAAO;IAElB,OAAO,KACJ,WAAW,GACX,OAAO,CAAC,eAAe,IAAI,yCAAyC;KACpE,IAAI;AACT;AAcO,SAAS,4BAA4B,IAAY;IACtD,IAAI,CAAC,MAAM,OAAO;IAElB,MAAM,QAAQ,KACX,KAAK,CAAC,iBACN,MAAM,CAAC,CAAA,OAAQ,KAAK,MAAM,GAAG;IAEhC,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAE/B,OAAO,KAAK,CAAC,EAAE,CAAC,WAAW,KACzB,MAAM,KAAK,CAAC,GACT,GAAG,CAAC,CAAA,OAAQ,KAAK,MAAM,CAAC,GAAG,WAAW,KAAK,KAAK,KAAK,CAAC,GAAG,WAAW,IACpE,IAAI,CAAC;AACZ;AASO,SAAS,mBAAmB,UAAoB;IACrD,MAAM,MAAM,IAAI;IAEhB,KAAK,MAAM,QAAQ,WAAY;QAC7B,MAAM,aAAa,mBAAmB;QACtC,IAAI,YAAY;YACd,IAAI,GAAG,CAAC,YAAY;QACtB;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 2514, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/utils/FieldMapper.ts"],"sourcesContent":["/**\n * Field Mapper Utility\n * Centralizes all field mappings between blocking chart columns and traffic sheet columns\n * Replaces scattered mapping logic across parseBlockingChart, generateTrafficSheet, and trafficSheetWriter\n */\n\nimport type { TrafficSheetTab } from '../types';\nimport { normalizeFieldName } from './FieldNormalizer';\n\n/**\n * Blocking chart column names (exact matches from blocking chart)\n */\nexport const BLOCKING_CHART_COLUMNS = {\n  // Core tactical information\n  CHANNEL: 'Channel',\n  PLATFORM: 'Platform',\n  MEDIA_TYPE: 'Media type',\n  BUY_TYPE: 'Buy Type',\n  OBJECTIVE: 'Objective',\n\n  // Campaign details\n  PLACEMENTS: 'Campaign Details - Placements',\n  ACCUTICS_CAMPAIGN_NAME: 'Accutics Campaign Name',\n  TAGS_REQUIRED: 'Tags Required',\n  MEASUREMENT: 'Measurement',\n  LANGUAGE: 'Language',\n  AD_FORMAT: 'Ad Format',\n\n  // KPI information\n  KPI: 'KPI',\n  KPI_VALUE: 'KPI Value',\n  TARGET: 'Target',\n  TARGETING: 'Targeting',  // Sometimes used instead of Target\n\n  // Budget and metrics (campaign line identifiers)\n  EST_CPM: 'Est. CPM',\n  EST_IMPRESSIONS: 'Est. Impressions',\n  GROSS_BUDGET: 'Gross Budget',\n  NET_BUDGET: 'Net Budget',\n  AD_SERVING: 'Ad Serving',\n  DV_COST: 'DV Cost',\n  BUFFER: 'Buffer (+30%)',\n\n  // Flight dates\n  START_DATE: 'Start Date',\n  END_DATE: 'End Date',\n} as const;\n\n/**\n * Campaign line detection columns (must be merged together)\n */\nexport const CAMPAIGN_LINE_INDICATORS = [\n  'Est. Impressions',  // Primary indicator\n  'Gross Budget',      // Primary indicator\n  'Campaign Details - Placements'  // Primary indicator (added for triple-merge detection)\n] as const;\n\n/**\n * Blocking chart to internal field name mappings\n * Handles all known column name variations\n */\nexport const BLOCKING_CHART_FIELD_MAPPINGS: Record<string, string> = {\n  // Core fields\n  'Channel': 'channel',\n  'Platform': 'platform',\n  'Media type': 'mediaType',\n  'Media Type': 'mediaType',\n  'Buy Type': 'buyType',\n  'Objective': 'objective',\n\n  // Placements/Tactic variations\n  'Campaign Details - Placements': 'placements',\n  'Placements': 'placements',\n  'Placement': 'placements',\n\n  // Accutics naming\n  'Accutics Campaign Name': 'accuticsCampaignName',\n\n  // Metadata\n  'Tags Required': 'tagsRequired',\n  'Measurement': 'measurement',\n  'Language': 'language',\n\n  // Creative format\n  'Ad Format': 'adFormat',\n  'Creative Format': 'creativeFormat',\n\n  // Targeting/KPI\n  'KPI': 'kpi',\n  'KPI Metric': 'kpi',\n  'KPI Value': 'kpiValue',\n  'Target': 'target',\n  'Targeting': 'targeting',\n\n  // Budget fields\n  'Est. CPM': 'estCpm',\n  'Estimated CPM': 'estCpm',\n  'Estimated\\nCPM': 'estCpm',\n  'Est. Impressions': 'estImpressions',\n  'Impressions/GRPs': 'estImpressions',\n  'Gross Budget': 'grossBudget',\n  'Gross Media Cost': 'grossBudget',\n  'Net Budget': 'netBudget',\n  'Working Media Budget': 'netBudget',\n  'Media Cost': 'grossBudget',\n  'Ad Serving': 'adServing',\n  'DV Cost': 'dvCost',\n  'Media Fee Total': 'mediaFeeTotal',\n  'Buffer (+30%)': 'buffer',\n\n  // Dates\n  'Start Date': 'startDate',\n  'End Date': 'endDate',\n\n  // Additional fields\n  'Learning Agenda': 'learningAgenda',\n  'Primary Reporting KPI': 'primaryReportingKpi',\n  'Demo': 'demo',\n  'Tactic': 'tactic',\n};\n\n/**\n * Traffic sheet column mappings by tab\n * Maps internal field names to traffic sheet column names\n */\nexport const TRAFFIC_SHEET_FIELD_MAPPINGS: Record<TrafficSheetTab, Record<string, string>> = {\n  'Brand Say Digital': {\n    // Campaign-level fields\n    'platform': 'Platform',\n    'startDate': 'Start Date',\n    'endDate': 'End Date',\n    'objective': 'Objective',\n    'language': 'Language',\n    'buyType': 'Buy Type',\n    'demo': 'Demo',\n    'placements': 'Tactic',  // Placements → Tactic for digital\n    'accuticsCampaignName': 'Accutics Campaign Name',\n    'creativetype': 'Creative Type',  // Left blank for client\n    'device': 'Device',  // Left blank for client\n    'geo': 'Geo',  // Left blank for client\n\n    // Ad group-level fields\n    'audience': 'Audience',\n    'accuticsAdSetName': 'Accutics Ad Set Name',\n    'kpi': 'KPI Metric',\n    'bidType': 'Bid Type',  // Ad group level - \"Lowest Cost\"\n    'optimizationEvent': 'Optimization Event',  // Creative level - blank\n\n    // Creative-level fields (blank for creative agency)\n    'creativeName': 'Creative Name',\n    'linkToCreative': 'Link to Creative',\n    'postCopy': 'Post Copy',\n    'headline': 'Headline',\n  },\n\n  'Brand Say Social': {\n    // Campaign-level fields\n    'platform': 'Platform',\n    'startDate': 'Start Date',\n    'endDate': 'End Date',\n    'objective': 'Objective',\n    'language': 'Language',\n    'buyType': 'Buy Type',\n    'placements': 'Campaign Name (Taxonomy from Accuitics)',  // Placements → Campaign Name for social\n    'traffickingNotes': 'Trafficking Notes',\n\n    // Ad group-level fields\n    'audience': 'Audience',\n    'adSetName': 'Ad Set Name (Taxonomy from Accuitics)',\n    'targetingSummary': 'Targeting Summary',  // Left blank for client\n    'adGroupPlacements': 'Placements',  // Ad group-level placements\n    'bidType': 'Bid Type',  // Ad group level - \"Lowest Cost\"\n    'optimizationEvent': 'Optimization Event',  // Creative level - blank\n\n    // Creative-level fields (blank for creative agency)\n    'creativeName': 'Creative Name',\n    'linkToCreative': 'Link to Creative',\n    'postCopy': 'Post Copy',\n    'headline': 'Headline',\n    'primaryText': 'Primary Text',\n  },\n\n  'Other Say Social': {\n    // Campaign-level fields\n    'platform': 'Platform',\n    'startDate': 'Start Date',\n    'endDate': 'End Date',\n    'objective': 'Objective',\n    'language': 'Language',\n    'buyType': 'Buy Type',\n    'placements': 'Campaign Name (Taxonomy from Accuitics)',\n    'traffickingNotes': 'Trafficking Notes',\n\n    // Ad group-level fields\n    'audience': 'Audience',\n    'adSetName': 'Ad Set Name (Taxonomy from Accuitics)',\n    'targetingSummary': 'Targeting Summary',\n    'adGroupPlacements': 'Placements',  // Ad group-level placements\n    'bidType': 'Bid Type',  // Ad group level - \"Lowest Cost\"\n    'optimizationEvent': 'Optimization Event',  // Creative level - blank\n\n    // Creative-level fields\n    'creativeName': 'Creative Name',\n    'linkToCreative': 'Link to Creative',\n    'postCopy': 'Post Copy',\n    'headline': 'Headline',\n  },\n};\n\n/**\n * Get internal field name from blocking chart column name\n *\n * @param blockingChartColumn - Column name from blocking chart\n * @returns Internal field name or undefined if not found\n */\nexport function getInternalFieldName(blockingChartColumn: string): string | undefined {\n  // Try direct mapping first\n  if (BLOCKING_CHART_FIELD_MAPPINGS[blockingChartColumn]) {\n    return BLOCKING_CHART_FIELD_MAPPINGS[blockingChartColumn];\n  }\n\n  // Try normalized lookup\n  const normalized = normalizeFieldName(blockingChartColumn);\n  for (const [key, value] of Object.entries(BLOCKING_CHART_FIELD_MAPPINGS)) {\n    if (normalizeFieldName(key) === normalized) {\n      return value;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Get traffic sheet column name from internal field name\n *\n * @param internalFieldName - Internal field name\n * @param tab - Traffic sheet tab\n * @returns Traffic sheet column name or undefined if not found\n */\nexport function getTrafficSheetColumnName(\n  internalFieldName: string,\n  tab: TrafficSheetTab\n): string | undefined {\n  return TRAFFIC_SHEET_FIELD_MAPPINGS[tab][internalFieldName];\n}\n\n/**\n * Build a map of traffic sheet column names to column indexes\n * Used for efficient column lookup during sheet writing\n *\n * @param headers - Array of column header names from traffic sheet template\n * @returns Map of normalized column name → column index\n */\nexport function buildColumnIndexMap(headers: string[]): Map<string, number> {\n  const map = new Map<string, number>();\n\n  headers.forEach((header, index) => {\n    if (header) {\n      // Store both normalized and original for flexible lookup\n      map.set(normalizeFieldName(header), index);\n      map.set(header, index);\n    }\n  });\n\n  return map;\n}\n\n/**\n * Map blocking chart data to internal structure\n *\n * @param blockingChartRow - Raw row data from blocking chart\n * @param headers - Blocking chart column headers\n * @returns Object with internal field names as keys\n */\nexport function mapBlockingChartRowToInternal(\n  blockingChartRow: Record<string, any>,\n  headers: string[]\n): Record<string, any> {\n  const mapped: Record<string, any> = {};\n\n  headers.forEach((header, index) => {\n    const internalField = getInternalFieldName(header);\n    if (internalField && blockingChartRow[header] !== undefined) {\n      mapped[internalField] = blockingChartRow[header];\n    }\n  });\n\n  return mapped;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2742, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/trafficSheetWriter.ts"],"sourcesContent":["/**\n * Traffic Sheet Generator\n * Generates Excel traffic sheets from parsed blocking chart data\n * Handles categorization, merging, and formatting for all three tabs\n */\n\nimport * as ExcelJS from 'exceljs';\nimport type {\n  ParsedBlockingChart,\n  CampaignLine,\n  AdGroup,\n  TrafficSheetTab,\n  CategorizedCampaignLines,\n  MergeInfo,\n} from './types';\nimport { TRAFFIC_SHEET_CONFIG, ROW_EXPANSION_CONFIG, DEMOGRAPHIC_CONFIG, DATE_CONFIG } from './config';\nimport {\n  getTrafficSheetTab,\n  getDefaultPlacements,\n} from './utils/PlatformClassifier';\nimport {\n  TRAFFIC_SHEET_FIELD_MAPPINGS,\n  buildColumnIndexMap,\n} from './utils/FieldMapper';\nimport { normalizeFieldName } from './utils/FieldNormalizer';\n\n/**\n * Traffic Sheet Generator Class\n * Converts parsed campaign lines into formatted Excel traffic sheets\n */\nexport class TrafficSheetGenerator {\n  /**\n   * Generate traffic sheet Excel workbook from parsed blocking chart\n   *\n   * @param parsedChart - Parsed blocking chart data\n   * @param templateBuffer - Optional template file as ArrayBuffer\n   * @returns Excel workbook with traffic sheets\n   */\n  async generate(\n    parsedChart: ParsedBlockingChart,\n    templateBuffer?: ArrayBuffer\n  ): Promise<ExcelJS.Workbook> {\n    // Create or load workbook\n    let workbook: ExcelJS.Workbook;\n\n    if (templateBuffer) {\n      // Load template workbook\n      console.log('📄 Loading template workbook...');\n      workbook = new ExcelJS.Workbook();\n      await workbook.xlsx.load(templateBuffer);\n      console.log('✅ Template loaded successfully');\n\n      // Clear existing data rows (keep headers and formatting)\n      await this.clearTemplateData(workbook);\n    } else {\n      // Create workbook from scratch (fallback)\n      console.log('📄 Creating workbook from scratch (no template provided)');\n      workbook = new ExcelJS.Workbook();\n      await this.createWorkbookFromScratch(workbook);\n    }\n\n    // Categorize campaign lines by tab\n    const categorized = this.categorizeCampaignLines(parsedChart.campaignLines);\n\n    console.log(`📊 Categorization Results:`);\n    console.log(`  Brand Say Digital: ${categorized['Brand Say Digital'].length} lines`);\n    console.log(`  Brand Say Social: ${categorized['Brand Say Social'].length} lines`);\n    console.log(`  Other Say Social: ${categorized['Other Say Social'].length} lines`);\n\n    // Write each tab\n    await this.writeTab(workbook, 'Brand Say Digital', categorized['Brand Say Digital']);\n    await this.writeTab(workbook, 'Brand Say Social', categorized['Brand Say Social']);\n    await this.writeTab(workbook, 'Other Say Social', categorized['Other Say Social']);\n\n    return workbook;\n  }\n\n  /**\n   * Clear template data rows while preserving headers and formatting\n   */\n  private async clearTemplateData(workbook: ExcelJS.Workbook): Promise<void> {\n    const tabs: TrafficSheetTab[] = ['Brand Say Digital', 'Brand Say Social', 'Other Say Social'];\n\n    for (const tabName of tabs) {\n      const worksheet = workbook.getWorksheet(tabName);\n      if (!worksheet) {\n        console.warn(`⚠️  Template missing worksheet: ${tabName}`);\n        continue;\n      }\n\n      // Delete all rows after the header row (row 8)\n      const firstDataRow = TRAFFIC_SHEET_CONFIG.FIRST_DATA_ROW;\n      const lastRow = worksheet.rowCount;\n\n      if (lastRow >= firstDataRow) {\n        // Delete rows in reverse order to avoid index shifting\n        for (let rowNum = lastRow; rowNum >= firstDataRow; rowNum--) {\n          worksheet.spliceRows(rowNum, 1);\n        }\n        console.log(`  🧹 Cleared ${lastRow - firstDataRow + 1} data rows from ${tabName}`);\n      }\n    }\n  }\n\n  /**\n   * Create workbook structure from scratch\n   * Creates three worksheets with basic headers\n   */\n  private async createWorkbookFromScratch(workbook: ExcelJS.Workbook): Promise<void> {\n    // Create three worksheets\n    const bsdSheet = workbook.addWorksheet('Brand Say Digital');\n    const bssSheet = workbook.addWorksheet('Brand Say Social');\n    const ossSheet = workbook.addWorksheet('Other Say Social');\n\n    // Set up basic headers (row 8)\n    this.setupWorksheetHeaders(bsdSheet, 'Brand Say Digital');\n    this.setupWorksheetHeaders(bssSheet, 'Brand Say Social');\n    this.setupWorksheetHeaders(ossSheet, 'Other Say Social');\n  }\n\n  /**\n   * Set up worksheet headers\n   */\n  private setupWorksheetHeaders(worksheet: ExcelJS.Worksheet, tab: TrafficSheetTab): void {\n    const headerRow = worksheet.getRow(TRAFFIC_SHEET_CONFIG.HEADER_LABEL_ROW);\n\n    // Get field mappings for this tab\n    const fieldMappings = TRAFFIC_SHEET_FIELD_MAPPINGS[tab];\n\n    // Write headers\n    let col = 1;\n    for (const [internalName, displayName] of Object.entries(fieldMappings)) {\n      headerRow.getCell(col).value = displayName;\n      col++;\n    }\n\n    headerRow.commit();\n  }\n\n  /**\n   * Categorize campaign lines by traffic sheet tab\n   */\n  private categorizeCampaignLines(\n    campaignLines: CampaignLine[]\n  ): CategorizedCampaignLines {\n    const categorized: CategorizedCampaignLines = {\n      'Brand Say Digital': [],\n      'Brand Say Social': [],\n      'Other Say Social': [],\n    };\n\n    for (const campaignLine of campaignLines) {\n      // Skip excluded channels (OOH, TV, Radio, Print)\n      if (campaignLine.isExcluded) {\n        console.log(`⏭️  Skipping excluded campaign line: ${campaignLine.platform} / ${campaignLine.channel}`);\n        continue;\n      }\n\n      // Determine which tab this campaign line belongs to\n      const tab = getTrafficSheetTab(campaignLine.platform, campaignLine.channel, campaignLine.adFormat);\n      console.log(`📂 Categorizing: Platform=\"${campaignLine.platform}\" Channel=\"${campaignLine.channel}\" AdFormat=\"${campaignLine.adFormat}\" → Tab=\"${tab}\"`);\n      categorized[tab].push(campaignLine);\n    }\n\n    return categorized;\n  }\n\n  /**\n   * Write campaign lines to a worksheet tab\n   */\n  private async writeTab(\n    workbook: ExcelJS.Workbook,\n    tabName: TrafficSheetTab,\n    campaignLines: CampaignLine[]\n  ): Promise<void> {\n    const worksheet = workbook.getWorksheet(tabName);\n    if (!worksheet) {\n      throw new Error(`Worksheet ${tabName} not found`);\n    }\n\n    // Get headers from row 8\n    const headerRow = worksheet.getRow(TRAFFIC_SHEET_CONFIG.HEADER_LABEL_ROW);\n    const headers: string[] = [];\n    headerRow.eachCell((cell, colNumber) => {\n      headers[colNumber - 1] = String(cell.value || '');\n    });\n\n    // Build column index map for fast lookup\n    const columnMap = buildColumnIndexMap(headers);\n\n    // Track current row position\n    let currentRow = TRAFFIC_SHEET_CONFIG.FIRST_DATA_ROW;\n\n    // Track all merges to apply at the end\n    const allMerges: MergeInfo[] = [];\n\n    // Write each campaign line\n    for (const campaignLine of campaignLines) {\n      const merges = this.writeCampaignLine(\n        worksheet,\n        campaignLine,\n        currentRow,\n        tabName,\n        columnMap\n      );\n\n      allMerges.push(...merges);\n\n      // Calculate total rows for this campaign line\n      const totalRows = campaignLine.adGroups.length * ROW_EXPANSION_CONFIG.CREATIVES_PER_AD_GROUP;\n      currentRow += totalRows;\n    }\n\n    // Apply all merges\n    this.applyMerges(worksheet, allMerges);\n\n    // Apply borders\n    this.applyBorders(worksheet, tabName, currentRow - 1);\n\n    // Apply cell alignment (center horizontal, middle vertical)\n    this.applyCellAlignment(worksheet, currentRow - 1);\n\n    // Auto-size columns and rows\n    this.autoSizeColumnsAndRows(worksheet, currentRow - 1);\n  }\n\n  /**\n   * Write a single campaign line to worksheet\n   * Returns merge information for later application\n   */\n  private writeCampaignLine(\n    worksheet: ExcelJS.Worksheet,\n    campaignLine: CampaignLine,\n    startRow: number,\n    tab: TrafficSheetTab,\n    columnMap: Map<string, number>\n  ): MergeInfo[] {\n    const merges: MergeInfo[] = [];\n    const totalRows = campaignLine.adGroups.length * ROW_EXPANSION_CONFIG.CREATIVES_PER_AD_GROUP;\n    const endRow = startRow + totalRows - 1;\n\n    // Write campaign-level fields (merge across all rows)\n    const campaignFields = this.getCampaignLevelFields(campaignLine, tab);\n    for (const [fieldName, value] of Object.entries(campaignFields)) {\n      const colIndex = this.getColumnIndex(columnMap, fieldName, tab);\n      if (colIndex !== undefined) {\n        // Write to first row\n        const firstRow = worksheet.getRow(startRow);\n        firstRow.getCell(colIndex + 1).value = value;\n\n        // Add merge if more than 1 row\n        if (totalRows > 1) {\n          merges.push({\n            startRow,\n            endRow,\n            startCol: colIndex + 1,\n            endCol: colIndex + 1,\n          });\n        }\n      }\n    }\n\n    // Write ad groups\n    let currentRow = startRow;\n    for (const adGroup of campaignLine.adGroups) {\n      const adGroupMerges = this.writeAdGroup(\n        worksheet,\n        adGroup,\n        campaignLine,\n        currentRow,\n        tab,\n        columnMap\n      );\n\n      merges.push(...adGroupMerges);\n      currentRow += ROW_EXPANSION_CONFIG.CREATIVES_PER_AD_GROUP;\n    }\n\n    return merges;\n  }\n\n  /**\n   * Write a single ad group (5 creative lines)\n   */\n  private writeAdGroup(\n    worksheet: ExcelJS.Worksheet,\n    adGroup: AdGroup,\n    campaignLine: CampaignLine,\n    startRow: number,\n    tab: TrafficSheetTab,\n    columnMap: Map<string, number>\n  ): MergeInfo[] {\n    const merges: MergeInfo[] = [];\n    const endRow = startRow + ROW_EXPANSION_CONFIG.CREATIVES_PER_AD_GROUP - 1;\n\n    // Write ad group-level fields (merge across 5 rows)\n    const adGroupFields = this.getAdGroupLevelFields(adGroup, campaignLine, tab);\n    for (const [fieldName, value] of Object.entries(adGroupFields)) {\n      const colIndex = this.getColumnIndex(columnMap, fieldName, tab);\n      if (colIndex !== undefined) {\n        // Write to first row\n        const firstRow = worksheet.getRow(startRow);\n        firstRow.getCell(colIndex + 1).value = value;\n\n        // Add merge for 5 rows\n        merges.push({\n          startRow,\n          endRow,\n          startCol: colIndex + 1,\n          endCol: colIndex + 1,\n        });\n      }\n    }\n\n    // Write creative lines (no merging)\n    for (let i = 0; i < ROW_EXPANSION_CONFIG.CREATIVES_PER_AD_GROUP; i++) {\n      const creative = adGroup.creativeLines[i];\n      const rowNumber = startRow + i;\n\n      const creativeFields = this.getCreativeLevelFields(creative);\n      for (const [fieldName, value] of Object.entries(creativeFields)) {\n        const colIndex = this.getColumnIndex(columnMap, fieldName, tab);\n        if (colIndex !== undefined) {\n          const row = worksheet.getRow(rowNumber);\n          row.getCell(colIndex + 1).value = value;\n        }\n      }\n    }\n\n    return merges;\n  }\n\n  /**\n   * Get campaign-level field values\n   */\n  private getCampaignLevelFields(\n    campaignLine: CampaignLine,\n    tab: TrafficSheetTab\n  ): Record<string, any> {\n    // Determine buy type based on platform and placements\n    // Default is 'Auction' for all tactics, merged at campaign level\n    // Exception: 'Reach & Frequency' only for TikTok Pulse placements\n    let buyType = 'Auction';\n\n    // Check if this is a TikTok Pulse buy\n    const isTikTok = campaignLine.platform?.toLowerCase().includes('tiktok') ||\n                     campaignLine.platform?.toLowerCase().includes('tik tok');\n    const isPulse = campaignLine.placements?.toLowerCase().includes('pulse') ||\n                    campaignLine.adGroups.some(ag => ag.placements?.toLowerCase().includes('pulse'));\n\n    if (isTikTok && isPulse) {\n      buyType = 'Reach & Frequency';\n    }\n    // Note: Do not use buyType from blocking chart - always use 'Auction' except for TikTok Pulse\n\n    const fields: Record<string, any> = {\n      platform: campaignLine.platform,\n      startDate: this.formatDateForTrafficSheet(campaignLine.startDate),\n      endDate: this.formatDateForTrafficSheet(campaignLine.endDate),\n      objective: campaignLine.objective,\n      language: campaignLine.language,\n      buyType: buyType,\n    };\n\n    // Tab-specific fields\n    if (tab === 'Brand Say Digital') {\n      fields.demo = this.extractDemographic(campaignLine.target);\n      fields.placements = campaignLine.placements; // Maps to \"Tactic\" column\n      fields.accuticsCampaignName = campaignLine.accuticsCampaignName;\n    } else {\n      // Social tabs\n      fields.placements = campaignLine.accuticsCampaignName; // Maps to \"Campaign Name (Taxonomy from Accuitics)\"\n\n      // Platform-specific placements (campaign level - merged by platform across ad groups)\n      fields.adGroupPlacements = getDefaultPlacements(\n        campaignLine.platform,\n        campaignLine.adGroups[0]?.placements || ''\n      );\n\n      // Build trafficking notes\n      const notes: string[] = [];\n      if (campaignLine.tagsRequired) {\n        notes.push(`Tags Required: ${campaignLine.tagsRequired}`);\n      }\n      if (campaignLine.adGroups[0]?.measurement) {\n        notes.push(`Measurement: ${campaignLine.adGroups[0].measurement}`);\n      }\n      fields.traffickingNotes = notes.join('\\n');\n    }\n\n    return fields;\n  }\n\n  /**\n   * Get ad group-level field values\n   */\n  private getAdGroupLevelFields(\n    adGroup: AdGroup,\n    campaignLine: CampaignLine,\n    tab: TrafficSheetTab\n  ): Record<string, any> {\n    const fields: Record<string, any> = {\n      audience: adGroup.audience,\n      kpi: adGroup.kpi,\n      bidType: 'Lowest Cost', // Bid Type - always 'Lowest Cost' for all tabs\n    };\n\n    // Tab-specific fields\n    if (tab === 'Brand Say Digital') {\n      fields.accuticsAdSetName = adGroup.accuticsCampaignName;\n    } else {\n      // Social tabs\n      fields.adSetName = adGroup.accuticsCampaignName;\n    }\n\n    return fields;\n  }\n\n  /**\n   * Get creative-level field values\n   */\n  private getCreativeLevelFields(creative: any): Record<string, any> {\n    // Creative fields are typically left blank for creative agency to fill\n    return {\n      creativeName: creative.creativeName || '',\n      linkToCreative: '',\n      postCopy: '',\n      headline: '',\n      optimizationEvent: '', // Optimization Event - left blank\n    };\n  }\n\n  /**\n   * Format date from blocking chart to traffic sheet format\n   * Example: \"2025-01-05\" → \"5-Jan-25\"\n   * Parses the date string directly to avoid timezone conversion issues\n   */\n  private formatDateForTrafficSheet(dateString: string): string {\n    if (!dateString) return '';\n\n    try {\n      // Parse YYYY-MM-DD format directly without creating a Date object\n      const parts = dateString.split('-');\n      if (parts.length !== 3) return dateString;\n\n      const year = parts[0];\n      const monthIndex = parseInt(parts[1], 10) - 1;\n      const day = parseInt(parts[2], 10);\n\n      const monthName = DATE_CONFIG.MONTH_NAMES[monthIndex] || '';\n      const yearShort = year.slice(-2);\n\n      return `${day}-${monthName}-${yearShort}`;\n    } catch (error) {\n      return dateString; // Return original if parsing fails\n    }\n  }\n\n  /**\n   * Extract demographic code from target field\n   * Example: \"W25-49\" from \"Women 25-49 years old\"\n   */\n  private extractDemographic(target?: string): string {\n    if (!target) return DEMOGRAPHIC_CONFIG.DEFAULT_DEMO;\n\n    const match = target.match(DEMOGRAPHIC_CONFIG.DEMO_PATTERN);\n    if (match) {\n      return match[0]; // Return first match (e.g., \"W25-49\")\n    }\n\n    return DEMOGRAPHIC_CONFIG.DEFAULT_DEMO;\n  }\n\n  /**\n   * Get column index from map (try multiple variations)\n   */\n  private getColumnIndex(columnMap: Map<string, number>, fieldName: string, tab: TrafficSheetTab): number | undefined {\n    // First, map the internal field name to the traffic sheet column name\n    const fieldMappings = TRAFFIC_SHEET_FIELD_MAPPINGS[tab];\n    const targetColumnName = fieldMappings[fieldName] || fieldName;\n\n    // Try exact match first\n    if (columnMap.has(targetColumnName)) {\n      return columnMap.get(targetColumnName);\n    }\n\n    // Try normalized match\n    const normalized = normalizeFieldName(targetColumnName);\n    return columnMap.get(normalized);\n  }\n\n  /**\n   * Apply all merge operations to worksheet\n   */\n  private applyMerges(worksheet: ExcelJS.Worksheet, merges: MergeInfo[]): void {\n    for (const merge of merges) {\n      try {\n        worksheet.mergeCells(\n          merge.startRow,\n          merge.startCol,\n          merge.endRow,\n          merge.endCol\n        );\n      } catch (error) {\n        // Merge may already exist or be invalid, skip\n        console.warn(`Failed to merge cells: ${error.message}`);\n      }\n    }\n  }\n\n  /**\n   * Apply borders to data region\n   */\n  private applyBorders(\n    worksheet: ExcelJS.Worksheet,\n    tab: TrafficSheetTab,\n    lastRow: number\n  ): void {\n    const borderConfig = TRAFFIC_SHEET_CONFIG.BORDER_CONFIG[tab];\n    if (!borderConfig) return;\n\n    const borderStyle = {\n      style: 'thin' as const,\n      color: { argb: 'FF000000' },\n    };\n\n    // Apply borders to data region\n    for (let row = TRAFFIC_SHEET_CONFIG.FIRST_DATA_ROW; row <= lastRow; row++) {\n      for (let col = borderConfig.start; col <= borderConfig.end; col++) {\n        const cell = worksheet.getRow(row).getCell(col);\n        cell.border = {\n          top: borderStyle,\n          left: borderStyle,\n          bottom: borderStyle,\n          right: borderStyle,\n        };\n      }\n    }\n  }\n\n  /**\n   * Apply center horizontal and middle vertical alignment to all cells\n   */\n  private applyCellAlignment(\n    worksheet: ExcelJS.Worksheet,\n    lastRow: number\n  ): void {\n    // Apply alignment to all data rows (starting from first data row)\n    for (let rowNum = TRAFFIC_SHEET_CONFIG.FIRST_DATA_ROW; rowNum <= lastRow; rowNum++) {\n      const row = worksheet.getRow(rowNum);\n      row.eachCell((cell) => {\n        cell.alignment = {\n          horizontal: 'center',\n          vertical: 'middle',\n          wrapText: true, // Enable text wrapping for better visibility\n        };\n      });\n    }\n\n    // Also apply alignment to header row\n    const headerRow = worksheet.getRow(TRAFFIC_SHEET_CONFIG.HEADER_LABEL_ROW);\n    headerRow.eachCell((cell) => {\n      cell.alignment = {\n        horizontal: 'center',\n        vertical: 'middle',\n        wrapText: true,\n      };\n    });\n  }\n\n  /**\n   * Auto-size columns and rows to fit content\n   */\n  private autoSizeColumnsAndRows(\n    worksheet: ExcelJS.Worksheet,\n    lastRow: number\n  ): void {\n    // Auto-size columns based on content\n    worksheet.columns.forEach((column, index) => {\n      if (!column) return;\n\n      let maxLength = 0;\n      const columnNumber = index + 1;\n\n      // Check header row\n      const headerCell = worksheet.getRow(TRAFFIC_SHEET_CONFIG.HEADER_LABEL_ROW).getCell(columnNumber);\n      if (headerCell.value) {\n        maxLength = String(headerCell.value).length;\n      }\n\n      // Check all data rows\n      for (let rowNum = TRAFFIC_SHEET_CONFIG.FIRST_DATA_ROW; rowNum <= lastRow; rowNum++) {\n        const cell = worksheet.getRow(rowNum).getCell(columnNumber);\n        if (cell.value) {\n          const cellLength = String(cell.value).length;\n          if (cellLength > maxLength) {\n            maxLength = cellLength;\n          }\n        }\n      }\n\n      // Set column width with some padding (minimum 10, maximum 50)\n      column.width = Math.min(Math.max(maxLength + 2, 10), 50);\n    });\n\n    // Auto-size rows (set minimum height for better visibility)\n    for (let rowNum = TRAFFIC_SHEET_CONFIG.FIRST_DATA_ROW; rowNum <= lastRow; rowNum++) {\n      const row = worksheet.getRow(rowNum);\n      // Set minimum row height to 20 for better visibility\n      row.height = Math.max(row.height || 0, 20);\n    }\n\n    // Set header row height\n    const headerRow = worksheet.getRow(TRAFFIC_SHEET_CONFIG.HEADER_LABEL_ROW);\n    headerRow.height = Math.max(headerRow.height || 0, 25);\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3197, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/parser/BlockingChartParser.ts"],"sourcesContent":["/**\n * Blocking Chart Parser\n * Parses Excel blocking charts and builds hierarchical campaign line structure\n * with dynamic ad group detection based on audience values\n */\n\nimport * as ExcelJS from 'exceljs';\nimport type {\n  ParsedBlockingChart,\n  CampaignLine,\n  AdGroup,\n  CreativeLine,\n  ValidationWarning,\n  CampaignLineRange,\n} from '../types';\nimport {\n  PARSING_CONFIG,\n  CAMPAIGN_LINE_DETECTION_CONFIG,\n  AD_GROUP_DETECTION_CONFIG,\n  ROW_EXPANSION_CONFIG,\n} from '../config';\nimport {\n  BLOCKING_CHART_FIELD_MAPPINGS,\n  getInternalFieldName,\n  CAMPAIGN_LINE_INDICATORS,\n} from '../utils/FieldMapper';\nimport { normalizeFieldName } from '../utils/FieldNormalizer';\nimport { isExcludedChannel, getExclusionReason } from '../utils/PlatformClassifier';\n\n/**\n * Blocking Chart Parser Class\n * Converts Excel blocking chart into structured campaign line data\n */\nexport class BlockingChartParser {\n  private validationWarnings: ValidationWarning[] = [];\n\n  /**\n   * Parse blocking chart Excel file into structured campaign lines\n   *\n   * @param fileBuffer - ArrayBuffer containing the Excel file data\n   * @returns Parsed blocking chart with hierarchical campaign line structure\n   */\n  async parse(fileBuffer: ArrayBuffer): Promise<ParsedBlockingChart> {\n    this.validationWarnings = [];\n\n    // Load workbook\n    const workbook = new ExcelJS.Workbook();\n    await workbook.xlsx.load(fileBuffer);\n\n    // Get first worksheet\n    const worksheet = workbook.worksheets[0];\n    if (!worksheet) {\n      throw new Error('No worksheets found in blocking chart');\n    }\n\n    // Find header row and extract headers\n    const { headerRow, headers } = this.findHeaderRow(worksheet);\n    if (!headerRow || headers.length === 0) {\n      throw new Error('Could not find header row in blocking chart');\n    }\n\n    // Extract metadata from rows above header\n    const metadata = this.extractMetadata(worksheet, headerRow);\n\n    // Detect campaign lines by finding merged cells\n    const campaignLineRanges = this.detectCampaignLines(worksheet, headerRow, headers);\n\n    if (campaignLineRanges.length === 0) {\n      this.addWarning('warning', 'No campaign lines detected in blocking chart', undefined, undefined);\n    }\n\n    // Build campaign lines with audience-based ad group detection\n    const campaignLines = this.buildCampaignLines(\n      worksheet,\n      headers,\n      campaignLineRanges,\n      headerRow\n    );\n\n    return {\n      headers,\n      campaignLines,\n      validationWarnings: this.validationWarnings,\n      metadata,\n    };\n  }\n\n  /**\n   * Find header row in worksheet\n   * Header row contains column names like \"Channel\", \"Platform\", etc.\n   */\n  private findHeaderRow(worksheet: ExcelJS.Worksheet): {\n    headerRow: number;\n    headers: string[];\n  } {\n    const maxRows = Math.min(worksheet.rowCount, PARSING_CONFIG.MAX_METADATA_ROWS + 5);\n\n    for (let rowNumber = 1; rowNumber <= maxRows; rowNumber++) {\n      const row = worksheet.getRow(rowNumber);\n      const values: string[] = [];\n      let nonEmptyCount = 0;\n\n      row.eachCell({ includeEmpty: false }, (cell, colNumber) => {\n        const value = String(cell.value || '').trim();\n        values[colNumber - 1] = value;\n        if (value) nonEmptyCount++;\n      });\n\n      // Check if this row has enough non-empty cells and contains required keywords\n      if (nonEmptyCount >= PARSING_CONFIG.MIN_HEADER_CELLS) {\n        const normalizedValues = values.map(v => normalizeFieldName(v));\n        const hasRequiredKeywords = PARSING_CONFIG.REQUIRED_HEADER_KEYWORDS.every(keyword =>\n          normalizedValues.some(v => v.includes(keyword))\n        );\n\n        if (hasRequiredKeywords) {\n          return { headerRow: rowNumber, headers: values };\n        }\n      }\n    }\n\n    throw new Error('Header row not found in blocking chart');\n  }\n\n  /**\n   * Extract metadata from rows above header (campaign name, client, etc.)\n   */\n  private extractMetadata(\n    worksheet: ExcelJS.Worksheet,\n    headerRow: number\n  ): ParsedBlockingChart['metadata'] {\n    const metadata: ParsedBlockingChart['metadata'] = {};\n\n    // Scan rows above header for metadata\n    for (let rowNumber = 1; rowNumber < headerRow; rowNumber++) {\n      const row = worksheet.getRow(rowNumber);\n      const firstCell = row.getCell(1).value;\n      const secondCell = row.getCell(2).value;\n\n      const label = String(firstCell || '').toLowerCase().trim();\n      const value = String(secondCell || '').trim();\n\n      if (label.includes('campaign') && value) {\n        metadata.campaignName = value;\n      } else if (label.includes('client') && value) {\n        metadata.client = value;\n      } else if (label.includes('brand') && value) {\n        metadata.brand = value;\n      } else if (label.includes('date') && value) {\n        metadata.dateRange = value;\n      }\n    }\n\n    return metadata;\n  }\n\n  /**\n   * Detect campaign lines by finding merged cells across budget, impressions, and placements columns\n   * A campaign line is identified when these three columns are merged together\n   */\n  private detectCampaignLines(\n    worksheet: ExcelJS.Worksheet,\n    headerRow: number,\n    headers: string[]\n  ): CampaignLineRange[] {\n    // Find column indexes for the three required merge indicators\n    const budgetColIndex = this.findColumnIndex(headers, ['Gross Budget', 'Net Budget', 'Media Cost', 'Working Media Budget']);\n    const impressionsColIndex = this.findColumnIndex(headers, ['Est. Impressions', 'Impressions/GRPs', 'Impressions']);\n    const placementsColIndex = this.findColumnIndex(headers, ['Campaign Details - Placements', 'Placements']);\n\n    console.log('🔍 Column Detection:');\n    console.log('  Budget column index:', budgetColIndex);\n    console.log('  Impressions column index:', impressionsColIndex);\n    console.log('  Placements column index:', placementsColIndex);\n    console.log('  Available headers:', headers.filter(h => h));\n\n    if (budgetColIndex === -1 || impressionsColIndex === -1 || placementsColIndex === -1) {\n      this.addWarning(\n        'error',\n        `Required columns not found - Budget: ${budgetColIndex}, Impressions: ${impressionsColIndex}, Placements: ${placementsColIndex}`,\n        undefined,\n        undefined\n      );\n      return [];\n    }\n\n    // Collect all merge ranges for these columns\n    const budgetMerges = new Map<number, number>(); // masterRow → span\n    const impressionsMerges = new Map<number, number>();\n    const placementsMerges = new Map<number, number>();\n\n    // Helper function to get column letter from index\n    const getColumnLetter = (index: number): string => {\n      let letter = '';\n      let temp = index;\n      while (temp >= 0) {\n        letter = String.fromCharCode(65 + (temp % 26)) + letter;\n        temp = Math.floor(temp / 26) - 1;\n      }\n      return letter;\n    };\n\n    // ExcelJS exposes merged cells through worksheet.model.merges\n    // Merges are stored as strings like \"A1:A5\"\n    const merges = (worksheet as any).model?.merges || [];\n    console.log(`📋 Total merge cells found: ${merges.length}`);\n\n    for (const mergeRange of merges) {\n      // Parse merge range (e.g., \"A1:A5\")\n      const match = mergeRange.match(/([A-Z]+)(\\d+):([A-Z]+)(\\d+)/);\n      if (!match) continue;\n\n      const startCol = match[1];\n      const startRow = parseInt(match[2]);\n      const endCol = match[3];\n      const endRow = parseInt(match[4]);\n      const span = endRow - startRow + 1;\n\n      // Skip if merge is in header or only 1 row\n      if (startRow <= headerRow || span <= 1) continue;\n\n      // Check if this merge is in one of our target columns\n      const budgetCol = getColumnLetter(budgetColIndex);\n      const impressionsCol = getColumnLetter(impressionsColIndex);\n      const placementsCol = getColumnLetter(placementsColIndex);\n\n      if (startCol === budgetCol && endCol === budgetCol) {\n        budgetMerges.set(startRow, span);\n      }\n\n      if (startCol === impressionsCol && endCol === impressionsCol) {\n        impressionsMerges.set(startRow, span);\n      }\n\n      if (startCol === placementsCol && endCol === placementsCol) {\n        placementsMerges.set(startRow, span);\n      }\n    }\n\n    // Find matching merges (all three columns merged with same span at same master row)\n    const campaignLineRanges: CampaignLineRange[] = [];\n\n    console.log(`🔗 Budget merges found: ${budgetMerges.size}`);\n    console.log('   Budget merge rows:', Array.from(budgetMerges.keys()));\n    console.log(`🔗 Impressions merges found: ${impressionsMerges.size}`);\n    console.log('   Impressions merge rows:', Array.from(impressionsMerges.keys()));\n    console.log(`🔗 Placements merges found: ${placementsMerges.size}`);\n    console.log('   Placements merge rows:', Array.from(placementsMerges.keys()));\n\n    // Strategy 1: Find triple-merged campaign lines (2+ ad groups)\n    for (const [masterRow, budgetSpan] of budgetMerges.entries()) {\n      const impressionsSpan = impressionsMerges.get(masterRow);\n      const placementsSpan = placementsMerges.get(masterRow);\n\n      // All three must match to be a valid campaign line\n      if (impressionsSpan === budgetSpan && placementsSpan === budgetSpan) {\n        // Verify this is not a summary/total row\n        if (!this.isSummaryRow(worksheet, masterRow, headers)) {\n          campaignLineRanges.push({\n            masterRow,\n            span: budgetSpan,\n            endRow: masterRow + budgetSpan - 1,\n          });\n        }\n      }\n    }\n\n    // Strategy 2: Find single-row campaign lines (1 ad group - no merges)\n    // Look for data rows that have budget, impressions, and placements filled but not merged\n    const detectedRows = new Set(campaignLineRanges.flatMap(r =>\n      Array.from({ length: r.span }, (_, i) => r.masterRow + i)\n    ));\n\n    const lastDataRow = Math.min(worksheet.rowCount, headerRow + 100);\n    console.log(`🔍 Scanning rows ${headerRow + 1} to ${lastDataRow} for single-row campaign lines...`);\n\n    for (let rowNum = headerRow + 1; rowNum <= lastDataRow; rowNum++) {\n      // Skip if already detected as part of a merged campaign line\n      if (detectedRows.has(rowNum)) continue;\n\n      const row = worksheet.getRow(rowNum);\n      const budgetValue = row.getCell(budgetColIndex + 1).value;\n      const impressionsValue = row.getCell(impressionsColIndex + 1).value;\n      const placementsValue = row.getCell(placementsColIndex + 1).value;\n\n      // Check if this row has all three key values filled\n      if (budgetValue && impressionsValue && placementsValue) {\n        // Skip rows that look like headers (values match header text)\n        const budgetStr = String(budgetValue).trim().toLowerCase();\n        const impressionsStr = String(impressionsValue).trim().toLowerCase();\n        const placementsStr = String(placementsValue).trim().toLowerCase();\n\n        const isHeaderRow = (\n          budgetStr.includes('budget') || budgetStr.includes('cost') ||\n          impressionsStr.includes('impression') || impressionsStr.includes('grp') ||\n          placementsStr.includes('placement')\n        );\n\n        if (isHeaderRow) {\n          console.log(`  ⏭️  Skipping header-like row at ${rowNum}`);\n          continue;\n        }\n\n        // Verify this is not a summary/total row\n        if (!this.isSummaryRow(worksheet, rowNum, headers)) {\n          console.log(`  ✅ Found single-row campaign line at row ${rowNum}`);\n          campaignLineRanges.push({\n            masterRow: rowNum,\n            span: 1,\n            endRow: rowNum,\n          });\n          detectedRows.add(rowNum);\n        }\n      }\n    }\n\n    return campaignLineRanges.sort((a, b) => a.masterRow - b.masterRow);\n  }\n\n  /**\n   * Check if a row is a summary/total row (should be excluded)\n   */\n  private isSummaryRow(worksheet: ExcelJS.Worksheet, rowNumber: number, headers: string[]): boolean {\n    const row = worksheet.getRow(rowNumber);\n    const values: Record<string, any> = {};\n\n    headers.forEach((header, index) => {\n      const cell = row.getCell(index + 1);\n      values[header] = cell.value;\n    });\n\n    // Check for exclusion patterns in text fields\n    const textFields = [values['Channel'], values['Platform'], values['Campaign Details - Placements']];\n    const textContent = textFields\n      .filter(v => v)\n      .map(v => String(v).toLowerCase())\n      .join(' ');\n\n    for (const pattern of CAMPAIGN_LINE_DETECTION_CONFIG.EXCLUSION_PATTERNS) {\n      if (textContent.includes(pattern)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Build campaign lines with audience-based ad group detection\n   */\n  private buildCampaignLines(\n    worksheet: ExcelJS.Worksheet,\n    headers: string[],\n    campaignLineRanges: CampaignLineRange[],\n    headerRow: number\n  ): CampaignLine[] {\n    const campaignLines: CampaignLine[] = [];\n\n    for (let index = 0; index < campaignLineRanges.length; index++) {\n      const range = campaignLineRanges[index];\n\n      try {\n        const campaignLine = this.buildCampaignLine(\n          worksheet,\n          headers,\n          range,\n          index\n        );\n\n        campaignLines.push(campaignLine);\n      } catch (error) {\n        this.addWarning(\n          'error',\n          `Failed to parse campaign line at row ${range.masterRow}: ${error.message}`,\n          undefined,\n          range.masterRow\n        );\n      }\n    }\n\n    return campaignLines;\n  }\n\n  /**\n   * Build a single campaign line with dynamic ad group detection\n   */\n  private buildCampaignLine(\n    worksheet: ExcelJS.Worksheet,\n    headers: string[],\n    range: CampaignLineRange,\n    campaignLineIndex: number\n  ): CampaignLine {\n    // Extract all rows in this campaign line\n    const rows: Record<string, any>[] = [];\n    for (let rowNum = range.masterRow; rowNum <= range.endRow; rowNum++) {\n      const rowData = this.extractRowData(worksheet, rowNum, headers);\n      rows.push(rowData);\n    }\n\n    // Get campaign-level data from first row\n    const firstRow = rows[0];\n\n    // Detect ad groups by grouping rows by audience\n    const adGroups = this.detectAdGroupsByAudience(rows, headers);\n\n    // Build campaign line\n    const campaignLine: CampaignLine = {\n      // Campaign-level fields (from first row)\n      channel: firstRow.channel || '',\n      platform: firstRow.platform || '',\n      mediaType: firstRow.mediaType,\n      objective: firstRow.objective || '',\n      language: firstRow.language,\n      target: firstRow.target,\n      startDate: firstRow.startDate || '',\n      endDate: firstRow.endDate || '',\n\n      // Budget information\n      grossBudget: firstRow.grossBudget,\n      netBudget: firstRow.netBudget,\n      estImpressions: firstRow.estImpressions,\n      estCpm: firstRow.estCpm,\n      adServing: firstRow.adServing,\n      dvCost: firstRow.dvCost,\n      buffer: firstRow.buffer,\n\n      // Campaign-level placements and naming\n      placements: firstRow.placements,\n      accuticsCampaignName: firstRow.accuticsCampaignName,\n\n      // Additional metadata\n      adFormat: firstRow.adFormat,\n      buyType: firstRow.buyType,\n      tagsRequired: firstRow.tagsRequired,\n\n      // Exclusion check\n      isExcluded: isExcludedChannel(firstRow.channel || ''),\n      excludedReason: getExclusionReason(firstRow.channel || ''),\n\n      // Ad groups (dynamically detected)\n      adGroups,\n\n      // Validation warnings\n      validationWarnings: [],\n\n      // Tracking metadata\n      _sourceRowNumbers: Array.from(\n        { length: range.span },\n        (_, i) => range.masterRow + i\n      ),\n      blockingChartRowCount: range.span,\n      stableIndex: campaignLineIndex,\n    };\n\n    // Validate campaign line\n    this.validateCampaignLine(campaignLine);\n\n    return campaignLine;\n  }\n\n  /**\n   * Detect ad groups by grouping rows by audience field\n   * Each unique audience value = 1 ad group with 5 creative lines\n   */\n  private detectAdGroupsByAudience(\n    rows: Record<string, any>[],\n    headers: string[]\n  ): AdGroup[] {\n    // Find audience column\n    const audienceField = this.findAudienceField(rows);\n\n    // Group rows by audience value\n    const rowsByAudience = new Map<string, Record<string, any>[]>();\n\n    for (const row of rows) {\n      const audienceValue =\n        row[audienceField] ||\n        AD_GROUP_DETECTION_CONFIG.DEFAULT_AD_GROUP_NAME;\n\n      if (!rowsByAudience.has(audienceValue)) {\n        rowsByAudience.set(audienceValue, []);\n      }\n      rowsByAudience.get(audienceValue)!.push(row);\n    }\n\n    // Build ad groups\n    const adGroups: AdGroup[] = [];\n\n    for (const [audienceName, audienceRows] of rowsByAudience.entries()) {\n      const adGroup = this.buildAdGroup(audienceName, audienceRows);\n      adGroups.push(adGroup);\n    }\n\n    return adGroups;\n  }\n\n  /**\n   * Find which field to use for audience grouping\n   */\n  private findAudienceField(rows: Record<string, any>[]): string {\n    // Try primary field first\n    if (rows.some(r => r[AD_GROUP_DETECTION_CONFIG.PRIMARY_GROUPING_FIELD])) {\n      return AD_GROUP_DETECTION_CONFIG.PRIMARY_GROUPING_FIELD;\n    }\n\n    // Try fallback fields\n    for (const field of AD_GROUP_DETECTION_CONFIG.FALLBACK_GROUPING_FIELDS) {\n      if (rows.some(r => r[field])) {\n        return field;\n      }\n    }\n\n    // Default to primary\n    return AD_GROUP_DETECTION_CONFIG.PRIMARY_GROUPING_FIELD;\n  }\n\n  /**\n   * Build a single ad group with exactly 5 creative lines\n   */\n  private buildAdGroup(\n    audienceName: string,\n    audienceRows: Record<string, any>[]\n  ): AdGroup {\n    // Get ad group-level data from first row\n    const firstRow = audienceRows[0];\n\n    // Always create exactly 5 creative lines\n    const creativeLines: CreativeLine[] = [];\n    for (let i = 0; i < ROW_EXPANSION_CONFIG.CREATIVES_PER_AD_GROUP; i++) {\n      const sourceRow = audienceRows[i] || {}; // Use empty object if fewer than 5 rows\n\n      creativeLines.push({\n        creativeName: sourceRow.creativeName,\n        creativeFormat: sourceRow.creativeFormat,\n        adFormat: sourceRow.adFormat,\n      });\n    }\n\n    return {\n      // Ad group-level fields\n      audience: audienceName,\n      accuticsCampaignName: firstRow.accuticsCampaignName,\n      targeting: firstRow.targeting,\n      target: firstRow.target,\n      kpi: firstRow.kpi,\n      kpiValue: firstRow.kpiValue,\n      placements: firstRow.placements,\n      measurement: firstRow.measurement,\n\n      // Creative lines (always 5)\n      creativeLines,\n    };\n  }\n\n  /**\n   * Extract row data and map to internal field names\n   */\n  private extractRowData(\n    worksheet: ExcelJS.Worksheet,\n    rowNumber: number,\n    headers: string[]\n  ): Record<string, any> {\n    const row = worksheet.getRow(rowNumber);\n    const data: Record<string, any> = {};\n\n    headers.forEach((header, index) => {\n      if (!header) return;\n\n      const cell = row.getCell(index + 1);\n      const internalField = getInternalFieldName(header);\n\n      if (internalField) {\n        let value = cell.value;\n\n        // Handle date formatting\n        // Excel stores dates as serial numbers (days since 1900-01-01) with no timezone info\n        // ExcelJS converts these to JavaScript Date objects\n        // To avoid timezone boundary issues, we add 12 hours before extracting date components\n        // This ensures we're safely in the middle of the calendar day regardless of timezone\n        if (value instanceof Date) {\n          // Add 12 hours (43200000 ms) to avoid timezone boundary issues\n          // If date is at midnight (any timezone), adding 12 hours keeps us on the same calendar day\n          const safeDate = new Date(value.getTime() + 12 * 60 * 60 * 1000);\n\n          // Extract UTC date components from the safe date\n          const year = safeDate.getUTCFullYear();\n          const month = String(safeDate.getUTCMonth() + 1).padStart(2, '0');\n          const day = String(safeDate.getUTCDate()).padStart(2, '0');\n\n          value = `${year}-${month}-${day}`;\n        } else if (typeof value === 'object' && value !== null) {\n          // Handle Excel rich text\n          value = (value as any).text || String(value);\n        }\n\n        data[internalField] = value;\n      }\n    });\n\n    return data;\n  }\n\n  /**\n   * Find column index by trying multiple possible names\n   */\n  private findColumnIndex(headers: string[], possibleNames: string[]): number {\n    for (const name of possibleNames) {\n      const index = headers.findIndex(h => h === name);\n      if (index !== -1) return index;\n    }\n\n    // Try normalized matching\n    const normalizedPossibleNames = possibleNames.map(n => normalizeFieldName(n));\n    for (let i = 0; i < headers.length; i++) {\n      const normalized = normalizeFieldName(headers[i]);\n      if (normalizedPossibleNames.includes(normalized)) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  /**\n   * Validate campaign line and add warnings\n   */\n  private validateCampaignLine(campaignLine: CampaignLine): void {\n    // Check required fields\n    if (!campaignLine.channel) {\n      campaignLine.validationWarnings = campaignLine.validationWarnings || [];\n      campaignLine.validationWarnings.push({\n        severity: 'warning',\n        message: 'Missing channel',\n        field: 'channel',\n      });\n    }\n\n    if (!campaignLine.platform) {\n      campaignLine.validationWarnings = campaignLine.validationWarnings || [];\n      campaignLine.validationWarnings.push({\n        severity: 'warning',\n        message: 'Missing platform',\n        field: 'platform',\n      });\n    }\n\n    if (!campaignLine.startDate || !campaignLine.endDate) {\n      campaignLine.validationWarnings = campaignLine.validationWarnings || [];\n      campaignLine.validationWarnings.push({\n        severity: 'warning',\n        message: 'Missing start or end date',\n        field: 'dates',\n      });\n    }\n\n    if (campaignLine.adGroups.length === 0) {\n      campaignLine.validationWarnings = campaignLine.validationWarnings || [];\n      campaignLine.validationWarnings.push({\n        severity: 'error',\n        message: 'No ad groups detected',\n      });\n    }\n  }\n\n  /**\n   * Add validation warning to global warnings list\n   */\n  private addWarning(\n    severity: 'error' | 'warning' | 'info',\n    message: string,\n    field?: string,\n    rowNumber?: number\n  ): void {\n    this.validationWarnings.push({\n      severity,\n      message,\n      field,\n      rowNumber,\n    });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3706, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/blockingChartTemplates.ts"],"sourcesContent":["import ExcelJS from \"exceljs\";\nimport { TEMPLATE_CONFIG } from \"./config\";\n\nexport interface BlockingChartTemplate {\n  id: string;\n  name: string;\n  description: string;\n  // Column mappings: template column name → standard field name\n  columnMappings: Record<string, string>;\n  // Detection rules to identify this template\n  detectionRules: {\n    requiredColumns: string[];  // Must have these columns\n    optionalColumns?: string[]; // May have these\n    sheetNamePattern?: RegExp;  // Sheet name must match\n  };\n  // Parser-specific config\n  config?: {\n    headerRowHint?: number;     // Likely row number for headers\n    skipRows?: number;          // Rows to skip at top\n    customParsing?: (worksheet: ExcelJS.Worksheet) => any;\n  };\n}\n\nexport const blockingChartTemplates: BlockingChartTemplate[] = [\n  {\n    id: \"unilever-standard\",\n    name: \"Unilever Standard\",\n    description: \"Standard Unilever blocking chart format\",\n    columnMappings: {\n      \"Channel\": \"channel\",\n      \"Tactic\": \"tactic\",\n      \"Platform\": \"platform\",\n      \"Objective\": \"objective\",\n      \"Placements\": \"placements\",\n      \"Optimization KPI\": \"optimizationKpi\",\n      \"Demo\": \"demo\",\n      \"Targeting\": \"targeting\",\n      \"Language\": \"language\",\n      \"Accutics Campaign Name\": \"accuticsCampaignName\",\n      \"Accutics Ad Set Name\": \"accuticsAdSetName\",\n      \"CPM/CPP\": \"cpmCpp\",\n      \"Impressions/GRPs\": \"impressionsGrps\",\n      \"Start Date\": \"startDate\",\n      \"End Date\": \"endDate\",\n      \"Media Cost\": \"mediaCost\",\n      \"Ad Serving\": \"adServing\",\n      \"DV Cost\": \"dvCost\",\n      \"Media Fee Total\": \"mediaFeeTotal\",\n      \"Working Media Budget\": \"workingMediaBudget\",\n    },\n    detectionRules: {\n      requiredColumns: [\"Channel\", \"Tactic\", \"Platform\"],\n      optionalColumns: [\"Accutics Campaign Name\", \"Working Media Budget\"],\n    },\n  },\n  {\n    id: \"unilever-extended\",\n    name: \"Unilever Extended Format\",\n    description: \"Extended blocking chart with additional depth\",\n    columnMappings: {\n      // All standard mappings from above, PLUS extended fields:\n      \"Channel\": \"channel\",\n      \"Tactic\": \"tactic\",\n      \"Platform\": \"platform\",\n      \"Objective\": \"objective\",\n      \"Sub-Objective\": \"subObjective\",           // NEW\n      \"Placements\": \"placements\",\n      \"Placement Details\": \"placementDetails\",   // NEW\n      \"Optimization KPI\": \"optimizationKpi\",\n      \"KPI Target\": \"kpiTarget\",                 // NEW\n      \"Demo\": \"demo\",\n      \"Demo Details\": \"demoDetails\",             // NEW\n      \"Targeting\": \"targeting\",\n      \"Targeting Strategy\": \"targetingStrategy\", // NEW\n      \"Language\": \"language\",\n      \"Market\": \"market\",                        // NEW\n      \"Region\": \"region\",                        // NEW\n      \"Accutics Campaign Name\": \"accuticsCampaignName\",\n      \"Accutics Ad Set Name\": \"accuticsAdSetName\",\n      \"Creative Strategy\": \"creativeStrategy\",   // NEW\n      \"Creative Format\": \"creativeFormat\",       // NEW\n      \"CPM/CPP\": \"cpmCpp\",\n      \"Impressions/GRPs\": \"impressionsGrps\",\n      \"Frequency Cap\": \"frequencyCap\",           // NEW\n      \"Start Date\": \"startDate\",\n      \"End Date\": \"endDate\",\n      \"Flight Pattern\": \"flightPattern\",         // NEW\n      \"Media Cost\": \"mediaCost\",\n      \"Production Cost\": \"productionCost\",       // NEW\n      \"Ad Serving\": \"adServing\",\n      \"DV Cost\": \"dvCost\",\n      \"Media Fee Total\": \"mediaFeeTotal\",\n      \"Working Media Budget\": \"workingMediaBudget\",\n      \"Vendor\": \"vendor\",                        // NEW\n      \"PO Number\": \"poNumber\",                   // NEW\n      \"Budget Category\": \"budgetCategory\",       // NEW\n      \"Campaign Type\": \"campaignType\",           // NEW\n    },\n    detectionRules: {\n      // If we see any of these \"extended\" columns, it's the extended format\n      requiredColumns: [\"Channel\", \"Tactic\", \"Platform\"],\n      optionalColumns: [\"Sub-Objective\", \"Creative Strategy\", \"Flight Pattern\", \"Vendor\", \"KPI Target\", \"Budget Category\"],\n    },\n  },\n];\n\n/**\n * Auto-detect which template a blocking chart uses based on its headers\n */\nexport function detectBlockingChartTemplate(\n  headers: string[]\n): BlockingChartTemplate | null {\n  const normalizedHeaders = headers.map(h => h.trim().toLowerCase());\n  \n  console.log('🔍 Detecting blocking chart template...');\n  console.log('Headers found:', headers);\n  \n  // Check extended template first (more specific)\n  for (let i = blockingChartTemplates.length - 1; i >= 0; i--) {\n    const template = blockingChartTemplates[i];\n    \n    // Check required columns\n    const hasAllRequired = template.detectionRules.requiredColumns.every(col =>\n      normalizedHeaders.some(h => h === col.toLowerCase())\n    );\n    \n    if (!hasAllRequired) {\n      continue;\n    }\n    \n    // For extended template, check if it has at least minimum optional \"extended\" columns\n    if (template.id === 'unilever-extended' && template.detectionRules.optionalColumns) {\n      const extendedColumnsFound = template.detectionRules.optionalColumns.filter(col =>\n        normalizedHeaders.some(h => h === col.toLowerCase())\n      );\n\n      if (extendedColumnsFound.length >= TEMPLATE_CONFIG.MIN_EXTENDED_COLUMNS) {\n        console.log(`✅ Detected template: ${template.name}`);\n        console.log(`Extended columns found: ${extendedColumnsFound.join(', ')}`);\n        return template;\n      }\n    }\n    \n    // For standard template, just check required columns\n    if (template.id === 'unilever-standard') {\n      console.log(`✅ Detected template: ${template.name}`);\n      return template;\n    }\n  }\n  \n  console.log('⚠️ No template matched, will use auto-normalization');\n  return null; // No template matched\n}\n\n/**\n * Get the mapped field name for a header using the detected template\n */\nexport function getMappedFieldName(\n  header: string,\n  template: BlockingChartTemplate | null,\n  fallbackNormalizer: (header: string) => string\n): string {\n  if (template && template.columnMappings[header]) {\n    return template.columnMappings[header];\n  }\n  \n  // Fall back to auto-normalization\n  return fallbackNormalizer(header);\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3857, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/categorization.ts"],"sourcesContent":["import { CATEGORIZATION_CONFIG } from \"./config\";\n\n/**\n * Categorization input - can be a full CampaignLine or minimal row data\n */\nexport interface CategorizationInput {\n  channel?: string;\n  platform?: string;\n  mediaType?: string;\n  placements?: string;\n  adFormat?: string;\n  isExcluded?: boolean;\n  excludedReason?: string;\n}\n\n/**\n * Categorization result\n */\nexport interface CategorizationResult {\n  tab: string;\n  type: string;\n  reason?: string;\n}\n\n/**\n * Tab information for Excel worksheet selection\n */\nexport interface TabInfo {\n  index: number;\n  name: string;\n  rowCount?: number;\n}\n\n/**\n * Unified categorization logic used by both frontend and backend\n * Determines which traffic sheet tab a campaign line belongs to\n */\nexport function categorizeLine(input: CategorizationInput): CategorizationResult {\n  const channel = (input.channel || '').toLowerCase();\n  const platform = (input.platform || '').toLowerCase();\n  const mediaType = (input.mediaType || '').toLowerCase();\n  const placements = (input.placements || '').toLowerCase();\n  const adFormat = (input.adFormat || '').toLowerCase();\n\n  // Check for excluded campaigns FIRST (highest priority)\n  // Either check the isExcluded flag OR detect by keywords\n  if (input.isExcluded) {\n    return {\n      tab: 'Excluded',\n      type: 'non-digital',\n      reason: input.excludedReason\n    };\n  }\n\n  // Also check for excluded channel keywords directly (OOH, TV, Radio, Print)\n  const excludedCategories = CATEGORIZATION_CONFIG.EXCLUDED_CHANNEL_KEYWORDS;\n\n  // Check OOH\n  for (const keyword of excludedCategories.OOH) {\n    if (channel.includes(keyword) ||\n        platform.includes(keyword) ||\n        placements.includes(keyword) ||\n        adFormat.includes(keyword)) {\n      return { tab: 'Excluded', type: 'non-digital', reason: 'OOH' };\n    }\n  }\n\n  // Check TV (but exclude CTV/Connected TV which are digital)\n  for (const keyword of excludedCategories.TV) {\n    if ((channel.includes(keyword) ||\n         platform.includes(keyword) ||\n         placements.includes(keyword) ||\n         adFormat.includes(keyword)) &&\n        !channel.includes('ctv') &&\n        !channel.includes('connected tv') &&\n        !platform.includes('ctv') &&\n        !platform.includes('connected tv')) {\n      return { tab: 'Excluded', type: 'non-digital', reason: 'TV' };\n    }\n  }\n\n  // Check Radio\n  for (const keyword of excludedCategories.RADIO) {\n    if (channel.includes(keyword) ||\n        platform.includes(keyword) ||\n        placements.includes(keyword) ||\n        adFormat.includes(keyword)) {\n      return { tab: 'Excluded', type: 'non-digital', reason: 'Radio' };\n    }\n  }\n\n  // Check Print\n  for (const keyword of excludedCategories.PRINT) {\n    if (channel.includes(keyword) ||\n        platform.includes(keyword) ||\n        placements.includes(keyword) ||\n        adFormat.includes(keyword)) {\n      return { tab: 'Excluded', type: 'non-digital', reason: 'Print' };\n    }\n  }\n\n  // Check for Brand Say Digital keywords (second priority)\n  // This ensures audio, programmatic, digital video, digital display route correctly\n  const isBrandSayDigital = CATEGORIZATION_CONFIG.BRAND_SAY_DIGITAL_KEYWORDS.some(\n    keyword => channel.includes(keyword) || mediaType.includes(keyword)\n  );\n\n  if (isBrandSayDigital) {\n    return { tab: 'Brand Say Digital', type: 'media' };\n  }\n\n  // Check for influencer keyword (third priority)\n  // Check in placements, adFormat, channel, and platform\n  const isInfluencer = CATEGORIZATION_CONFIG.INFLUENCER_KEYWORDS.some(\n    keyword =>\n      placements.includes(keyword.toLowerCase()) ||\n      adFormat.includes(keyword.toLowerCase()) ||\n      channel.includes(keyword.toLowerCase()) ||\n      platform.includes(keyword.toLowerCase())\n  );\n\n  // Check if it's a social platform (fourth priority)\n  // Check platform, channel, placements, and adFormat to catch all cases\n  const isSocialPlatform = CATEGORIZATION_CONFIG.SOCIAL_PLATFORMS.some(socialPlatform =>\n    platform.includes(socialPlatform.toLowerCase()) ||\n    channel.includes(socialPlatform.toLowerCase()) ||\n    placements.includes(socialPlatform.toLowerCase()) ||\n    adFormat.includes(socialPlatform.toLowerCase())\n  );\n\n  // Special case: Pinterest only\n  // Pinterest is the ONLY social platform where influencer content goes to Brand Say Social\n  const isPinterest = platform.includes('pinterest') || platform.includes('pin') ||\n                      channel.includes('pinterest') || channel.includes('pin') ||\n                      placements.includes('pinterest') || placements.includes('pin') ||\n                      adFormat.includes('pinterest') || adFormat.includes('pin');\n\n  // Decision matrix for social platforms with influencer:\n  // - Pinterest + Influencer → Brand Say Social (brand-created influencer content)\n  // - Meta/TikTok/Other Social + Influencer → Other Say Social (actual influencers)\n  // - Any Social Platform + NO Influencer → Brand Say Social (regular paid social)\n  if (isSocialPlatform) {\n    if (isInfluencer && !isPinterest) {\n      // Meta, TikTok, etc. with influencer → Other Say Social\n      return { tab: 'Other Say Social', type: 'media' };\n    } else {\n      // Pinterest (with or without influencer) OR any social without influencer → Brand Say Social\n      return { tab: 'Brand Say Social', type: 'media' };\n    }\n  }\n\n  // If it's influencer content on a NON-social platform, route to Other Say Social\n  if (isInfluencer) {\n    return { tab: 'Other Say Social', type: 'media' };\n  }\n\n  // Default to Brand Say Digital for non-social, non-influencer (programmatic, display, video, audio, etc.)\n  return { tab: 'Brand Say Digital', type: 'media' };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3974, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/demographicExtraction.ts"],"sourcesContent":["/**\n * Demographic extraction utilities\n * Extracts demographic codes (W25-49, M18-44, A18-65) from Target field\n */\n\nimport { DEMOGRAPHIC_CONFIG } from './config';\n\n/**\n * Extract demographic code from Target field\n *\n * Looks for patterns like:\n * - W25-49 (Women 25-49)\n * - M18-44 (Men 18-44)\n * - A18-65 (Adults 18-65)\n * - F21-35 (Females 21-35)\n *\n * Returns the first matching demographic code found, or 'A18+' if none found.\n *\n * @param target - The target field value from blocking chart\n * @returns Demographic code (e.g., \"W25-49\", \"M18-44\", or \"A18+\")\n *\n * @example\n * extractDemographic(\"Broad W25-49 + Costco interest\") // Returns \"W25-49\"\n * extractDemographic(\"Healthy-ish Hustlers (M18-44)\") // Returns \"M18-44\"\n * extractDemographic(\"Casual Quenchers (A18-65)\") // Returns \"A18-65\"\n * extractDemographic(\"18-54\\nBeauty & Personal Care\") // Returns \"A18+\" (no gender code)\n * extractDemographic(undefined) // Returns \"A18+\"\n */\nexport function extractDemographic(target: string | undefined): string {\n  if (!target) {\n    return DEMOGRAPHIC_CONFIG.DEFAULT_DEMO;\n  }\n\n  const targetStr = String(target);\n\n  // Reset regex state (important for global regex)\n  DEMOGRAPHIC_CONFIG.DEMO_PATTERN.lastIndex = 0;\n\n  // Find all demographic patterns in the string\n  const matches = targetStr.matchAll(DEMOGRAPHIC_CONFIG.DEMO_PATTERN);\n  const matchArray = Array.from(matches);\n\n  if (matchArray.length === 0) {\n    return DEMOGRAPHIC_CONFIG.DEFAULT_DEMO;\n  }\n\n  // Return first match in format: W25-49\n  const firstMatch = matchArray[0];\n  const genderCode = firstMatch[1];  // W, M, A, F\n  const lowerAge = firstMatch[2];     // 25, 18, etc.\n  const upperAge = firstMatch[3];     // 49, 44, etc.\n\n  return `${genderCode}${lowerAge}-${upperAge}`;\n}\n\n/**\n * Get the full gender description from a gender code\n *\n * @param genderCode - Single character gender code (W, M, A, F)\n * @returns Full gender description\n *\n * @example\n * getGenderDescription('W') // Returns \"Women\"\n * getGenderDescription('M') // Returns \"Men\"\n * getGenderDescription('A') // Returns \"Adults\"\n */\nexport function getGenderDescription(genderCode: string): string {\n  const upperCode = genderCode.toUpperCase() as keyof typeof DEMOGRAPHIC_CONFIG.GENDER_CODES;\n  return DEMOGRAPHIC_CONFIG.GENDER_CODES[upperCode] || 'Adults';\n}\n\n/**\n * Parse a demographic code into its components\n *\n * @param demographic - Demographic code (e.g., \"W25-49\")\n * @returns Object with gender, lowerAge, upperAge\n *\n * @example\n * parseDemographic(\"W25-49\") // Returns { gender: \"W\", genderDesc: \"Women\", lowerAge: 25, upperAge: 49 }\n * parseDemographic(\"A18+\") // Returns { gender: \"A\", genderDesc: \"Adults\", lowerAge: 18, upperAge: undefined }\n */\nexport function parseDemographic(demographic: string): {\n  gender: string;\n  genderDesc: string;\n  lowerAge: number;\n  upperAge?: number;\n} {\n  // Handle \"A18+\" format\n  const plusMatch = demographic.match(/^([MWFA])(\\d+)\\+$/);\n  if (plusMatch) {\n    const gender = plusMatch[1];\n    return {\n      gender,\n      genderDesc: getGenderDescription(gender),\n      lowerAge: parseInt(plusMatch[2], 10),\n      upperAge: undefined,\n    };\n  }\n\n  // Handle \"W25-49\" format\n  const rangeMatch = demographic.match(/^([MWFA])(\\d+)-(\\d+)$/);\n  if (rangeMatch) {\n    const gender = rangeMatch[1];\n    return {\n      gender,\n      genderDesc: getGenderDescription(gender),\n      lowerAge: parseInt(rangeMatch[2], 10),\n      upperAge: parseInt(rangeMatch[3], 10),\n    };\n  }\n\n  // Fallback\n  return {\n    gender: 'A',\n    genderDesc: 'Adults',\n    lowerAge: 18,\n    upperAge: undefined,\n  };\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AAED;;AAuBO,SAAS,mBAAmB,MAA0B;IAC3D,IAAI,CAAC,QAAQ;QACX,OAAO,2JAAkB,CAAC,YAAY;IACxC;IAEA,MAAM,YAAY,OAAO;IAEzB,iDAAiD;IACjD,2JAAkB,CAAC,YAAY,CAAC,SAAS,GAAG;IAE5C,8CAA8C;IAC9C,MAAM,UAAU,UAAU,QAAQ,CAAC,2JAAkB,CAAC,YAAY;IAClE,MAAM,aAAa,MAAM,IAAI,CAAC;IAE9B,IAAI,WAAW,MAAM,KAAK,GAAG;QAC3B,OAAO,2JAAkB,CAAC,YAAY;IACxC;IAEA,uCAAuC;IACvC,MAAM,aAAa,UAAU,CAAC,EAAE;IAChC,MAAM,aAAa,UAAU,CAAC,EAAE,EAAG,aAAa;IAChD,MAAM,WAAW,UAAU,CAAC,EAAE,EAAM,eAAe;IACnD,MAAM,WAAW,UAAU,CAAC,EAAE,EAAM,eAAe;IAEnD,OAAO,GAAG,aAAa,SAAS,CAAC,EAAE,UAAU;AAC/C;AAaO,SAAS,qBAAqB,UAAkB;IACrD,MAAM,YAAY,WAAW,WAAW;IACxC,OAAO,2JAAkB,CAAC,YAAY,CAAC,UAAU,IAAI;AACvD;AAYO,SAAS,iBAAiB,WAAmB;IAMlD,uBAAuB;IACvB,MAAM,YAAY,YAAY,KAAK,CAAC;IACpC,IAAI,WAAW;QACb,MAAM,SAAS,SAAS,CAAC,EAAE;QAC3B,OAAO;YACL;YACA,YAAY,qBAAqB;YACjC,UAAU,SAAS,SAAS,CAAC,EAAE,EAAE;YACjC,UAAU;QACZ;IACF;IAEA,yBAAyB;IACzB,MAAM,aAAa,YAAY,KAAK,CAAC;IACrC,IAAI,YAAY;QACd,MAAM,SAAS,UAAU,CAAC,EAAE;QAC5B,OAAO;YACL;YACA,YAAY,qBAAqB;YACjC,UAAU,SAAS,UAAU,CAAC,EAAE,EAAE;YAClC,UAAU,SAAS,UAAU,CAAC,EAAE,EAAE;QACpC;IACF;IAEA,WAAW;IACX,OAAO;QACL,QAAQ;QACR,YAAY;QACZ,UAAU;QACV,UAAU;IACZ;AACF","debugId":null}},
    {"offset": {"line": 4046, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/shared/excel/index.ts"],"sourcesContent":["/**\n * Shared Excel Processing Module\n * Main entry point for blocking chart parsing and traffic sheet generation\n * Used by both desktop (Electron) and web implementations\n *\n * This is the SINGLE SOURCE OF TRUTH for all Excel processing logic.\n * Both desktop and web applications import from this shared package.\n */\n\n// Main processing functions and classes\nexport { TrafficSheetGenerator } from './trafficSheetWriter';\nexport { BlockingChartParser } from './parser/BlockingChartParser';\n\n// Template detection and management\nexport {\n  detectBlockingChartTemplate,\n  type BlockingChartTemplate,\n} from './blockingChartTemplates';\n\n// Categorization logic\nexport {\n  categorizeLine,\n  type CategorizationInput,\n  type CategorizationResult,\n  type TabInfo,\n} from './categorization';\n\n// Demographic extraction\nexport { extractDemographic } from './demographicExtraction';\n\n// Utilities\nexport {\n  normalizeFieldName,\n  normalizeFieldNameCamelCase,\n  createFieldNameMap,\n} from './utils/FieldNormalizer';\n\nexport {\n  getTrafficSheetTab as getPlatformTab,\n  getPlatformCategory,\n  getDefaultPlacements,\n  isExcludedChannel as isPlatformExcluded,\n  getExclusionReason as getPlatformExclusionReason,\n  isSocialPlatform,\n  isProgrammaticPlatform,\n} from './utils/PlatformClassifier';\n\nexport {\n  BLOCKING_CHART_COLUMNS,\n  CAMPAIGN_LINE_INDICATORS,\n  BLOCKING_CHART_FIELD_MAPPINGS,\n  TRAFFIC_SHEET_FIELD_MAPPINGS,\n  getInternalFieldName,\n  getTrafficSheetColumnName,\n  buildColumnIndexMap,\n  mapBlockingChartRowToInternal,\n} from './utils/FieldMapper';\n\n// Configuration constants\nexport {\n  ROW_EXPANSION_CONFIG,\n  DEMOGRAPHIC_CONFIG,\n  TRAFFIC_SHEET_CONFIG,\n  PARSING_CONFIG,\n  CAMPAIGN_LINE_DETECTION_CONFIG,\n  AD_GROUP_DETECTION_CONFIG,\n  CATEGORIZATION_CONFIG,\n  STYLE_CONFIG,\n  VALIDATION_CONFIG,\n  DATE_CONFIG,\n  TEMPLATE_CONFIG,\n} from './config';\n\n// Type definitions\nexport type {\n  ParsedBlockingChart,\n  CampaignLine,\n  AdGroup,\n  CreativeLine,\n  ValidationWarning,\n  CampaignLineRange,\n  MergeInfo,\n  CategorizedCampaignLines,\n  TrafficSheetTab,\n  TrafficSheetRow,\n  ExcelStyleInfo,\n} from './types';\n"],"names":[],"mappings":"AAAA;;;;;;;CAOC,GAED,wCAAwC;;AACxC;AACA;AAEA,oCAAoC;AACpC;AAKA,uBAAuB;AACvB;AAOA,yBAAyB;AACzB;AAEA,YAAY;AACZ;AAMA;AAUA;AAWA,0BAA0B;AAC1B","debugId":null}},
    {"offset": {"line": 4082, "column": 0}, "map": {"version":3,"sources":["file:///Users/lucusdato/Documents/Dev/ShortStaffed%20MediaTools/packages/web/app/apps/traffic-sheet-automation/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport FileUpload from \"@/core/ui/FileUpload\";\nimport Button from \"@/core/ui/Button\";\nimport Header from \"@/core/ui/Header\";\nimport TabPicker from \"@/core/ui/TabPicker\";\nimport { Analytics } from \"@/core/analytics/tracker\";\nimport { TabInfo, categorizeLine } from \"@quickclick/shared/excel\";\nimport { useUser } from \"@/core/ui/AnalyticsProvider\";\n\ntype Step = \"upload\" | \"generate\";\n\ninterface ParsedData {\n  headers: string[];\n  rows: any[];\n  metadata?: {\n    campaignName?: string;\n    client?: string;\n    dateRange?: string;\n    detectedTemplate?: string;  // Template ID that was detected\n    templateName?: string;       // Human-readable template name\n  };\n  rowCount: number;\n}\n\nexport default function TrafficSheetAutomation() {\n  const user = useUser();\n  const [currentStep, setCurrentStep] = useState<Step>(\"upload\");\n  const [blockingChart, setBlockingChart] = useState<File | null>(null);\n  const [parsedData, setParsedData] = useState<ParsedData | null>(null);\n  const [manualOverrides, setManualOverrides] = useState<{ [key: number]: string }>({});\n  const [deletedRows, setDeletedRows] = useState<Set<number>>(new Set());\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n\n  // Tab selection state\n  const [showTabPicker, setShowTabPicker] = useState(false);\n  const [availableTabs, setAvailableTabs] = useState<TabInfo[]>([]);\n  const [selectedTabIndex, setSelectedTabIndex] = useState<number | null>(null);\n\n  // Track page view on mount\n  useEffect(() => {\n    Analytics.trackPageView(\"Traffic Sheet Automation\");\n  }, []);\n\n  const handleFileSelect = async (file: File, tabIndex?: number) => {\n    setBlockingChart(file);\n    setError(null);\n    setSuccess(false);\n\n    // Track file upload (only on first upload, not on tab selection)\n    if (tabIndex === undefined) {\n      Analytics.trafficSheetFileUpload(file);\n    }\n\n    // Automatically parse and generate\n    setIsProcessing(true);\n    setCurrentStep(\"generate\");\n\n    try {\n      const formData = new FormData();\n      formData.append(\"blockingChart\", file);\n\n      // Include tab index if user selected a specific tab\n      if (tabIndex !== undefined) {\n        formData.append(\"tabIndex\", tabIndex.toString());\n      }\n\n      // Check if we need tab selection first\n      const previewResponse = await fetch(\"/api/traffic-sheet/preview\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!previewResponse.ok) {\n        const errorData = await previewResponse.json();\n        throw new Error(errorData.error || \"Failed to parse blocking chart\");\n      }\n\n      const previewData = await previewResponse.json();\n\n      // Check if we need tab selection\n      if (previewData.needsTabSelection && previewData.availableTabs) {\n        console.log(`⚠️  Auto-detection failed. Showing tab picker with ${previewData.availableTabs.length} tabs.`);\n        setAvailableTabs(previewData.availableTabs);\n        setShowTabPicker(true);\n        setIsProcessing(false);\n        setCurrentStep(\"upload\");\n        return;\n      }\n\n      // Auto-detection succeeded or user selected a tab\n      console.log(`✅ ${previewData.autoDetected ? 'Auto-detected' : 'User selected'} tab index: ${previewData.selectedTabIndex}`);\n      setShowTabPicker(false);\n\n      // Track successful preview\n      Analytics.trafficSheetPreview();\n\n      // Automatically generate the traffic sheet\n      Analytics.trafficSheetGenerate();\n\n      const generateFormData = new FormData();\n      generateFormData.append(\"blockingChart\", file);\n      if (tabIndex !== undefined) {\n        generateFormData.append(\"tabIndex\", tabIndex.toString());\n      }\n\n      const generateResponse = await fetch(\"/api/traffic-sheet/generate\", {\n        method: \"POST\",\n        body: generateFormData,\n      });\n\n      if (!generateResponse.ok) {\n        const errorData = await generateResponse.json();\n        throw new Error(errorData.error || \"Failed to generate traffic sheet\");\n      }\n\n      // Download the generated file\n      const blob = await generateResponse.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `traffic-sheet-${Date.now()}.xlsx`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      setSuccess(true);\n\n      // Track successful download\n      Analytics.trafficSheetDownload();\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : \"Failed to generate traffic sheet\";\n      setError(errorMessage);\n      setBlockingChart(null);\n      setCurrentStep(\"upload\");\n\n      // Track the error\n      Analytics.trafficSheetError(\n        errorMessage,\n        file.name,\n        'generation_error'\n      );\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // Handle tab selection from picker\n  const handleTabSelect = (tabIndex: number) => {\n    if (!blockingChart) {\n      setError(\"No file selected\");\n      return;\n    }\n\n    console.log(`📋 User selected tab index: ${tabIndex}`);\n    setSelectedTabIndex(tabIndex);\n\n    // Re-parse with selected tab\n    handleFileSelect(blockingChart, tabIndex);\n  };\n\n  const handleGenerate = async () => {\n    if (!blockingChart) {\n      setError(\"No blocking chart selected\");\n      return;\n    }\n\n    if (!parsedData) {\n      setError(\"No parsed data available\");\n      return;\n    }\n\n    setIsProcessing(true);\n    setError(null);\n    setSuccess(false);\n    setCurrentStep(\"generate\");\n\n    // Track generation action\n    Analytics.trafficSheetGenerate();\n\n    try {\n      // Convert deleted row stable IDs to campaign line indices\n      // The stable IDs correspond to indices in the rowsWithoutTotals array\n      // We need to reconstruct that array to map stable IDs back to original rows\n      const deletedCampaignLineIndices = new Set<number>();\n\n      // Reconstruct rowsWithoutTotals (same logic as in the render section)\n      const rowsWithoutTotals = parsedData.rows.filter((row: any) => row._mergeSpan && row._mergeSpan > 0);\n\n      deletedRows.forEach(stableRowId => {\n        // The stable ID is the index in rowsWithoutTotals\n        const row = rowsWithoutTotals[stableRowId];\n\n        // Get the campaign line index for this row\n        if (row && (row as any)._campaignLineIndex !== undefined) {\n          deletedCampaignLineIndices.add((row as any)._campaignLineIndex);\n          console.log(`  🗑️  Stable ID ${stableRowId} → Campaign Line ${(row as any)._campaignLineIndex}`);\n        } else {\n          console.warn(`  ⚠️  Could not find campaign line index for stable ID ${stableRowId}`);\n          if (row) {\n            console.log(`     Row data:`, { _campaignLineIndex: (row as any)._campaignLineIndex, _campaignLineMasterRow: (row as any)._campaignLineMasterRow });\n          }\n        }\n      });\n\n      console.log(`🗑️  Sending ${deletedCampaignLineIndices.size} deleted campaign line indices to API`);\n      console.log(`   Deleted row IDs: [${Array.from(deletedRows).join(', ')}]`);\n      console.log(`   Deleted campaign line indices: [${Array.from(deletedCampaignLineIndices).join(', ')}]`);\n\n      // Manual overrides are already stored by campaign line index (stable IDs)\n      console.log(`✏️  Sending ${Object.keys(manualOverrides).length} manual overrides to API`);\n      console.log(`   Manual overrides (campaign line indices): ${JSON.stringify(manualOverrides)}`);\n\n      const formData = new FormData();\n      formData.append(\"blockingChart\", blockingChart);\n      formData.append(\"manualOverrides\", JSON.stringify(manualOverrides));\n      formData.append(\"deletedRows\", JSON.stringify(Array.from(deletedCampaignLineIndices)));\n\n      const response = await fetch(\"/api/traffic-sheet/generate\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to generate traffic sheet\");\n      }\n\n      // Download the generated file\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `traffic-sheet-${Date.now()}.xlsx`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      setSuccess(true);\n\n      // Track successful download\n      Analytics.trafficSheetDownload();\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : \"An error occurred\";\n      setError(errorMessage);\n      setCurrentStep(\"verify\");\n\n      // Track the error\n      Analytics.trafficSheetError(\n        errorMessage,\n        blockingChart?.name,\n        'generation_error'\n      );\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleStartOver = () => {\n    setCurrentStep(\"upload\");\n    setBlockingChart(null);\n    setParsedData(null);\n    setManualOverrides({});\n    setDeletedRows(new Set());\n    setError(null);\n    setSuccess(false);\n    // Reset tab picker state\n    setShowTabPicker(false);\n    setAvailableTabs([]);\n    setSelectedTabIndex(null);\n  };\n\n  const handleBackToUpload = () => {\n    setCurrentStep(\"upload\");\n    setBlockingChart(null);\n    setParsedData(null);\n    setManualOverrides({});\n    setDeletedRows(new Set());\n    setError(null);\n    // Reset tab picker state\n    setShowTabPicker(false);\n    setAvailableTabs([]);\n    setSelectedTabIndex(null);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800\">\n      {/* Header */}\n      <Header\n        title=\"Traffic Sheet Automation\"\n        subtitle=\"Generate client-ready traffic sheets from blocking charts\"\n        showBackButton={true}\n      />\n\n      {/* Main Content */}\n      <main className=\"px-6 py-8\">\n        {/* Progress Steps */}\n        <div className=\"mb-6 max-w-4xl mx-auto\">\n          <div className=\"flex items-center justify-center gap-4\">\n            {/* Step 1: Upload */}\n            <div className=\"flex items-center\">\n              <div\n                className={`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors ${\n                  currentStep === \"upload\"\n                    ? \"border-blue-600 bg-blue-600 text-white\"\n                    : success\n                    ? \"border-green-500 bg-green-500 text-white\"\n                    : \"border-slate-300 bg-white text-slate-600\"\n                }`}\n              >\n                {success ? (\n                  <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path\n                      fillRule=\"evenodd\"\n                      d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n                      clipRule=\"evenodd\"\n                    />\n                  </svg>\n                ) : (\n                  \"1\"\n                )}\n              </div>\n              <span\n                className={`ml-2 text-sm font-medium ${\n                  currentStep === \"upload\"\n                    ? \"text-slate-900 dark:text-white\"\n                    : \"text-slate-600 dark:text-slate-400\"\n                }`}\n              >\n                Upload\n              </span>\n            </div>\n\n            {/* Connector */}\n            <div\n              className={`w-16 h-0.5 ${\n                success || currentStep === \"generate\" ? \"bg-green-500\" : \"bg-slate-300\"\n              }`}\n            />\n\n            {/* Step 2: Generate */}\n            <div className=\"flex items-center\">\n              <div\n                className={`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors ${\n                  currentStep === \"generate\" || success\n                    ? \"border-blue-600 bg-blue-600 text-white\"\n                    : \"border-slate-300 bg-white text-slate-600\"\n                }`}\n              >\n                {success ? (\n                  <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                    <path\n                      fillRule=\"evenodd\"\n                      d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\"\n                      clipRule=\"evenodd\"\n                    />\n                  </svg>\n                ) : (\n                  \"2\"\n                )}\n              </div>\n              <span\n                className={`ml-2 text-sm font-medium ${\n                  currentStep === \"generate\" || success\n                    ? \"text-slate-900 dark:text-white\"\n                    : \"text-slate-600 dark:text-slate-400\"\n                }`}\n              >\n                Generate\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Step Content */}\n        {currentStep === \"upload\" && (\n          <UploadStep\n            blockingChart={blockingChart}\n            onFileSelect={handleFileSelect}\n            isProcessing={isProcessing}\n            error={error}\n            showTabPicker={showTabPicker}\n            availableTabs={availableTabs}\n            onTabSelect={handleTabSelect}\n          />\n        )}\n\n        {(currentStep === \"generate\" || success) && (\n          <GenerateStep\n            success={success}\n            isProcessing={isProcessing}\n            error={error}\n            onStartOver={handleStartOver}\n          />\n        )}\n      </main>\n    </div>\n  );\n}\n\n// Upload Step Component\nfunction UploadStep({\n  blockingChart,\n  onFileSelect,\n  isProcessing,\n  error,\n  showTabPicker,\n  availableTabs,\n  onTabSelect,\n}: {\n  blockingChart: File | null;\n  onFileSelect: (file: File) => void;\n  isProcessing: boolean;\n  error: string | null;\n  showTabPicker: boolean;\n  availableTabs: TabInfo[];\n  onTabSelect: (tabIndex: number) => void;\n}) {\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n        {/* Instructions */}\n      <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6\">\n          <h2 className=\"text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2\">\n          📖 Upload Your Blocking Chart\n          </h2>\n          <ol className=\"text-blue-800 dark:text-blue-200 space-y-1 text-sm list-decimal list-inside\">\n          <li>Select your completed blocking chart (.xlsx file)</li>\n          <li>We&apos;ll automatically parse and generate your traffic sheet</li>\n          <li>Your file will download automatically when ready</li>\n          </ol>\n        </div>\n\n      {/* File Upload */}\n      <div className=\"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-6 space-y-4\">\n          <FileUpload\n          label=\"Upload Blocking Chart\"\n          description=\"Upload your completed blocking chart Excel file (.xlsx)\"\n          selectedFile={blockingChart}\n          onFileSelect={onFileSelect}\n        />\n\n        {/* Tab Picker - Only show if auto-detection failed */}\n        {showTabPicker && availableTabs.length > 0 && (\n          <TabPicker\n            tabs={availableTabs}\n            onTabSelect={onTabSelect}\n            isProcessing={isProcessing}\n          />\n        )}\n\n        {/* Template Info */}\n        <div className=\"bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg p-4\">\n          <div className=\"flex items-start gap-3\">\n            <svg\n              className=\"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n              />\n            </svg>\n            <div>\n              <p className=\"font-medium text-slate-900 dark:text-white text-sm\">\n                Unilever Template Built-In\n              </p>\n              <p className=\"text-slate-600 dark:text-slate-400 text-sm mt-1\">\n                The official Unilever traffic sheet template is pre-loaded. Just upload your blocking chart!\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Processing State */}\n        {isProcessing && (\n          <div className=\"flex items-center justify-center gap-3 p-4\">\n            <svg\n              className=\"animate-spin h-6 w-6 text-blue-600\"\n              viewBox=\"0 0 24 24\"\n            >\n              <circle\n                className=\"opacity-25\"\n                cx=\"12\"\n                cy=\"12\"\n                r=\"10\"\n                stroke=\"currentColor\"\n                strokeWidth=\"4\"\n                fill=\"none\"\n              />\n              <path\n                className=\"opacity-75\"\n                fill=\"currentColor\"\n                d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n              />\n            </svg>\n            <span className=\"text-slate-700 dark:text-slate-300 font-medium\">\n              Parsing your blocking chart...\n            </span>\n          </div>\n        )}\n\n          {/* Error Message */}\n          {error && (\n            <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n              <div className=\"flex items-start gap-3\">\n                <svg\n                  className=\"w-5 h-5 text-red-500 mt-0.5\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  stroke=\"currentColor\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                  />\n                </svg>\n                <div>\n                  <p className=\"font-medium text-red-900 dark:text-red-100\">\n                    Error\n                  </p>\n                  <p className=\"text-red-700 dark:text-red-200 text-sm\">\n                    {error}\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n      </div>\n    </div>\n  );\n}\n\n// Verify Step Component\nfunction VerifyStep({\n  data,\n  fileName,\n  onGenerate,\n  onBackToUpload,\n  isProcessing,\n  error,\n  manualOverrides,\n  onManualOverrideChange,\n  deletedRows,\n  onDeletedRowsChange,\n  isAdmin = false,\n}: {\n  data: ParsedData;\n  fileName: string;\n  onGenerate: () => void;\n  onBackToUpload: () => void;\n  isProcessing: boolean;\n  error: string | null;\n  manualOverrides: { [key: number]: string };\n  onManualOverrideChange: (overrides: { [key: number]: string }) => void;\n  deletedRows: Set<number>;\n  onDeletedRowsChange: (deletedRows: Set<number>) => void;\n  isAdmin?: boolean;\n}) {\n  const [hoveredRow, setHoveredRow] = useState<number | null>(null);\n  // Debug: Check if _mergeSpan data is present in the original data\n  console.log('🔍 Original data.rows _mergeSpan check:');\n  data.rows.forEach((row, index) => {\n    if ((row as any)._mergeSpan) {\n      console.log(`  Original Row ${index}: _mergeSpan = ${(row as any)._mergeSpan}`);\n    }\n  });\n\n  // Filter rows: Find \"Variance\" field and only show rows up to and including it\n  const rowsUpToVariance = (() => {\n    const varianceRowIndex = data.rows.findIndex(row => {\n      return Object.values(row).some(value => \n        String(value).toLowerCase().includes('variance')\n      );\n    });\n    \n    // If variance found, return rows up to and including that row\n    // If not found, return all rows\n    return varianceRowIndex >= 0 ? data.rows.slice(0, varianceRowIndex + 1) : data.rows;\n  })();\n\n  // STEP 1: Filter columns first (include all headers to ensure we can find Gross Budget and hide flight columns)\n  const initialHeaders = data.headers;\n  \n  // Extract the totals row first to check for columns with data there\n  const totalsRow = (() => {\n    // Find the last row that looks like a totals row\n    // Check from bottom up for a row with \"total\" in channel or multiple numeric values\n    for (let i = rowsUpToVariance.length - 1; i >= 0; i--) {\n      const row = rowsUpToVariance[i];\n      const channelKey = data.headers[0]?.toLowerCase().replace(/[^a-z0-9]+(.)/g, (_, chr) => chr.toUpperCase()).replace(/^[^a-z]+/, \"\") || \"\";\n      const channelValue = String((channelKey && row[channelKey]) || \"\").toLowerCase();\n      \n      // Check if this looks like a totals row\n      if (channelValue.includes('total') || channelValue.includes('grand')) {\n        return { row, index: i };\n      }\n      \n      // Also check if row has many numeric values (likely a totals row)\n      const numericCount = Object.values(row).filter(v => \n        typeof v === 'number' || (!isNaN(Number(v)) && String(v).trim() !== \"\")\n      ).length;\n      \n      if (numericCount >= 3 && i > rowsUpToVariance.length - 5) {\n        return { row, index: i };\n      }\n    }\n    return null;\n  })();\n\n  // Check which columns are completely blank across all rows, BUT include columns that have data in totals row\n  const nonBlankColumns: number[] = [];\n  console.log('\\n🔍 === PLACEMENTS COLUMN DEBUG: Checking Blank Columns ===');\n  initialHeaders.forEach((header, colIndex) => {\n    // Skip column 1 (always remove it)\n    if (colIndex === 1) return;\n\n    // Skip null/undefined/empty headers\n    if (!header) return;\n\n    const normalizedKey = header\n      .toLowerCase()\n      .replace(/[^a-z0-9]+(.)/g, (_, chr) => chr.toUpperCase())\n      .replace(/^[^a-z]+/, \"\");\n\n    // IMPORTANT: Also get the mapped field name from UNIFIED_TEMPLATE_CONFIG\n    // This handles cases where \"Campaign Details - Placements\" is stored as \"placements\"\n    const mappedKey = header === 'Campaign Details - Placements' ? 'placements' : normalizedKey;\n\n    // Special debug for placements column\n    const isPlacementsColumn = header.toLowerCase().includes('placement');\n    if (isPlacementsColumn) {\n      console.log(`📍 PLACEMENTS COLUMN FOUND at index ${colIndex}: \"${header}\"`);\n      console.log(`   Normalized key: \"${normalizedKey}\"`);\n      console.log(`   Mapped key: \"${mappedKey}\"`);\n    }\n\n    // Check if this column has any data in any row OR in the totals row\n    // Try BOTH the normalized key AND the mapped key\n    const hasDataInRegularRows = rowsUpToVariance.some(row => {\n      const valueNormalized = row[normalizedKey];\n      const valueMapped = row[mappedKey];\n      const value = valueNormalized !== undefined ? valueNormalized : valueMapped;\n      return value !== undefined &&\n             value !== null &&\n             value !== \"\" &&\n             String(value).trim() !== \"\";\n    });\n\n    const hasDataInTotalsRow = totalsRow ? (() => {\n      const valueNormalized = totalsRow.row[normalizedKey];\n      const valueMapped = totalsRow.row[mappedKey];\n      const value = valueNormalized !== undefined ? valueNormalized : valueMapped;\n      return value !== undefined &&\n             value !== null &&\n             value !== \"\" &&\n             String(value).trim() !== \"\";\n    })() : false;\n\n    // Always include important columns even if they're empty\n    const headerLower = header.toLowerCase();\n    const isImportantColumn = headerLower.includes('dv cost') ||\n                             headerLower.includes('media fee total') ||\n                             headerLower.includes('buffer') ||\n                             headerLower.includes('working media budget') ||\n                             headerLower.includes('working media') ||\n                             headerLower.includes('ad serving') ||\n                             headerLower.includes('media cost') ||\n                             headerLower.includes('budget') ||\n                             headerLower.includes('spend') ||\n                             headerLower.includes('cost') ||\n                             headerLower.includes('cpm') ||\n                             headerLower.includes('grp') ||\n                             headerLower.includes('impression') ||\n                             headerLower.includes('placement'); // Add placements as important\n\n    if (isPlacementsColumn) {\n      console.log(`   Has data in regular rows? ${hasDataInRegularRows}`);\n      console.log(`   Has data in totals row? ${hasDataInTotalsRow}`);\n      console.log(`   Is important column? ${isImportantColumn}`);\n      console.log(`   Sample values from first 3 rows (normalized):`, rowsUpToVariance.slice(0, 3).map(r => r[normalizedKey]));\n      console.log(`   Sample values from first 3 rows (mapped):`, rowsUpToVariance.slice(0, 3).map(r => r[mappedKey]));\n    }\n\n    if (hasDataInRegularRows || hasDataInTotalsRow || isImportantColumn) {\n      nonBlankColumns.push(colIndex);\n      if (isPlacementsColumn) {\n        console.log(`   ✅ KEEPING placements column (passed blank check)`);\n      }\n    } else {\n      if (isPlacementsColumn) {\n        console.log(`   ❌ FILTERING OUT placements column (blank check failed)`);\n      }\n    }\n  });\n  \n  // Create filtered headers (only non-blank columns, excluding column 1)\n  // Also exclude columns that aren't needed for traffic sheet verification\n  const columnsToHideFromDisplay = [\n    'Media type',\n    'Media Type',\n    'Accutics Campaign Name',\n    'Tags Required',\n    'Measurement',\n    'KPI',\n    'KPI Value',\n    'Ad Serving',\n    'DV Cost',\n    'Buffer (+30%)',\n  ];\n\n  // Debug: Log all initial headers to see what we have\n  console.log(`🔍 All initial headers:`, initialHeaders);\n  console.log(`🔍 Total headers available:`, data.headers.length);\n\n  // Debug: Check if Buffer column exists\n  const bufferIndex = initialHeaders.findIndex(h => h && h.toLowerCase().includes('buffer'));\n  console.log(`🔍 Buffer column index: ${bufferIndex} (\"${initialHeaders[bufferIndex]}\")`);\n\n  // Find the index of \"End Date\" and \"Gross Budget\" to hide flight columns in between\n  const endDateIndex = initialHeaders.findIndex(h =>\n    h && h.toLowerCase().includes('end date')\n  );\n  const grossBudgetIndex = initialHeaders.findIndex(h =>\n    h && h.toLowerCase().includes('gross')\n  );\n\n  console.log(`\\n🔍 === PLACEMENTS COLUMN DEBUG: Checking Display Filters ===`);\n  console.log(`  End Date index: ${endDateIndex} (\"${initialHeaders[endDateIndex]}\")`);\n  console.log(`  Gross Budget index: ${grossBudgetIndex} (\"${initialHeaders[grossBudgetIndex]}\")`);\n  console.log(`  Columns between: ${endDateIndex !== -1 && grossBudgetIndex !== -1 ? grossBudgetIndex - endDateIndex - 1 : 0}`);\n\n  const displayColumns = nonBlankColumns.filter(colIndex => {\n    const header = initialHeaders[colIndex];\n    const isPlacementsColumn = header.toLowerCase().includes('placement');\n\n    if (isPlacementsColumn) {\n      console.log(`\\n📍 CHECKING PLACEMENTS COLUMN (index ${colIndex}): \"${header}\"`);\n    }\n\n    // Hide explicitly named columns\n    if (columnsToHideFromDisplay.includes(header)) {\n      if (isPlacementsColumn) {\n        console.log(`   ❌ HIDDEN by explicit hide list`);\n      } else {\n        console.log(`  🚫 Hiding column ${colIndex}: \"${header}\" (in hide list)`);\n      }\n      return false;\n    }\n\n    // Hide flight columns between End Date and Gross Budget\n    if (endDateIndex !== -1 && grossBudgetIndex !== -1 &&\n        colIndex > endDateIndex && colIndex < grossBudgetIndex) {\n      if (isPlacementsColumn) {\n        console.log(`   ❌ HIDDEN by flight column filter (between End Date and Gross Budget)`);\n        console.log(`      colIndex (${colIndex}) > endDateIndex (${endDateIndex}) && colIndex < grossBudgetIndex (${grossBudgetIndex})`);\n      } else {\n        console.log(`  🚫 Hiding column ${colIndex}: \"${header}\" (flight column between End Date and Gross Budget)`);\n      }\n      return false;\n    }\n\n    if (isPlacementsColumn) {\n      console.log(`   ✅ KEEPING placements column (passed all display filters)`);\n    }\n\n    return true;\n  });\n\n  const filteredHeaders = displayColumns.map(colIndex => initialHeaders[colIndex]);\n  const columnIndices = displayColumns; // Track which columns we're showing\n  \n  const isColumn1Empty = true; // Column 1 is always removed\n  const hiddenColumnCount = initialHeaders.length - filteredHeaders.length;\n\n  // totalsRow is already defined above\n\n  // STEP 2: Filter out completely blank rows (reduces clutter)\n  const rowsWithoutTotals = totalsRow\n    ? rowsUpToVariance.filter((_, idx) => idx !== totalsRow.index)\n    : rowsUpToVariance;\n\n  // Categorize rows by tab using unified categorization logic\n  // MUST BE DEFINED BEFORE filteredRows\n  const categorizeRow = (row: any) => {\n    // Extract field values from row using normalized header keys\n    const getNormalizedKey = (headerName: string) =>\n      headerName?.toLowerCase().replace(/[^a-z0-9]+(.)/g, (_, chr) => chr.toUpperCase()).replace(/^[^a-z]+/, \"\") || \"\";\n\n    const channelKey = getNormalizedKey(data.headers[0]);\n    const platformKey = getNormalizedKey(data.headers.find(h => h.toLowerCase().includes('platform')));\n    const placementKey = getNormalizedKey(data.headers.find(h => h.toLowerCase().includes('placement')));\n    const mediaTypeKey = getNormalizedKey(data.headers.find(h => h.toLowerCase().includes('media type')));\n    const adFormatKey = getNormalizedKey(data.headers.find(h => h.toLowerCase().includes('ad format')));\n\n    // Use unified categorization logic\n    const result = categorizeLine({\n      channel: String((channelKey && row[channelKey]) || \"\"),\n      platform: String((platformKey && row[platformKey]) || \"\"),\n      mediaType: String((mediaTypeKey && row[mediaTypeKey]) || \"\"),\n      placements: String((placementKey && row[placementKey]) || \"\"),\n      adFormat: String((adFormatKey && row[adFormatKey]) || \"\"),\n      // Check the actual isExcluded flag from parsed data (for OOH, TV, Radio, Print)\n      isExcluded: row.isExcluded || false,\n      excludedReason: row.excludedReason\n    });\n\n    // Check if it's a header row (visual cue like 'DIGITAL VIDEO', 'PAID SOCIAL')\n    const channel = String((channelKey && row[channelKey]) || \"\").toLowerCase();\n    const isHeaderRow = /^(digital video|digital display|digital audio|paid social|social|video|display|audio)$/i.test(channel);\n    if (isHeaderRow) {\n      return { tab: 'section-header', type: channel, sectionName: channel.toUpperCase() };\n    }\n\n    return result;\n  };\n\n  // Filter to only show valid campaign lines (those with _mergeSpan from backend)\n  // The backend already validated these using triple merge detection (budget + impressions + placements)\n  const filteredRows = (() => {\n    const result = rowsWithoutTotals\n      .filter((row: any) => {\n        // Only include rows that were identified as campaign lines by the backend\n        return row._mergeSpan && row._mergeSpan > 0;\n      })\n      .map((row: any, originalIndex: number) => ({ ...row, _stableRowId: originalIndex }))\n      .filter((row: any) => {\n        // Filter out deleted rows using stable ID\n        return !deletedRows.has(row._stableRowId);\n      });\n\n    console.log(`🔍 Frontend filtering: Starting with ${rowsWithoutTotals.length} rows`);\n    console.log(`✅ Frontend filtering: Kept ${result.length} valid campaign lines (with _mergeSpan)`);\n    console.log(`🗑️  Deleted rows count: ${deletedRows.size}`);\n\n    return result;\n  })();\n\n  const hiddenRowCount = rowsUpToVariance.length - filteredRows.length - (totalsRow ? 1 : 0);\n\n  // First, identify tactic groups based on _mergeSpan in FILTERED rows\n  const tacticGroups: { [masterIndex: number]: number[] } = {};\n  const rowToMasterMap: { [rowIndex: number]: number } = {};\n  \n  console.log('🔍 Building tactic groups from filtered rows:');\n  filteredRows.forEach((row, filteredIndex) => {\n    const mergeSpan = (row as any)._mergeSpan || 1;\n    console.log(`  Filtered Row ${filteredIndex}: _mergeSpan = ${mergeSpan}`);\n    \n    // First, check if this row is already claimed by a previous master\n    if (rowToMasterMap[filteredIndex] !== undefined) {\n      console.log(`    → Already claimed by master row ${rowToMasterMap[filteredIndex]}, skipping`);\n      return;\n    }\n    \n    if (mergeSpan > 1) {\n      // This is a master row - it claims the next (mergeSpan - 1) rows\n      const groupMembers = [filteredIndex];\n      rowToMasterMap[filteredIndex] = filteredIndex; // Master row maps to itself\n      \n      for (let i = 1; i < mergeSpan; i++) {\n        if (filteredIndex + i < filteredRows.length) {\n          groupMembers.push(filteredIndex + i);\n          rowToMasterMap[filteredIndex + i] = filteredIndex; // Claimed rows map to master\n          console.log(`    → Claims filtered row ${filteredIndex + i} (maps to master ${filteredIndex})`);\n        }\n      }\n      tacticGroups[filteredIndex] = groupMembers;\n      console.log(`    → Master row ${filteredIndex} claims group: [${groupMembers.join(', ')}]`);\n    } else {\n      // Standalone row - maps to itself\n      rowToMasterMap[filteredIndex] = filteredIndex;\n      console.log(`    → Standalone row ${filteredIndex}`);\n    }\n  });\n\n  // Log tactic grouping for debugging\n  console.log('🔗 Tactic Groups Identified:', Object.keys(tacticGroups).length > 0 ? tacticGroups : 'No merged tactics found');\n  console.log('📍 Row to Master Mapping:', rowToMasterMap);\n  \n  // Debug: Show detailed mapping\n  console.log('🔍 Detailed Row to Master Mapping:');\n  Object.entries(rowToMasterMap).forEach(([rowIndex, masterIndex]) => {\n    const rowNum = parseInt(rowIndex);\n    console.log(`  Row ${rowIndex} → Master ${masterIndex} ${rowNum !== masterIndex ? '(MERGED)' : '(STANDALONE)'}`);\n  });\n  \n  // Debug: Check if filteredRows still have _mergeSpan data\n  console.log('🔍 Checking filteredRows for _mergeSpan data:');\n  filteredRows.forEach((row, index) => {\n    if ((row as any)._mergeSpan) {\n      console.log(`  Filtered Row ${index}: _mergeSpan = ${(row as any)._mergeSpan}`);\n    }\n  });\n  \n  // Debug: Show the relationship between original indices and filtered indices\n  console.log('🔍 Original vs Filtered Row Mapping:');\n  filteredRows.forEach((row, filteredIndex) => {\n    const originalIndex = data.rows.findIndex(originalRow => originalRow === row);\n    if ((row as any)._mergeSpan) {\n      console.log(`  Filtered[${filteredIndex}] = Original[${originalIndex}] with _mergeSpan = ${(row as any)._mergeSpan}`);\n    }\n  });\n\n  const rowsWithCategories = filteredRows.map((row, index) => {\n    const autoCategory = categorizeRow(row);\n    const campaignLineIndex = (row as any)._campaignLineIndex;\n\n    // Apply manual override using stable campaign line index (survives deletions)\n    const finalCategory = campaignLineIndex !== undefined && manualOverrides[campaignLineIndex]\n      ? { ...autoCategory, tab: manualOverrides[campaignLineIndex] }\n      : autoCategory;\n\n    return {\n      ...row,\n      _category: finalCategory,\n      _index: index,\n      _autoCategory: autoCategory,\n      _masterIndex: rowToMasterMap[index], // Track which master row this belongs to\n      _hasManualOverride: campaignLineIndex !== undefined && manualOverrides[campaignLineIndex] !== undefined\n    };\n  });\n\n  const displayRowCount = filteredRows.length;\n\n  // Debug: Summary of tactic grouping\n  console.log('📊 FINAL TACTIC GROUPING SUMMARY:');\n  console.log(`   Total filtered rows: ${filteredRows.length}`);\n  console.log(`   Master rows identified: ${Object.keys(tacticGroups).length}`);\n  Object.entries(tacticGroups).forEach(([masterIndex, groupMembers]) => {\n    console.log(`   Master Row ${masterIndex} leads group: [${groupMembers.join(', ')}]`);\n    groupMembers.forEach(memberIndex => {\n      console.log(`     Row ${memberIndex} → Master ${rowToMasterMap[memberIndex]}`);\n    });\n  });\n\n  const handleCategoryChange = (rowIndex: number, newTab: string) => {\n    // Get the row to find its campaign line index\n    const row = filteredRows[rowIndex];\n    if (!row) {\n      console.warn(`⚠️  Could not find row at index ${rowIndex}`);\n      return;\n    }\n\n    const campaignLineIndex = (row as any)._campaignLineIndex;\n    if (campaignLineIndex === undefined) {\n      console.warn(`⚠️  Row at index ${rowIndex} missing _campaignLineIndex`);\n      return;\n    }\n\n    // Find the master row for this tactic group\n    const masterIndex = rowToMasterMap[rowIndex];\n    const groupMembers = tacticGroups[masterIndex] || [rowIndex];\n\n    // Use campaign line index as the key (stable across deletions)\n    const newOverrides = { ...manualOverrides };\n    newOverrides[campaignLineIndex] = newTab;\n\n    console.log(`✏️  Tab assignment changed for Campaign Line #${campaignLineIndex} → ${newTab}`);\n    console.log(`   Display row ${rowIndex} with ${groupMembers.length - 1} linked row(s)`);\n    console.log(`   Override stored as: manualOverrides[${campaignLineIndex}] = \"${newTab}\"`);\n\n    onManualOverrideChange(newOverrides);\n  };\n\n  const handleDeleteRow = (stableRowId: number) => {\n    // Find the row index in filteredRows\n    const rowIndex = filteredRows.findIndex((row: any) => row._stableRowId === stableRowId);\n    if (rowIndex === -1) {\n      console.warn(`⚠️  Could not find row with stable ID: ${stableRowId}`);\n      return;\n    }\n\n    // Find the master row for this tactic group\n    const masterIndex = rowToMasterMap[rowIndex];\n\n    // Get all rows in this tactic group (including the master and all children)\n    const groupMembers = tacticGroups[masterIndex] || [rowIndex];\n\n    // Create new set with all group members deleted\n    const newDeletedRows = new Set(deletedRows);\n    groupMembers.forEach(memberIndex => {\n      const memberRow = filteredRows[memberIndex];\n      if (memberRow && (memberRow as any)._stableRowId !== undefined) {\n        newDeletedRows.add((memberRow as any)._stableRowId);\n      }\n    });\n\n    onDeletedRowsChange(newDeletedRows);\n    console.log(`🗑️  Deleted row ${stableRowId} and ${groupMembers.length - 1} linked row(s), total deleted: ${newDeletedRows.size}`);\n    console.log(`   Affected rows: [${groupMembers.join(', ')}]`);\n  };\n\n  return (\n    <div className=\"w-full\">\n      {/* File Info Bar */}\n      <div className=\"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-3 mb-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex-1\">\n            <h3 className=\"text-base font-semibold text-slate-900 dark:text-white\">\n              ✅ {fileName}\n            </h3>\n            <p className=\"text-slate-600 dark:text-slate-400 text-xs\">\n              {displayRowCount} tactics • {filteredHeaders.length} columns\n              {data.metadata?.campaignName && ` • ${data.metadata.campaignName}`}\n              {deletedRows.size > 0 && (\n                <span className=\"ml-2 text-red-600 dark:text-red-400 font-medium\">\n                  • {deletedRows.size} deleted\n                </span>\n              )}\n              {Object.keys(manualOverrides).length > 0 && (\n                <span className=\"ml-2 text-amber-600 dark:text-amber-400 font-medium\">\n                  • {Object.keys(manualOverrides).length} manual override{Object.keys(manualOverrides).length > 1 ? 's' : ''}\n                </span>\n              )}\n              {(hiddenColumnCount > 0 || hiddenRowCount > 0) && (\n                <span className=\"ml-2 text-slate-500 dark:text-slate-400 text-xs\">\n                  ({hiddenColumnCount > 0 && `${hiddenColumnCount} blank col${hiddenColumnCount > 1 ? 's' : ''}`}\n                  {hiddenColumnCount > 0 && hiddenRowCount > 0 && ', '}\n                  {hiddenRowCount > 0 && `${hiddenRowCount} blank row${hiddenRowCount > 1 ? 's' : ''}`} hidden)\n                </span>\n              )}\n            </p>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"text-xs text-slate-500 dark:text-slate-400\">\n              Review and adjust tab assignments • Blanks auto-hidden\n            </p>\n          </div>\n        </div>\n      </div>\n\n\n      {/* Campaign Summary - Calculated from Valid Campaign Lines */}\n      {(() => {\n        // Use normalized field names from backend (see FIELD_MAPPINGS in config.ts)\n        const grossBudgetKey = 'grossBudget';\n        const netBudgetKey = 'netBudget';\n\n        let totalGrossBudget = 0;\n        let totalNetBudget = 0;\n\n        // Only sum values from master rows (first row of each campaign line merge)\n        // to avoid counting merged values multiple times\n        console.log('\\n📊 === CAMPAIGN SUMMARY CALCULATION ===');\n        console.log(`Total rows to process: ${filteredRows.length}`);\n        console.log(`Sample row keys:`, filteredRows[0] ? Object.keys(filteredRows[0]) : 'No rows');\n        console.log('\\n');\n\n        const rowsProcessed: number[] = [];\n        const campaignLinesSeen = new Set<number>();\n\n        filteredRows.forEach((row: any, idx: number) => {\n          // A row is a \"master row\" (first row of a campaign line merge group) if:\n          // 1. It has NO _campaignLineMasterRow (standalone, span=1), OR\n          // 2. Its _campaignLineMasterRow points to itself (first row of merged group)\n          //\n          // This ensures we only count each campaign line's budget/impressions ONCE,\n          // even when budget is merged across multiple blocking chart rows (like Meta campaigns)\n          const masterRowNumber = row._campaignLineMasterRow;\n          const hasNoMasterRow = masterRowNumber === undefined;\n          const isMasterRow = hasNoMasterRow || campaignLinesSeen.has(masterRowNumber) === false;\n\n          if (!hasNoMasterRow && masterRowNumber !== undefined) {\n            // This row is part of a merge group\n            if (campaignLinesSeen.has(masterRowNumber)) {\n              // We've already counted this campaign line\n              console.log(`⏭️  Row ${idx}: Part of campaign line starting at row ${masterRowNumber} (already counted)`);\n              return;\n            } else {\n              // First time seeing this campaign line\n              campaignLinesSeen.add(masterRowNumber);\n            }\n          }\n\n          // Only count master rows to avoid double-counting merged budget values\n          if (isMasterRow) {\n            const grossVal = row[grossBudgetKey];\n            const netVal = row[netBudgetKey];\n\n            const channel = (row.channel || '').trim();\n            const platform = (row.platform || '').trim();\n            const placements = (row.placements || '').trim();\n\n            rowsProcessed.push(idx);\n\n            console.log(`✓ Row ${idx}: Channel=\"${channel}\", Platform=\"${platform}\", Placements=\"${placements}\"`);\n            console.log(`    Master row: ${masterRowNumber || 'standalone'}, Merge span: ${row._mergeSpan || 1}`);\n            console.log(`    Gross=${grossVal}, Net=${netVal}`);\n\n            if (grossVal) {\n              const value = typeof grossVal === 'number' ? grossVal : parseFloat(String(grossVal).replace(/[,$]/g, ''));\n              if (!isNaN(value) && value > 0) {\n                totalGrossBudget += value;\n              }\n            }\n            if (netVal) {\n              const value = typeof netVal === 'number' ? netVal : parseFloat(String(netVal).replace(/[,$]/g, ''));\n              if (!isNaN(value) && value > 0) {\n                totalNetBudget += value;\n              }\n            }\n          }\n        });\n\n        console.log(`\\n📊 Campaign lines counted: ${rowsProcessed.length}`);\n        console.log(`📊 Total rows in blocking chart: ${filteredRows.length}`);\n        console.log(`📊 Rows skipped (part of merged campaign lines): ${filteredRows.length - rowsProcessed.length}`);\n\n        console.log(`📊 Final totals - Gross: $${totalGrossBudget.toLocaleString()}, Net: $${totalNetBudget.toLocaleString()}`);\n        console.log(`📊 Will display? Gross: ${totalGrossBudget > 0}, Net: ${totalNetBudget > 0}`);\n\n        return (\n          <div className=\"bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 border border-indigo-200 dark:border-indigo-700 rounded-lg px-6 py-4 mb-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-2xl\">💰</span>\n                <div>\n                  <h4 className=\"text-sm font-bold text-indigo-900 dark:text-indigo-100\">\n                    Campaign Summary ({filteredRows.length} Valid Campaign Lines)\n                  </h4>\n                  <p className=\"text-xs text-indigo-700 dark:text-indigo-300\">\n                    Totals calculated from verified campaign lines only\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex gap-8\">\n                {/* Debug: Always show if we have rows, even if totals are 0 */}\n                {filteredRows.length > 0 && totalGrossBudget >= 0 && (\n                  <div className=\"text-center\">\n                    <p className=\"text-xs text-indigo-600 dark:text-indigo-400 font-medium uppercase tracking-wide\">\n                      Gross Budget\n                    </p>\n                    <p className=\"text-lg font-bold text-indigo-900 dark:text-indigo-100\">\n                      {new Intl.NumberFormat('en-US', {\n                        style: 'currency',\n                        currency: 'USD',\n                        minimumFractionDigits: 2,\n                        maximumFractionDigits: 2\n                      }).format(totalGrossBudget)}\n                    </p>\n                  </div>\n                )}\n                {filteredRows.length > 0 && totalNetBudget >= 0 && (\n                  <div className=\"text-center\">\n                    <p className=\"text-xs text-indigo-600 dark:text-indigo-400 font-medium uppercase tracking-wide\">\n                      Net Budget\n                    </p>\n                    <p className=\"text-lg font-bold text-indigo-900 dark:text-indigo-100\">\n                      {new Intl.NumberFormat('en-US', {\n                        style: 'currency',\n                        currency: 'USD',\n                        minimumFractionDigits: 2,\n                        maximumFractionDigits: 2\n                      }).format(totalNetBudget)}\n                    </p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        );\n      })()}\n\n      {/* Debug Panel - Collapsible (Admin Only) */}\n      {isAdmin && (\n        <details className=\"bg-slate-100 dark:bg-slate-900 rounded-lg shadow-lg mb-4 overflow-hidden\">\n          <summary className=\"px-4 py-2 cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-800 text-sm font-medium text-slate-700 dark:text-slate-300\">\n            🔍 Debug Info (Click to expand)\n          </summary>\n          <div className=\"px-4 py-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs\">\n              <div>\n                <h4 className=\"font-semibold text-slate-700 dark:text-slate-300 mb-2\">Index Mappings</h4>\n                <ul className=\"space-y-1 text-slate-600 dark:text-slate-400 font-mono\">\n                  {rowsWithCategories.slice(0, 5).map((row, idx) => (\n                    <li key={idx} className=\"bg-slate-50 dark:bg-slate-900 p-2 rounded\">\n                      <div><strong>Display Row:</strong> {idx}</div>\n                      <div><strong>Campaign Line:</strong> {(row as any)._campaignLineIndex ?? 'N/A'}</div>\n                      <div><strong>Stable ID:</strong> {(row as any)._stableRowId ?? 'N/A'}</div>\n                    </li>\n                  ))}\n                  {rowsWithCategories.length > 5 && (\n                    <li className=\"text-slate-500 dark:text-slate-500 italic\">...and {rowsWithCategories.length - 5} more</li>\n                  )}\n                </ul>\n              </div>\n              <div>\n                <h4 className=\"font-semibold text-slate-700 dark:text-slate-300 mb-2\">Override Status</h4>\n                {Object.keys(manualOverrides).length > 0 ? (\n                  <ul className=\"space-y-1 text-slate-600 dark:text-slate-400 font-mono\">\n                    {Object.entries(manualOverrides).map(([campaignLineIdx, tab]) => (\n                      <li key={campaignLineIdx} className=\"bg-green-50 dark:bg-green-900/20 p-2 rounded border-l-2 border-green-500\">\n                        <div><strong>Campaign Line {campaignLineIdx}:</strong></div>\n                        <div className=\"text-green-700 dark:text-green-400\">→ Overridden to \"{tab}\"</div>\n                      </li>\n                    ))}\n                  </ul>\n                ) : (\n                  <p className=\"text-slate-500 dark:text-slate-500 italic\">No manual overrides applied</p>\n                )}\n              </div>\n            </div>\n            <div className=\"mt-4 pt-3 border-t border-slate-200 dark:border-slate-700\">\n              <h4 className=\"font-semibold text-slate-700 dark:text-slate-300 mb-2\">How Indexing Works</h4>\n              <div className=\"text-xs text-slate-600 dark:text-slate-400 space-y-1\">\n                <p><strong>Display Row:</strong> Position in the table you see (changes when rows are deleted)</p>\n                <p><strong>Campaign Line Index:</strong> Stable ID assigned during parsing (never changes, used for overrides)</p>\n                <p><strong>Stable ID:</strong> Position in original parsed data (used for deletion tracking)</p>\n              </div>\n            </div>\n          </div>\n        </details>\n      )}\n\n      {/* Full Data Table - No Max Width */}\n      <div className=\"bg-white dark:bg-slate-800 rounded-lg shadow-lg mb-4 overflow-hidden\">\n        <div className=\"overflow-x-auto overflow-y-auto\" style={{ maxHeight: 'calc(100vh - 280px)' }}>\n          <table className=\"min-w-full divide-y divide-slate-200 dark:divide-slate-700\">\n            <thead className=\"sticky top-0 z-10 bg-slate-50 dark:bg-slate-900\">\n              <tr>\n                <th className=\"px-2 py-1.5 text-left text-xs font-medium text-slate-700 dark:text-slate-300 uppercase tracking-wider bg-slate-50 dark:bg-slate-900 sticky left-0 z-20\">\n                  #\n                </th>\n                <th className=\"px-2 py-1.5 text-left text-xs font-medium text-slate-700 dark:text-slate-300 uppercase tracking-wider whitespace-nowrap bg-slate-50 dark:bg-slate-900\">\n                  Tab Assignment\n                </th>\n                {filteredHeaders.map((header, idx) => (\n                  <th\n                    key={idx}\n                    className=\"px-2 py-1.5 text-left text-xs font-medium text-slate-700 dark:text-slate-300 uppercase tracking-wider whitespace-nowrap\"\n                  >\n                    {header}\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-200 dark:divide-slate-700 bg-white dark:bg-slate-800\">\n              {rowsWithCategories.map((row, rowIdx) => {\n                const category = row._category;\n                const isHeader = category.tab === 'section-header';\n                \n                return (\n                  <tr\n                    key={rowIdx}\n                    className={`${\n                      isHeader\n                        ? 'bg-gradient-to-r from-indigo-100 to-indigo-50 dark:from-indigo-900 dark:to-indigo-800 border-t-2 border-b-2 border-indigo-300 dark:border-indigo-600'\n                        : category.tab === 'Excluded'\n                        ? 'bg-gray-100 hover:bg-gray-150 dark:bg-gray-800/50 dark:hover:bg-gray-800/70 opacity-75' // Gray out excluded rows\n                        : row._masterIndex !== row._index\n                        ? 'bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 border-l-4 border-blue-300' // More prominent background for merged tactic rows\n                        : 'hover:bg-slate-50 dark:hover:bg-slate-900/50'\n                    }`}\n                  >\n                    <td\n                      className={`px-2 py-2 text-xs font-medium sticky left-0 relative ${\n                        isHeader\n                          ? 'bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-200'\n                          : row._masterIndex !== row._index\n                          ? 'text-blue-600 dark:text-blue-400 bg-blue-50/30 dark:bg-blue-900/10'\n                          : 'text-slate-500 dark:text-slate-400 bg-white dark:bg-slate-800 group-hover:bg-slate-50 dark:group-hover:bg-slate-900/50'\n                      }`}\n                      onMouseEnter={() => !isHeader && setHoveredRow(rowIdx)}\n                      onMouseLeave={() => setHoveredRow(null)}\n                    >\n                      {isHeader ? '▼' : (\n                        <span className=\"flex items-center gap-1 relative\">\n                          {hoveredRow === rowIdx ? (\n                            <button\n                              onClick={() => handleDeleteRow(row._stableRowId)}\n                              className=\"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition-colors\"\n                              title=\"Delete this row\"\n                            >\n                              <svg\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                className=\"h-4 w-4\"\n                                viewBox=\"0 0 20 20\"\n                                fill=\"currentColor\"\n                              >\n                                <path\n                                  fillRule=\"evenodd\"\n                                  d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\"\n                                  clipRule=\"evenodd\"\n                                />\n                              </svg>\n                            </button>\n                          ) : (\n                            <span>{rowIdx + 1}</span>\n                          )}\n                          {row._masterIndex !== row._index && (\n                            <span className=\"text-xs text-blue-500\" title=\"Part of merged tactic group\">\n                              📎\n                            </span>\n                          )}\n                        </span>\n                      )}\n                    </td>\n                    <td className={`px-2 py-2 text-xs sticky left-0 ${\n                      isHeader\n                        ? 'bg-indigo-100 dark:bg-indigo-900'\n                        : 'bg-white dark:bg-slate-800'\n                    }`}>\n                      {isHeader ? (\n                        <span className=\"px-3 py-1.5 bg-indigo-600 text-white rounded-md text-xs font-bold uppercase tracking-wide\">\n                          📂 {category.sectionName} Section\n                        </span>\n                      ) : (\n                        <div className=\"flex items-center gap-1\">\n                          {row._hasManualOverride && (\n                            <span className=\"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 px-1.5 py-0.5 rounded font-medium\" title=\"Manual override applied\">\n                              ✓\n                            </span>\n                          )}\n                          <select\n                            value={category.tab}\n                            onChange={(e) => handleCategoryChange(row._index, e.target.value)}\n                            className={`px-2 py-1 rounded text-xs font-medium border-0 cursor-pointer ${\n                              category.tab === 'Brand Say Digital'\n                                ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200'\n                                : category.tab === 'Brand Say Social'\n                                ? 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200'\n                                : category.tab === 'Other Say Social'\n                                ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200'\n                                : category.tab === 'Excluded'\n                                ? 'bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200'\n                                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'\n                            }`}\n                          >\n                            <option value=\"Brand Say Digital\">Brand Say Digital</option>\n                            <option value=\"Brand Say Social\">Brand Say Social</option>\n                            <option value=\"Other Say Social\">Other Say Social</option>\n                            <option value=\"Excluded\">Excluded (Non-Digital)</option>\n                          </select>\n                          {category.tab === 'Excluded' && category.reason && (\n                            <span className=\"text-xs bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-1.5 py-0.5 rounded\" title=\"Exclusion reason\">\n                              {category.reason}\n                            </span>\n                          )}\n                          {manualOverrides[row._index] && (\n                            <span className=\"text-xs text-amber-600 dark:text-amber-400\" title=\"Manually changed\">\n                              ✏️\n                            </span>\n                          )}\n                        </div>\n                      )}\n                    </td>\n                    {filteredHeaders.map((header, colIdx) => {\n                      // Get the actual header from the original column index\n                      const actualHeader = header;\n\n                      const normalizedKey = actualHeader\n                        .toLowerCase()\n                        .replace(/[^a-z0-9]+(.)/g, (_, chr) => chr.toUpperCase())\n                        .replace(/^[^a-z]+/, \"\");\n\n                      // IMPORTANT: Get the mapped key for special columns like \"Campaign Details - Placements\"\n                      const mappedKey = actualHeader === 'Campaign Details - Placements' ? 'placements' : normalizedKey;\n\n                      // Check if this is a shared financial column or date column\n                      const headerLower = actualHeader.toLowerCase().replace(/\\n/g, ' ').replace(/\\s+/g, ' ').replace(/\\//g, ' ').trim();\n                      const isSharedFinancialColumn = headerLower.includes('cpm') ||\n                                                     headerLower.includes('impression') ||\n                                                     headerLower.includes('grp') ||\n                                                     headerLower.includes('gross media cost') ||\n                                                     headerLower.includes('gross budget') ||\n                                                     headerLower.includes('net budget') ||\n                                                     headerLower.includes('media cost') ||\n                                                     headerLower.includes('ad serving') ||\n                                                     headerLower.includes('dv cost') ||\n                                                     headerLower.includes('buffer') ||\n                                                     headerLower.includes('working media budget') ||\n                                                     headerLower.includes('working media cost') ||\n                                                     headerLower.includes('working media') ||\n                                                     headerLower.includes('media fee total') ||\n                                                     headerLower.includes('start date') ||\n                                                     headerLower.includes('end date') ||\n                                                     headerLower.includes('flight start') ||\n                                                     headerLower.includes('flight end') ||\n                                                     headerLower.includes('placement'); // Placements is also shared\n\n                      // Debug: Log shared financial column detection (only once per column)\n                      if (isSharedFinancialColumn && rowIdx === 0) {\n                        console.log(`💰 Detected shared financial column: \"${actualHeader}\" -> normalized: \"${headerLower}\"`);\n                      }\n\n                      // If this is a shared financial column and the current row is part of a tactic group,\n                      // use the value from the master row instead\n                      // Try mapped key first, then fall back to normalized key\n                      let value = row[mappedKey] !== undefined ? row[mappedKey] : row[normalizedKey];\n                      \n                      // Debug: Always log for shared financial columns to see what's happening (limit to first few rows)\n                      if (isSharedFinancialColumn && rowIdx < 3) {\n                        console.log(`💰 Shared Financial Column Debug (Row ${rowIdx}):`, {\n                          rowIndex: row._index,\n                          masterIndex: row._masterIndex,\n                          isMerged: row._masterIndex !== row._index,\n                          header: actualHeader,\n                          normalizedKey: normalizedKey,\n                          originalValue: row[normalizedKey],\n                          isSharedColumn: isSharedFinancialColumn,\n                          allRowKeys: Object.keys(row)\n                        });\n                      }\n                      \n                      let isValueFromMaster = false;\n                      if (isSharedFinancialColumn && row._masterIndex !== row._index) {\n                        const masterRow = filteredRows[row._masterIndex];\n                        if (masterRow) {\n                          // Try the mapped key first, then normalized key\n                          value = masterRow[mappedKey] !== undefined ? masterRow[mappedKey] : masterRow[normalizedKey];\n\n                          // If no value found, try alternative key variations\n                          if (value === undefined || value === null || value === \"\") {\n                            const alternativeKeys = [];\n\n                            // For placements, try variations\n                            if (headerLower.includes('placement')) {\n                              alternativeKeys.push('placements', 'placement');\n                            }\n\n                            // For impressions/grps, try different variations\n                            if (headerLower.includes('impression') || headerLower.includes('grp')) {\n                              alternativeKeys.push('impressions', 'grps', 'impressionsGrps', 'grp', 'estImpressions');\n                            }\n\n                            // For gross media cost, try variations\n                            if (headerLower.includes('gross media cost')) {\n                              alternativeKeys.push('grossMediaCost', 'grossMedia', 'mediaCost');\n                            }\n\n                            // For ad serving, try variations\n                            if (headerLower.includes('ad serving')) {\n                              alternativeKeys.push('adServing', 'adServingCost');\n                            }\n\n                            // For dv cost, try variations\n                            if (headerLower.includes('dv cost')) {\n                              alternativeKeys.push('dvCost', 'dv');\n                            }\n\n                            // For media fee total, try variations\n                            if (headerLower.includes('media fee total')) {\n                              alternativeKeys.push('mediaFeeTotal', 'mediaFee');\n                            }\n\n                            // For working media budget/cost, try variations\n                            if (headerLower.includes('working media budget') || headerLower.includes('working media cost')) {\n                              alternativeKeys.push('workingMediaBudget', 'workingMediaCost', 'workingMedia');\n                            }\n\n                            // For gross budget, try variations\n                            if (headerLower.includes('gross budget')) {\n                              alternativeKeys.push('grossBudget', 'gross');\n                            }\n\n                            // For net budget, try variations\n                            if (headerLower.includes('net budget')) {\n                              alternativeKeys.push('netBudget', 'net');\n                            }\n\n                            // For buffer, try variations\n                            if (headerLower.includes('buffer')) {\n                              alternativeKeys.push('buffer', 'mediaBuffer');\n                            }\n\n                            // For date fields, try variations\n                            if (headerLower.includes('start date') || headerLower.includes('flight start')) {\n                              alternativeKeys.push('startDate', 'flightStart', 'flightStartDate', 'start');\n                            }\n\n                            if (headerLower.includes('end date') || headerLower.includes('flight end')) {\n                              alternativeKeys.push('endDate', 'flightEnd', 'flightEndDate', 'end');\n                            }\n\n                            // Try each alternative key\n                            for (const altKey of alternativeKeys) {\n                              if (masterRow[altKey] !== undefined && masterRow[altKey] !== null && masterRow[altKey] !== \"\") {\n                                value = masterRow[altKey];\n                                console.log(`🔄 Using alternative key \"${altKey}\" for \"${actualHeader}\": ${value}`);\n                                break;\n                              }\n                            }\n                          }\n                          \n                          isValueFromMaster = true;\n                          \n                          console.log(`✅ USING MASTER VALUE:`, {\n                            rowIndex: row._index,\n                            masterIndex: row._masterIndex,\n                            header: actualHeader,\n                            normalizedKey: normalizedKey,\n                            originalValue: row[normalizedKey],\n                            masterValue: value,\n                            masterRowExists: true,\n                            masterRowKeys: Object.keys(masterRow)\n                          });\n                        } else {\n                          console.log(`❌ MASTER ROW NOT FOUND:`, {\n                            rowIndex: row._index,\n                            masterIndex: row._masterIndex,\n                            header: actualHeader,\n                            filteredRowsLength: filteredRows.length\n                          });\n                        }\n                      }\n                      \n                      // Check if this column should be formatted as currency, date, or number\n                      const isCurrencyColumn = headerLower.includes('cpm') ||\n                                              headerLower.includes('media cost') ||\n                                              headerLower.includes('ad serving') ||\n                                              headerLower.includes('dv cost') ||\n                                              headerLower.includes('media fee total') ||\n                                              headerLower.includes('working media budget') ||\n                                              headerLower.includes('working media cost') ||\n                                              headerLower.includes('gross budget') ||\n                                              headerLower.includes('net budget') ||\n                                              headerLower.includes('buffer') ||\n                                              headerLower.includes('budget');\n                      \n                      const isDateColumn = headerLower.includes('start date') ||\n                                          headerLower.includes('end date') ||\n                                          headerLower.includes('date');\n                      \n                      const isNumberColumn = headerLower.includes('impression') ||\n                                            headerLower.includes('grp');\n                      \n                      // Extract the actual value if it's an object (ExcelJS cell/formula object)\n                      let extractedValue = value;\n                      if (value && typeof value === 'object') {\n                        console.log(`🔍 Object value detected for \"${actualHeader}\" (Row ${rowIdx}):`, {\n                          value,\n                          type: typeof value,\n                          keys: Object.keys(value),\n                          hasResult: 'result' in value,\n                          hasValue: 'value' in value,\n                          hasRichText: 'richText' in value,\n                          hasText: 'text' in value\n                        });\n                        \n                        // Check if it's an ExcelJS rich text object\n                        if ((value as any).richText) {\n                          extractedValue = (value as any).richText.map((rt: any) => rt.text).join('');\n                          console.log(`  → Extracted from richText: ${extractedValue}`);\n                        }\n                        // Check if it's a formula cell with a result\n                        else if ((value as any).result !== undefined) {\n                          extractedValue = (value as any).result;\n                          console.log(`  → Extracted from result: ${extractedValue}`);\n                        }\n                        // Check if it has a value property\n                        else if ((value as any).value !== undefined) {\n                          extractedValue = (value as any).value;\n                          console.log(`  → Extracted from value: ${extractedValue}`);\n                        }\n                        // Check if it has a text property\n                        else if ((value as any).text !== undefined) {\n                          extractedValue = (value as any).text;\n                          console.log(`  → Extracted from text: ${extractedValue}`);\n                        }\n                        else {\n                          console.warn(`⚠️ Unexpected object format for \"${actualHeader}\":`, value);\n                          extractedValue = String(value);\n                        }\n                      }\n                      \n                      // Format the value based on column type\n                      let displayValue = extractedValue;\n                      \n                      if (isCurrencyColumn && extractedValue !== undefined && extractedValue !== null && extractedValue !== \"\") {\n                        const numValue = typeof extractedValue === 'number' ? extractedValue : parseFloat(String(extractedValue).replace(/[,$]/g, ''));\n                        if (!isNaN(numValue)) {\n                          displayValue = new Intl.NumberFormat('en-US', {\n                            style: 'currency',\n                            currency: 'USD',\n                            minimumFractionDigits: 2,\n                            maximumFractionDigits: 2\n                          }).format(numValue);\n                        }\n                      } else if (isDateColumn && extractedValue !== undefined && extractedValue !== null && extractedValue !== \"\") {\n                        // Parse date string (YYYY-MM-DD format from Excel in UTC)\n                        const dateStr = String(extractedValue);\n                        const dateMatch = dateStr.match(/(\\d{4})-(\\d{2})-(\\d{2})/);\n                        if (dateMatch) {\n                          const [, year, month, day] = dateMatch;\n                          // Use UTC to avoid timezone shifts that cause off-by-one-day errors\n                          const date = new Date(Date.UTC(parseInt(year), parseInt(month) - 1, parseInt(day)));\n                          // Format as \"Sept, 21, 2025\" using UTC\n                          displayValue = date.toLocaleDateString('en-US', {\n                            month: 'short',\n                            day: 'numeric',\n                            year: 'numeric',\n                            timeZone: 'UTC'\n                          });\n                        }\n                      } else if (isNumberColumn && extractedValue !== undefined && extractedValue !== null && extractedValue !== \"\") {\n                        // Format impressions/GRPs as whole numbers with commas\n                        const numValue = typeof extractedValue === 'number' ? extractedValue : parseFloat(String(extractedValue).replace(/[,$]/g, ''));\n                        if (!isNaN(numValue)) {\n                          displayValue = Math.round(numValue).toLocaleString('en-US');\n                        }\n                      }\n                      \n                      return (\n                        <td\n                          key={colIdx}\n                          className={`px-2 py-2 whitespace-nowrap ${\n                            isHeader\n                              ? 'font-bold text-base text-indigo-900 dark:text-indigo-100 bg-indigo-50 dark:bg-indigo-800'\n                              : isValueFromMaster\n                              ? 'text-xs text-slate-900 dark:text-slate-100 bg-green-50 dark:bg-green-900/20 border-l-2 border-green-400'\n                              : 'text-xs text-slate-900 dark:text-slate-100'\n                          }`}\n                        >\n                          {isHeader && colIdx === 0 ? (\n                            <span className=\"flex items-center gap-2\">\n                              <span className=\"text-lg\">📺</span>\n                              <span className=\"uppercase tracking-wider\">{value}</span>\n                            </span>\n                          ) : (\n                            displayValue !== undefined && displayValue !== null && displayValue !== \"\" ? (\n                              <span className=\"flex items-center gap-1\">\n                                {String(displayValue)}\n                                {isValueFromMaster && (\n                                  <span className=\"text-xs text-green-600 dark:text-green-400\" title=\"Shared from master row\">\n                                    🔗\n                                  </span>\n                                )}\n                              </span>\n                            ) : (\n                              <span className=\"text-slate-400\">—</span>\n                            )\n                          )}\n                        </td>\n                      );\n                    })}\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Error Message */}\n      {error && (\n        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6\">\n              <div className=\"flex items-start gap-3\">\n                <svg\n              className=\"w-5 h-5 text-red-500 mt-0.5\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  stroke=\"currentColor\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                  />\n                </svg>\n                <div>\n              <p className=\"font-medium text-red-900 dark:text-red-100\">\n                Error\n                  </p>\n              <p className=\"text-red-700 dark:text-red-200 text-sm\">\n                {error}\n                  </p>\n                </div>\n              </div>\n            </div>\n          )}\n\n      {/* Actions - Fixed at Bottom */}\n      <div className=\"bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 px-6 py-4 flex gap-3 sticky bottom-0\">\n            <Button\n              variant=\"outline\"\n          onClick={onBackToUpload}\n          disabled={isProcessing}\n          className=\"min-w-[200px]\"\n        >\n          ← Upload Different File\n            </Button>\n            {isAdmin && (\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  // Create CSV content\n                  const csvRows: string[] = [];\n\n                  // Add headers\n                  const headers = ['Row #', 'Campaign Line', ...initialHeaders, '_mergeSpan', '_campaignLineMasterRow'];\n                  csvRows.push(headers.map(h => `\"${h}\"`).join(','));\n\n                  // Add data rows\n                  filteredRows.forEach((row: any, idx: number) => {\n                    const rowNum = idx + 1;\n                    const isMaster = !row._campaignLineMasterRow || row._campaignLineMasterRow === row._campaignLineMasterRow;\n                    const campaignLineLabel = row._mergeSpan > 1\n                      ? `Master (spans ${row._mergeSpan} rows)`\n                      : row._campaignLineMasterRow\n                        ? `Part of line starting at row ${row._campaignLineMasterRow}`\n                        : 'Standalone';\n\n                    const values = [\n                      rowNum,\n                      campaignLineLabel,\n                      ...initialHeaders.map(header => {\n                        const normalizedKey = header\n                          .toLowerCase()\n                          .replace(/[^a-z0-9]+(.)/g, (_, chr) => chr.toUpperCase())\n                          .replace(/^[^a-z]+/, \"\");\n                        // Use mapped key for special columns like \"Campaign Details - Placements\"\n                        const mappedKey = header === 'Campaign Details - Placements' ? 'placements' : normalizedKey;\n                        // Try mapped key first, fall back to normalized key\n                        const value = row[mappedKey] !== undefined ? row[mappedKey] : row[normalizedKey];\n                        // Escape quotes and wrap in quotes\n                        if (value === null || value === undefined) return '';\n                        return `\"${String(value).replace(/\"/g, '\"\"')}\"`;\n                      }),\n                      row._mergeSpan || '',\n                      row._campaignLineMasterRow || ''\n                    ];\n                    csvRows.push(values.join(','));\n                  });\n\n                  // Create blob and download\n                  const csv = csvRows.join('\\n');\n                  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n                  const url = URL.createObjectURL(blob);\n                  const link = document.createElement('a');\n                  link.href = url;\n                  link.download = `blocking-chart-parsed-${new Date().toISOString().slice(0,10)}.csv`;\n                  link.click();\n                  URL.revokeObjectURL(url);\n                }}\n                disabled={isProcessing}\n                className=\"min-w-[180px]\"\n              >\n                📥 Download CSV\n              </Button>\n            )}\n            <Button\n              variant=\"primary\"\n          onClick={onGenerate}\n          disabled={isProcessing}\n              className=\"flex-1\"\n            >\n              {isProcessing ? (\n            <span className=\"flex items-center justify-center gap-2\">\n                  <svg\n                    className=\"animate-spin h-5 w-5\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <circle\n                      className=\"opacity-25\"\n                      cx=\"12\"\n                      cy=\"12\"\n                      r=\"10\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"4\"\n                      fill=\"none\"\n                    />\n                    <path\n                      className=\"opacity-75\"\n                      fill=\"currentColor\"\n                      d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                    />\n                  </svg>\n              Generating...\n                </span>\n              ) : (\n            `✓ Looks Good, Generate Traffic Sheet (${filteredRows.length} tactics) →`\n              )}\n            </Button>\n          </div>\n        </div>\n  );\n}\n\n// Generate Step Component\nfunction GenerateStep({\n  success,\n  isProcessing,\n  error,\n  onStartOver,\n}: {\n  success: boolean;\n  isProcessing: boolean;\n  error: string | null;\n  onStartOver: () => void;\n}) {\n  return (\n    <div className=\"max-w-3xl mx-auto\">\n      <div className=\"bg-white dark:bg-slate-800 rounded-lg shadow-lg p-12 text-center\">\n        {isProcessing && (\n          <div>\n            <svg\n              className=\"animate-spin h-16 w-16 text-blue-600 mx-auto mb-4\"\n              viewBox=\"0 0 24 24\"\n            >\n              <circle\n                className=\"opacity-25\"\n                cx=\"12\"\n                cy=\"12\"\n                r=\"10\"\n                stroke=\"currentColor\"\n                strokeWidth=\"4\"\n                fill=\"none\"\n              />\n              <path\n                className=\"opacity-75\"\n                fill=\"currentColor\"\n                d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n              />\n            </svg>\n            <h3 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\n              Generating Your Traffic Sheet\n            </h3>\n            <p className=\"text-slate-600 dark:text-slate-400\">\n              Please wait while we format your data...\n            </p>\n          </div>\n        )}\n\n        {success && (\n          <div>\n            <div className=\"text-6xl mb-4\">✅</div>\n            <h3 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\n              Traffic Sheet Generated Successfully!\n            </h3>\n            <p className=\"text-slate-600 dark:text-slate-400 mb-8\">\n              Your file has been downloaded. Check your Downloads folder.\n            </p>\n            <Button variant=\"primary\" onClick={onStartOver}>\n              Generate Another Traffic Sheet\n            </Button>\n            </div>\n        )}\n\n        {error && !isProcessing && (\n          <div>\n            <div className=\"text-6xl mb-4\">❌</div>\n            <h3 className=\"text-2xl font-bold text-red-900 dark:text-red-100 mb-2\">\n              Generation Failed\n            </h3>\n            <p className=\"text-red-700 dark:text-red-200 mb-8\">\n              {error}\n            </p>\n            <Button variant=\"primary\" onClick={onStartOver}>\n              Try Again\n            </Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}